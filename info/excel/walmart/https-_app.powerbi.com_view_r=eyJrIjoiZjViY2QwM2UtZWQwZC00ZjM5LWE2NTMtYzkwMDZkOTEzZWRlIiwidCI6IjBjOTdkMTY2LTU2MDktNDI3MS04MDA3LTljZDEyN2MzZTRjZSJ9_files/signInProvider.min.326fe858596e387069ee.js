!function(){"use strict";var i,e,To={384:function(i,e,t){t.d(e,{t:function(){return o}});var r=t(390),n=t(353);class o extends r.B7{constructor(s){super(),this._value=s}get value(){return this.getValue()}_subscribe(s){var c=super._subscribe(s);return c&&!c.closed&&s.next(this._value),c}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new n.P;return this._value}next(s){super.next(this._value=s)}}},106:function(i,e,t){t.d(e,{E:function(){return u}});var r=t(731),o=t(767),a=t(112),c=t(266);var u=(()=>{class f{constructor(v,S,T){this.kind=v,this.value=S,this.error=T,this.hasValue="N"===v}observe(v){switch(this.kind){case"N":return v.next&&v.next(this.value);case"E":return v.error&&v.error(this.error);case"C":return v.complete&&v.complete()}}do(v,S,T){switch(this.kind){case"N":return v&&v(this.value);case"E":return S&&S(this.error);case"C":return T&&T()}}accept(v,S,T){return v&&"function"==typeof v.next?this.observe(v):this.do(v,S,T)}toObservable(){switch(this.kind){case"N":return function(...f){var m=f[f.length-1];return function(f){return f&&"function"==typeof f.schedule}(m)?(f.pop(),(0,a.V)(f,m)):(0,o.c)(f)}(this.value);case"E":return function(f,m){return new c.c(v=>v.error(f))}(this.error);case"C":return(0,r.I)()}throw new Error("unexpected notification kind value")}static createNext(v){return typeof v<"u"?new f("N",v):f.undefinedValueNotification}static createError(v){return new f("E",void 0,v)}static createComplete(){return f.completeNotification}}return f.completeNotification=new f("C"),f.undefinedValueNotification=new f("N",void 0),f})()},266:function(i,e,t){t.d(e,{c:function(){return f}});var r=t(362),o=t(395),a=t(586),c=t(898);function l(v){return v}var u=t(134),f=(()=>{class v{constructor(T){this._isScalar=!1,T&&(this._subscribe=T)}lift(T){var R=new v;return R.source=this,R.operator=T,R}subscribe(T,R,V){var{operator:ee}=this,K=function(v,S,T){if(v){if(v instanceof r.v)return v;if(v[o.D])return v[o.D]()}return v||S||T?new r.v(v,S,T):new r.v(a.I)}(T,R,V);if(K.add(ee?ee.call(K,this.source):this.source||u.$.useDeprecatedSynchronousErrorHandling&&!K.syncErrorThrowable?this._subscribe(K):this._trySubscribe(K)),u.$.useDeprecatedSynchronousErrorHandling&&K.syncErrorThrowable&&(K.syncErrorThrowable=!1,K.syncErrorThrown))throw K.syncErrorValue;return K}_trySubscribe(T){try{return this._subscribe(T)}catch(R){u.$.useDeprecatedSynchronousErrorHandling&&(T.syncErrorThrown=!0,T.syncErrorValue=R),function(v){for(;v;){var{closed:S,destination:T,isStopped:R}=v;if(S||R)return!1;v=T&&T instanceof r.v?T:null}return!0}(T)&&T.error(R)}}forEach(T,R){return new(R=m(R))((V,ee)=>{var K;K=this.subscribe(Ce=>{try{T(Ce)}catch(Kn){ee(Kn),K&&K.unsubscribe()}},ee,V)})}_subscribe(T){var{source:R}=this;return R&&R.subscribe(T)}[c.s](){return this}pipe(...T){return 0===T.length?this:function(v){return 0===v.length?l:1===v.length?v[0]:function(T){return v.reduce((R,V)=>V(R),T)}}(T)(this)}toPromise(T){return new(T=m(T))((R,V)=>{var ee;this.subscribe(K=>ee=K,K=>V(K),()=>R(ee))})}}return v.create=S=>new v(S),v})();function m(v){if(v||(v=u.$.Promise||Promise),!v)throw new Error("no Promise impl found");return v}},586:function(i,e,t){t.d(e,{I:function(){return o}});var r=t(134),n=t(149),o={closed:!0,next(a){},error(a){if(r.$.useDeprecatedSynchronousErrorHandling)throw a;(0,n.T)(a)},complete(){}}},390:function(i,e,t){t.d(e,{B7:function(){return d}});var r=t(266),n=t(362),o=t(636),a=t(353),s=t(483),c=t(395);class l extends n.v{constructor(f){super(f),this.destination=f}}var d=(()=>{class u extends r.c{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[c.D](){return new l(this)}lift(m){var v=new h(this,this);return v.operator=m,v}next(m){if(this.closed)throw new a.P;if(!this.isStopped)for(var{observers:v}=this,S=v.length,T=v.slice(),R=0;R<S;R++)T[R].next(m)}error(m){if(this.closed)throw new a.P;this.hasError=!0,this.thrownError=m,this.isStopped=!0;for(var{observers:v}=this,S=v.length,T=v.slice(),R=0;R<S;R++)T[R].error(m);this.observers.length=0}complete(){if(this.closed)throw new a.P;this.isStopped=!0;for(var{observers:m}=this,v=m.length,S=m.slice(),T=0;T<v;T++)S[T].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(m){if(this.closed)throw new a.P;return super._trySubscribe(m)}_subscribe(m){if(this.closed)throw new a.P;return this.hasError?(m.error(this.thrownError),o.y.EMPTY):this.isStopped?(m.complete(),o.y.EMPTY):(this.observers.push(m),new s.Y(this,m))}asObservable(){var m=new r.c;return m.source=this,m}}return u.create=(f,m)=>new h(f,m),u})();class h extends d{constructor(f,m){super(),this.destination=f,this.source=m}next(f){var{destination:m}=this;m&&m.next&&m.next(f)}error(f){var{destination:m}=this;m&&m.error&&this.destination.error(f)}complete(){var{destination:f}=this;f&&f.complete&&this.destination.complete()}_subscribe(f){var{source:m}=this;return m?this.source.subscribe(f):o.y.EMPTY}}},483:function(i,e,t){t.d(e,{Y:function(){return n}});var r=t(636);class n extends r.y{constructor(a,s){super(),this.subject=a,this.subscriber=s,this.closed=!1}unsubscribe(){if(!this.closed){this.closed=!0;var a=this.subject,s=a.observers;if(this.subject=null,s&&0!==s.length&&!a.isStopped&&!a.closed){var c=s.indexOf(this.subscriber);-1!==c&&s.splice(c,1)}}}}},362:function(i,e,t){t.d(e,{v:function(){return l}});var r=t(139),n=t(586),o=t(636),a=t(395),s=t(134),c=t(149);class l extends o.y{constructor(u,f,m){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=n.I;break;case 1:if(!u){this.destination=n.I;break}if("object"==typeof u){u instanceof l?(this.syncErrorThrowable=u.syncErrorThrowable,this.destination=u,u.add(this)):(this.syncErrorThrowable=!0,this.destination=new d(this,u));break}default:this.syncErrorThrowable=!0,this.destination=new d(this,u,f,m)}}[a.D](){return this}static create(u,f,m){var v=new l(u,f,m);return v.syncErrorThrowable=!1,v}next(u){this.isStopped||this._next(u)}error(u){this.isStopped||(this.isStopped=!0,this._error(u))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(u){this.destination.next(u)}_error(u){this.destination.error(u),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){var{_parentOrParents:u}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=u,this}}class d extends l{constructor(u,f,m,v){super(),this._parentSubscriber=u;var S,T=this;(0,r.T)(f)?S=f:f&&(S=f.next,m=f.error,v=f.complete,f!==n.I&&(T=Object.create(f),(0,r.T)(T.unsubscribe)&&this.add(T.unsubscribe.bind(T)),T.unsubscribe=this.unsubscribe.bind(this))),this._context=T,this._next=S,this._error=m,this._complete=v}next(u){if(!this.isStopped&&this._next){var{_parentSubscriber:f}=this;s.$.useDeprecatedSynchronousErrorHandling&&f.syncErrorThrowable?this.__tryOrSetError(f,this._next,u)&&this.unsubscribe():this.__tryOrUnsub(this._next,u)}}error(u){if(!this.isStopped){var{_parentSubscriber:f}=this,{useDeprecatedSynchronousErrorHandling:m}=s.$;if(this._error)m&&f.syncErrorThrowable?(this.__tryOrSetError(f,this._error,u),this.unsubscribe()):(this.__tryOrUnsub(this._error,u),this.unsubscribe());else if(f.syncErrorThrowable)m?(f.syncErrorValue=u,f.syncErrorThrown=!0):(0,c.T)(u),this.unsubscribe();else{if(this.unsubscribe(),m)throw u;(0,c.T)(u)}}}complete(){if(!this.isStopped){var{_parentSubscriber:u}=this;if(this._complete){var f=()=>this._complete.call(this._context);s.$.useDeprecatedSynchronousErrorHandling&&u.syncErrorThrowable?(this.__tryOrSetError(u,f),this.unsubscribe()):(this.__tryOrUnsub(f),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(u,f){try{u.call(this._context,f)}catch(m){if(this.unsubscribe(),s.$.useDeprecatedSynchronousErrorHandling)throw m;(0,c.T)(m)}}__tryOrSetError(u,f,m){if(!s.$.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{f.call(this._context,m)}catch(v){return s.$.useDeprecatedSynchronousErrorHandling?(u.syncErrorValue=v,u.syncErrorThrown=!0,!0):((0,c.T)(v),!0)}return!1}_unsubscribe(){var{_parentSubscriber:u}=this;this._context=null,this._parentSubscriber=null,u.unsubscribe()}}},636:function(i,e,t){t.d(e,{y:function(){return c}});var r=t(474),n=t(704),o=t(139),s=(()=>{function d(h){return Error.call(this),this.message=h?`${h.length} errors occurred during unsubscription:\n${h.map((u,f)=>`${f+1}) ${u.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=h,this}return d.prototype=Object.create(Error.prototype),d})(),c=(()=>{class d{constructor(u){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,u&&(this._ctorUnsubscribe=!0,this._unsubscribe=u)}unsubscribe(){var u;if(!this.closed){var{_parentOrParents:f,_ctorUnsubscribe:m,_unsubscribe:v,_subscriptions:S}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,f instanceof d)f.remove(this);else if(null!==f)for(var T=0;T<f.length;++T)f[T].remove(this);if((0,o.T)(v)){m&&(this._unsubscribe=void 0);try{v.call(this)}catch(Ce){u=Ce instanceof s?l(Ce.errors):[Ce]}}if((0,r.c)(S))for(var V=-1,ee=S.length;++V<ee;){var K=S[V];if((0,n.G)(K))try{K.unsubscribe()}catch(Ce){u=u||[],Ce instanceof s?u=u.concat(l(Ce.errors)):u.push(Ce)}}if(u)throw new s(u)}}add(u){var f=u;if(!u)return d.EMPTY;switch(typeof u){case"function":f=new d(u);case"object":if(f===this||f.closed||"function"!=typeof f.unsubscribe)return f;if(this.closed)return f.unsubscribe(),f;if(!(f instanceof d)){var m=f;(f=new d)._subscriptions=[m]}break;default:throw new Error("unrecognized teardown "+u+" added to Subscription.")}var{_parentOrParents:v}=f;if(null===v)f._parentOrParents=this;else if(v instanceof d){if(v===this)return f;f._parentOrParents=[v,this]}else{if(-1!==v.indexOf(this))return f;v.push(this)}var S=this._subscriptions;return null===S?this._subscriptions=[f]:S.push(f),f}remove(u){var f=this._subscriptions;if(f){var m=f.indexOf(u);-1!==m&&f.splice(m,1)}}}return d.EMPTY=((h=new d).closed=!0,h),d;var h})();function l(d){return d.reduce((h,u)=>h.concat(u instanceof s?u.errors:u),[])}},134:function(i,e,t){t.d(e,{$:function(){return n}});var r=!1,n={Promise:void 0,set useDeprecatedSynchronousErrorHandling(o){o&&new Error,r=o},get useDeprecatedSynchronousErrorHandling(){return r}}},731:function(i,e,t){t.d(e,{I:function(){return o}});var r=t(266),n=new r.c(s=>s.complete());function o(s){return s?function(s){return new r.c(c=>s.schedule(()=>c.complete()))}(s):n}},767:function(i,e,t){t.d(e,{c:function(){return a}});var r=t(266),n=t(137),o=t(112);function a(s,c){return c?(0,o.V)(s,c):new r.c((0,n.v)(s))}},976:function(i,e,t){t.d(e,{p:function(){return n}});var r=t(362);function n(s,c){return function(d){return d.lift(new o(s,c))}}class o{constructor(c,l){this.predicate=c,this.thisArg=l}call(c,l){return l.subscribe(new a(c,this.predicate,this.thisArg))}}class a extends r.v{constructor(c,l,d){super(c),this.predicate=l,this.thisArg=d,this.count=0}_next(c){var l;try{l=this.predicate.call(this.thisArg,c,this.count++)}catch(d){return void this.destination.error(d)}l&&this.destination.next(c)}}},913:function(i,e,t){t.d(e,{QE:function(){return o},YZ:function(){return s}});var r=t(362),n=t(106);function o(l,d=0){return function(u){return u.lift(new a(l,d))}}class a{constructor(d,h=0){this.scheduler=d,this.delay=h}call(d,h){return h.subscribe(new s(d,this.scheduler,this.delay))}}class s extends r.v{constructor(d,h,u=0){super(d),this.scheduler=h,this.delay=u}static dispatch(d){var{notification:h,destination:u}=d;h.observe(u),this.unsubscribe()}scheduleMessage(d){this.destination.add(this.scheduler.schedule(s.dispatch,this.delay,new c(d,this.destination)))}_next(d){this.scheduleMessage(n.E.createNext(d))}_error(d){this.scheduleMessage(n.E.createError(d)),this.unsubscribe()}_complete(){this.scheduleMessage(n.E.createComplete()),this.unsubscribe()}}class c{constructor(d,h){this.notification=d,this.destination=h}}},51:function(i,e,t){t.d(e,{s:function(){return s}});var r=t(362),o=(()=>{function d(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return d.prototype=Object.create(Error.prototype),d})(),a=t(731);function s(d){return h=>0===d?(0,a.I)():h.lift(new c(d))}class c{constructor(h){if(this.total=h,this.total<0)throw new o}call(h,u){return u.subscribe(new l(h,this.total))}}class l extends r.v{constructor(h,u){super(h),this.total=u,this.count=0}_next(h){var u=this.total,f=++this.count;f<=u&&(this.destination.next(h),f===u&&(this.destination.complete(),this.unsubscribe()))}}},112:function(i,e,t){t.d(e,{V:function(){return o}});var r=t(266),n=t(636);function o(a,s){return new r.c(c=>{var l=new n.y,d=0;return l.add(s.schedule(function(){d!==a.length?(c.next(a[d++]),c.closed||l.add(this.schedule())):c.complete()})),l})}},26:function(i,e,t){t.d(e,{R:function(){return o}});var r=t(636);class n extends r.y{constructor(s,c){super()}schedule(s,c=0){return this}}class o extends n{constructor(s,c){super(s,c),this.scheduler=s,this.work=c,this.pending=!1}schedule(s,c=0){if(this.closed)return this;this.state=s;var l=this.id,d=this.scheduler;return null!=l&&(this.id=this.recycleAsyncId(d,l,c)),this.pending=!0,this.delay=c,this.id=this.id||this.requestAsyncId(d,this.id,c),this}requestAsyncId(s,c,l=0){return setInterval(s.flush.bind(s,this),l)}recycleAsyncId(s,c,l=0){if(null!==l&&this.delay===l&&!1===this.pending)return c;clearInterval(c)}execute(s,c){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var l=this._execute(s,c);if(l)return l;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(s,c){var l=!1,d=void 0;try{this.work(s)}catch(h){l=!0,d=!!h&&h||new Error(h)}if(l)return this.unsubscribe(),d}_unsubscribe(){var s=this.id,c=this.scheduler,l=c.actions,d=l.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==d&&l.splice(d,1),null!=s&&(this.id=this.recycleAsyncId(c,s,null)),this.delay=null}}},163:function(i,e,t){t.d(e,{q:function(){return n}});var r=(()=>{class o{constructor(s,c=o.now){this.SchedulerAction=s,this.now=c}schedule(s,c=0,l){return new this.SchedulerAction(this,s).schedule(l,c)}}return o.now=()=>Date.now(),o})();class n extends r{constructor(a,s=r.now){super(a,()=>n.delegate&&n.delegate!==this?n.delegate.now():s()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(a,s=0,c){return n.delegate&&n.delegate!==this?n.delegate.schedule(a,s,c):super.schedule(a,s,c)}flush(a){var{actions:s}=this;if(this.active)s.push(a);else{var c;this.active=!0;do{if(c=a.execute(a.state,a.delay))break}while(a=s.shift());if(this.active=!1,c){for(;a=s.shift();)a.unsubscribe();throw c}}}}},728:function(i,e,t){t.d(e,{g:function(){return c},T:function(){return s}});var r=t(26);class n extends r.R{constructor(d,h){super(d,h),this.scheduler=d,this.work=h}schedule(d,h=0){return h>0?super.schedule(d,h):(this.delay=h,this.state=d,this.scheduler.flush(this),this)}execute(d,h){return h>0||this.closed?super.execute(d,h):this._execute(d,h)}requestAsyncId(d,h,u=0){return null!==u&&u>0||null===u&&this.delay>0?super.requestAsyncId(d,h,u):d.flush(this)}}var o=t(163);class a extends o.q{}var s=new a(n),c=s},898:function(i,e,t){t.d(e,{s:function(){return r}});var r="function"==typeof Symbol&&Symbol.observable||"@@observable"},395:function(i,e,t){t.d(e,{D:function(){return r}});var r="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()},353:function(i,e,t){t.d(e,{P:function(){return n}});var n=(()=>{function o(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return o.prototype=Object.create(Error.prototype),o})()},149:function(i,e,t){function r(n){setTimeout(()=>{throw n},0)}t.d(e,{T:function(){return r}})},474:function(i,e,t){t.d(e,{c:function(){return r}});var r=Array.isArray||(n=>n&&"number"==typeof n.length)},139:function(i,e,t){function r(n){return"function"==typeof n}t.d(e,{T:function(){return r}})},704:function(i,e,t){function r(n){return null!==n&&"object"==typeof n}t.d(e,{G:function(){return r}})},137:function(i,e,t){t.d(e,{v:function(){return r}});var r=n=>o=>{for(var a=0,s=n.length;a<s&&!o.closed;a++)o.next(n[a]);o.complete()}},584:function(i,e,t){function r(o,a,s,c,l,d,h){try{var u=o[d](h),f=u.value}catch(m){return void s(m)}u.done?a(f):Promise.resolve(f).then(c,l)}function n(o){return function(){var a=this,s=arguments;return new Promise(function(c,l){var d=o.apply(a,s);function h(f){r(d,c,l,h,u,"next",f)}function u(f){r(d,c,l,h,u,"throw",f)}h(void 0)})}}t.d(e,{A:function(){return n}})}},Io={};function _(i){var e=Io[i];if(void 0!==e)return e.exports;var t=Io[i]={exports:{}};return To[i](t,t.exports,_),t.exports}_.m=To,_.d=function(i,e){for(var t in e)_.o(e,t)&&!_.o(i,t)&&Object.defineProperty(i,t,{enumerable:!0,get:e[t]})},_.f={},_.e=function(i){return Promise.all(Object.keys(_.f).reduce(function(e,t){return _.f[t](i,e),e},[]))},_.u=function(i){return"signInProvider."+(0===i?"app-insights":i)+".min."+{0:"35dc3d4a95adc68308f2",SignInTelemetry:"5f5c0395603700b050e4"}[i]+".js"},_.miniCssF=function(i){},_.miniCssF=function(i){},_.miniCssF=function(i){},_.miniCssF=function(i){},_.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch{if("object"==typeof window)return window}}(),_.o=function(i,e){return Object.prototype.hasOwnProperty.call(i,e)},i={},e="clientAuthProvider:",_.l=function(t,r,n,o){if(i[t])i[t].push(r);else{var a,s;if(void 0!==n)for(var c=document.getElementsByTagName("script"),l=0;l<c.length;l++){var d=c[l];if(d.getAttribute("src")==t||d.getAttribute("data-webpack")==e+n){a=d;break}}a||(s=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,_.nc&&a.setAttribute("nonce",_.nc),a.setAttribute("data-webpack",e+n),a.src=_.tu(t)),i[t]=[r];var h=function(m,v){a.onerror=a.onload=null,clearTimeout(f);var S=i[t];if(delete i[t],a.parentNode&&a.parentNode.removeChild(a),S&&S.forEach(function(T){return T(v)}),m)return m(v)},u=window.adjustCdnTimeoutThreshold?6e4:12e4,f=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),u);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),s&&document.head.appendChild(a)}},_.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},function(){var i;_.tt=function(){return void 0===i&&(i={createScriptURL:function(e){return e}},typeof trustedTypes<"u"&&trustedTypes.createPolicy&&(i=trustedTypes.createPolicy("angular#bundler",i))),i}}(),_.tu=function(i){return _.tt().createScriptURL(i)},function(){var i;_.g.importScripts&&(i=_.g.location+"");var e=_.g.document;if(!i&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(i=e.currentScript.src),!i)){var t=e.getElementsByTagName("script");if(t.length)for(var r=t.length-1;r>-1&&(!i||!/^http(s?):/.test(i));)i=t[r--].src}if(!i)throw new Error("Automatic publicPath is not supported in this browser");i=i.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),_.p=i}(),function(){var i=_.u,e=_.e,t=new Map,r=new Map;_.u=function(n){return i(n)+(t.has(n)?"?"+t.get(n):"")},_.e=function(n){return e(n).catch(function(a){var s=r.has(n)?r.get(n):5;if(window.adjustCdnTimeoutRetry&&"timeout"===a.type&&"True"===window.useCDN&&_.p.includes(window.cdnUrl)&&(s=0),s<1){var c=i(n);a.message="timeout"===a.type?a.message:"Loading chunk "+n+" failed after 5 retries.\n("+c+")",a.request=c;var d,l=new Date,h="unknown",u="unknown";if(window.cdnFallbackForLazyLoadBrowserRefreshed=!!window.cdnFallbackForLazyLoadBrowserRefreshed&&window.cdnFallbackForLazyLoadBrowserRefreshed,d=event&&event.currentTarget&&event.currentTarget.src||_.p+c,_.p.includes(window.cdnUrl)&&"True"===window.useCDN){if("function"==typeof window.performance?.getEntriesByName){var m=window.performance?.getEntriesByName(d)[0];m&&(h=m.responseStatus,u=m.duration)}var v="disablecdn=cdnRequestFailureTimestamp:"+l.toUTCString()+"-cdnRequestFailureUrl:"+d+"-sessionSource:"+window.sessionSource+"-statusCode:"+h+"-durationMs:"+u+"-loadType:lazy-errorType:"+a.type+"-documentHidden:"+document.hidden+"; max-age=28800; secure; partitioned; samesite=none",S="; cdnFallbackForLazyLoad: "+!!window.cdnFallbackForLazyLoad;if(window.telemetryService?.logTrace({type:4,text:"LazyLoadCDNFallback; error: "+JSON.stringify(a)+S+"; cookie: "+v}),window.telemetryService?.flush(),!document.hidden&&window.cdnFallbackForLazyLoad){try{document.cookie=v}catch{}var T=new URL(window.location.href);T.searchParams.set("disablecdnExpiration",Math.round(new Date/1e3+28800).toString()),window.cdnFallbackForLazyLoadBrowserRefreshed||(setTimeout(()=>{window.location.href=T.href},2e3),window.cdnFallbackForLazyLoadBrowserRefreshed=!0)}}throw a}return new Promise(function(R){setTimeout(function(){var K=Date.now();t.set(n,K),r.set(n,s-1),R(_.e(n))},3e3)})})}}(),function(){var i={1:0};_.f.j=function(r,n){var o=_.o(i,r)?i[r]:void 0;if(0!==o)if(o)n.push(o[2]);else{var a=new Promise(function(d,h){o=i[r]=[d,h]});n.push(o[2]=a);var s=_.p+_.u(r),c=new Error;_.l(s,function(d){if(_.o(i,r)&&(0!==(o=i[r])&&(i[r]=void 0),o)){var h=d&&("load"===d.type?"missing":d.type),u=d&&d.target&&d.target.src;c.message="Loading chunk "+r+" failed.\n("+h+": "+u+")",c.name="ChunkLoadError",c.type=h,c.request=u,o[1](c)}},"chunk-"+r,r)}};var e=function(r,n){var c,l,o=n[0],a=n[1],s=n[2],d=0;if(o.some(function(u){return 0!==i[u]})){for(c in a)_.o(a,c)&&(_.m[c]=a[c]);s&&s(_)}for(r&&r(n);d<o.length;d++)_.o(i,l=o[d])&&i[l]&&i[l][0](),i[l]=0},t=self.webpackChunkclientAuthProvider=self.webpackChunkclientAuthProvider||[];t.forEach(e.bind(null,0)),t.push=e.bind(null,t.push.bind(t))}();var Fn={};_.r(Fn),_.d(Fn,{CAEClaimHeaderValues:function(){return Qa},CAEClaimHeaders:function(){return kd},SignInProviderConstants:function(){return I},SignInProviderService:function(){return Xa},generateGuid:function(){return vo},isInIframe:function(){return Qd},isNullOrUndefinedOrWhiteSpaceString:function(){return D},isSignedIn:function(){return zd},parseClaimChallenge:function(){return Wa},parseClaimsFromToken:function(){return Co},retrieveSignedInAccount:function(){return es},signIn:function(){return Gd},signOut:function(){return qd}});var p=_(584),C={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",CACHE_PREFIX:"msal",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_RESPONSE_TYPE:"code",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",FRAGMENT_RESPONSE_MODE:"fragment",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",NOT_AVAILABLE:"Not Available",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],TOKEN_RESPONSE_TYPE:"token",ID_TOKEN_RESPONSE_TYPE:"id_token",SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"},Je=[C.OPENID_SCOPE,C.PROFILE_SCOPE,C.OFFLINE_ACCESS_SCOPE],Eo=[...Je,C.EMAIL_SCOPE],j_ID_TOKEN="idtoken",j_CLIENT_INFO="client.info",j_ERROR="error",j_ERROR_DESC="error.description",J={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",CREATE:"create",NO_SESSION:"no_session"},So={PLAIN:"plain",S256:"S256"},At={QUERY:"query",FRAGMENT:"fragment"},ts={...At,FORM_POST:"form_post"},te={CACHE_KEY_SEPARATOR:"-",CLIENT_INFO_SEPARATOR:"."},P={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"},Bn="appmetadata",Z={SCHEMA_VERSION:5,MAX_CUR_HEADER_BYTES:80,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"},F={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},Et="unexpected_error",dr={[Et]:"Unexpected error in authentication.",post_request_failed:"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details."};class G extends Error{constructor(e,t,r){super(t?`${e}: ${t}`:e),Object.setPrototypeOf(this,G.prototype),this.errorCode=e||C.EMPTY_STRING,this.errorMessage=t||C.EMPTY_STRING,this.subError=r||C.EMPTY_STRING,this.name="AuthError"}setCorrelationId(e){this.correlationId=e}}function ko(i,e){return new G(i,e?`${dr[i]} ${e}`:dr[i])}var ur="redirect_uri_empty",hr="authority_uri_insecure",Ge="url_parse_error",gr="empty_url_error",fr="empty_input_scopes_error",pr="invalid_prompt_value",St="invalid_claims",mr="token_request_empty",vr="logout_request_empty",Cr="invalid_code_challenge_method",_t="pkce_params_missing",wt="invalid_cloud_discovery_metadata",yr="invalid_authority_metadata",Rt="untrusted_authority",Ze="missing_ssh_jwk",Ar="missing_ssh_kid",Tr="cannot_set_OIDCOptions",Ir="cannot_allow_native_broker",Er="authority_mismatch",Q={[ur]:"A redirect URI is required for all calls, and none has been set.",claims_request_parsing_error:"Could not parse the given claims request object.",[hr]:"Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options",[Ge]:"URL could not be parsed into appropriate segments.",[gr]:"URL was empty or null.",[fr]:"Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token.",[pr]:"Please see here for valid configuration options: https://azuread.github.io/microsoft-authentication-library-for-js/ref/modules/_azure_msal_common.html#commonauthorizationurlrequest",[St]:"Given claims parameter must be a stringified JSON object.",[mr]:"Token request was empty and not found in cache.",[vr]:"The logout request was null or undefined.",[Cr]:'code_challenge_method passed is invalid. Valid values are "plain" and "S256".',[_t]:"Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request",[wt]:"Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields",[yr]:"Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields.",[Rt]:"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter.",[Ze]:"Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme.",[Ar]:"Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme.",missing_nonce_authentication_header:"Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce.",invalid_authentication_header:"Invalid authentication header provided",[Tr]:"Cannot set OIDCOptions parameter. Please change the protocol mode to OIDC or use a non-Microsoft authority.",[Ir]:"Cannot set allowNativeBroker parameter to true when not in AAD protocol mode.",[Er]:"Authority mismatch error. Authority provided in login request or PublicClientApplication config does not match the environment of the provided account. Please use a matching account or make an interactive request to login to this authority."};class Wn extends G{constructor(e){super(e,Q[e]),this.name="ClientConfigurationError",Object.setPrototypeOf(this,Wn.prototype)}}function $(i){return new Wn(i)}class he{static isEmptyObj(e){if(e)try{var t=JSON.parse(e);return 0===Object.keys(t).length}catch{}return!0}static startsWith(e,t){return 0===e.indexOf(t)}static endsWith(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length}static queryStringToObject(e){var t={},r=e.split("&"),n=o=>decodeURIComponent(o.replace(/\+/g," "));return r.forEach(o=>{if(o.trim()){var[a,s]=o.split(/=(.+)/g,2);a&&s&&(t[n(a)]=n(s))}}),t}static trimArrayEntries(e){return e.map(t=>t.trim())}static removeEmptyStringsFromArray(e){return e.filter(t=>!!t)}static jsonParseHelper(e){try{return JSON.parse(e)}catch{return null}}static matchPattern(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)}}var kt="client_info_decoding_error",Sr="client_info_empty_error",bt="token_parsing_error",_r="null_or_empty_token",ge="endpoints_resolution_error",wr="network_error",Pt="openid_config_error",Rr="hash_not_deserialized",Le="invalid_state",kr="state_mismatch",et="state_not_found",br="nonce_mismatch",Ot="auth_time_not_found",Pr="max_age_transpired",Or="multiple_matching_appMetadata",Nr="request_cannot_be_made",Mr="cannot_remove_empty_scope",Ur="cannot_append_scopeset",Nt="empty_input_scopeset",Mt="no_account_in_silent_request",Dr="invalid_cache_record",Ut="invalid_cache_environment",Dt="no_account_found",Lt="no_crypto_object",Ht="unexpected_credential_type",fe="token_refresh_required",Lr="token_claims_cnf_required_for_signedjwt",Hr="authorization_code_missing_from_server_response",xr="binding_key_not_removed",Kr="end_session_endpoint_not_supported",xt="key_id_missing",U="method_not_implemented",M={[kt]:"The client info could not be parsed/decoded correctly",[Sr]:"The client info was empty",[bt]:"Token cannot be parsed",[_r]:"The token is null or empty",[ge]:"Endpoints cannot be resolved",[wr]:"Network request failed",[Pt]:"Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints.",[Rr]:"The hash parameters could not be deserialized",[Le]:"State was not the expected format",[kr]:"State mismatch error",[et]:"State not found",[br]:"Nonce mismatch error",[Ot]:"Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information.",[Pr]:"Max Age is set to 0, or too much time has elapsed since the last end-user authentication.",multiple_matching_tokens:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account.",multiple_matching_accounts:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account",[Or]:"The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata",[Nr]:"Token request cannot be made without authorization code or refresh token.",[Mr]:"Cannot remove null or empty scope from ScopeSet",[Ur]:"Cannot append ScopeSet",[Nt]:"Empty input ScopeSet cannot be processed",device_code_polling_cancelled:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true.",device_code_expired:"Device code is expired.",device_code_unknown_error:"Device code stopped polling for unknown reasons.",[Mt]:"Please pass an account object, silent flow is not supported without account information",[Dr]:"Cache record object was null or undefined.",[Ut]:"Invalid environment when attempting to create cache entry",[Dt]:"No account found in cache for given key.",[Lt]:"No crypto object detected.",[Ht]:"Unexpected credential type.",invalid_assertion:"Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515",invalid_client_credential:"Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential",[fe]:"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired.",user_timeout_reached:"User defined timeout for device code polling reached",[Lr]:"Cannot generate a POP jwt if the token_claims are not populated",[Hr]:"Server response does not contain an authorization code to proceed",[xr]:"Could not remove the credential's binding key from storage.",[Kr]:"The provided authority does not support logout",[xt]:"A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key.",no_network_connectivity:"No network connectivity. Check your internet connection.",user_canceled:"User cancelled the flow.",missing_tenant_id_error:"A tenant id - not common, organizations, or consumers - must be specified when using the client_credentials flow.",[U]:"This method has not been implemented",nested_app_auth_bridge_disabled:"The nested app auth bridge is disabled"};class Fr extends G{constructor(e,t){super(e,t?`${M[e]}: ${t}`:M[e]),this.name="ClientAuthError",Object.setPrototypeOf(this,Fr.prototype)}}function A(i,e){return new Fr(i,e)}function bo(i){return i.startsWith("#/")?i.substring(2):i.startsWith("#")||i.startsWith("?")?i.substring(1):i}function Br(i){if(!i||i.indexOf("=")<0)return null;try{var e=bo(i),t=Object.fromEntries(new URLSearchParams(e));if(t.code||t.error||t.error_description||t.state)return t}catch{throw A(Rr)}return null}class H{get urlString(){return this._urlString}constructor(e){if(this._urlString=e,!this._urlString)throw $(gr);e.includes("#")||(this._urlString=H.canonicalizeUri(e))}static canonicalizeUri(e){if(e){var t=e.toLowerCase();return he.endsWith(t,"?")?t=t.slice(0,-1):he.endsWith(t,"?/")&&(t=t.slice(0,-2)),he.endsWith(t,"/")||(t+="/"),t}return e}validateAsUri(){var e;try{e=this.getUrlComponents()}catch{throw $(Ge)}if(!e.HostNameAndPort||!e.PathSegments)throw $(Ge);if(!e.Protocol||"https:"!==e.Protocol.toLowerCase())throw $(hr)}static appendQueryString(e,t){return t?e.indexOf("?")<0?`${e}?${t}`:`${e}&${t}`:e}static removeHashFromUrl(e){return H.canonicalizeUri(e.split("#")[0])}replaceTenantPath(e){var t=this.getUrlComponents(),r=t.PathSegments;return e&&0!==r.length&&("common"===r[0]||"organizations"===r[0])&&(r[0]=e),H.constructAuthorityUriFromObject(t)}getUrlComponents(){var e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw $(Ge);var r={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]},n=r.AbsolutePath.split("/");return n=n.filter(o=>o&&o.length>0),r.PathSegments=n,r.QueryString&&r.QueryString.endsWith("/")&&(r.QueryString=r.QueryString.substring(0,r.QueryString.length-1)),r}static getDomainFromUrl(e){var t=RegExp("^([^:/?#]+://)?([^/?#]*)"),r=e.match(t);if(!r)throw $(Ge);return r[2]}static getAbsoluteUrl(e,t){if(e[0]===C.FORWARD_SLASH){var n=new H(t).getUrlComponents();return n.Protocol+"//"+n.HostNameAndPort+e}return e}static constructAuthorityUriFromObject(e){return new H(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))}static hashContainsKnownProperties(e){return!!Br(e)}}var Kt="pkce_not_created",Ft="crypto_nonexistent",tt="empty_navigate_uri",$r="hash_empty_error",Bt="no_state_in_hash",Gr="hash_does_not_contain_known_properties",qr="unable_to_parse_state",zr="state_interaction_type_mismatch",$t="interaction_in_progress",Qr="popup_window_error",Wr="empty_window_error",ye="user_cancelled",Gt="monitor_window_timeout",Vr="redirect_in_iframe",Yr="block_iframe_reload",jr="block_nested_popups",rt="silent_logout_unsupported",Jr="no_account_error",Xr="no_token_request_cache_error",Zr="unable_to_parse_token_request_cache_error",qt="no_cached_authority_error",nt="non_browser_environment",He="database_not_open",it="no_network_connectivity",zt="post_request_failed",en="get_request_failed",Qt="failed_to_parse_response",tn="unable_to_load_token",Wt="crypto_key_not_found",rn="auth_code_required",nn="auth_code_or_nativeAccountId_required",on="spa_code_and_nativeAccountId_present",Vt="database_unavailable",an="unable_to_acquire_token_from_native_platform",sn="native_handshake_timeout",cn="native_extension_not_installed",qe="native_connection_not_established",ln="uninitialized_public_client_application",dn="native_prompt_not_supported",un="invalid_base64_string",hn="invalid_pop_token_request",Po="failed_to_build_headers",Oo="failed_to_parse_headers",Re="For more visit: aka.ms/msaljs/browser-errors",N={[Kt]:"The PKCE code challenge and verifier could not be generated.",[Ft]:"The crypto object or function is not available.",[tt]:"Navigation URI is empty. Please check stack trace for more info.",[$r]:`Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. ${Re}`,[Bt]:"Hash does not contain state. Please verify that the request originated from msal.",[Gr]:`Hash does not contain known properites. Please verify that your redirectUri is not changing the hash.  ${Re}`,[qr]:"Unable to parse state. Please verify that the request originated from msal.",[zr]:"Hash contains state but the interaction type does not match the caller.",[$t]:`Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.   ${Re}`,[Qr]:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser.",[Wr]:"window.open returned null or undefined window object.",[ye]:"User cancelled the flow.",monitor_popup_timeout:`Token acquisition in popup failed due to timeout.  ${Re}`,[Gt]:`Token acquisition in iframe failed due to timeout.  ${Re}`,[Vr]:"Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs.",[Yr]:`Request was blocked inside an iframe because MSAL detected an authentication response.  ${Re}`,[jr]:"Request was blocked inside a popup because MSAL detected it was running in a popup.",iframe_closed_prematurely:"The iframe being monitored was closed prematurely.",[rt]:"Silent logout not supported. Please call logoutRedirect or logoutPopup instead.",[Jr]:"No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request.",silent_prompt_value_error:"The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'.",[Xr]:"No token request found in cache.",[Zr]:"The cached token request could not be parsed.",[qt]:"No cached authority found.",auth_request_not_set_error:"Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler",invalid_cache_type:"Invalid cache type",[nt]:"Login and token requests are not supported in non-browser environments.",[He]:"Database is not open!",[it]:"No network connectivity. Check your internet connection.",[zt]:"Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA'",[en]:"Network request failed. Please check the network trace to determine root cause.",[Qt]:"Failed to parse network response. Check network trace.",[tn]:"Error loading token to cache.",[Wt]:"Cryptographic Key or Keypair not found in browser storage.",[rn]:"An authorization code must be provided (as the `code` property on the request) to this flow.",[nn]:"An authorization code or nativeAccountId must be provided to this flow.",[on]:"Request cannot contain both spa code and native account id.",[Vt]:"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts.",[an]:`Unable to acquire token from native platform.  ${Re}`,[sn]:"Timed out while attempting to establish connection to browser extension",[cn]:"Native extension is not installed. If you think this is a mistake call the initialize function.",[qe]:`Connection to native platform has not been established. Please install a compatible browser extension and run initialize().  ${Re}`,[ln]:`You must call and await the initialize function before attempting to call any other MSAL API.  ${Re}`,[dn]:"The provided prompt is not supported by the native platform. This request should be routed to the web based flow.",[un]:"Invalid base64 encoded string.",[hn]:"Invalid PoP token request. The request should not have both a popKid value and signPopToken set to true.",[Po]:"Failed to build request headers object.",[Oo]:"Failed to parse response headers"};class Yt extends G{constructor(e,t){super(e,N[e],t),Object.setPrototypeOf(this,Yt.prototype),this.name="BrowserAuthError"}}function w(i,e){return new Yt(i,e)}var k,se={INTERACTION_IN_PROGRESS_VALUE:"interaction_in_progress",INVALID_GRANT_ERROR:"invalid_grant",POPUP_WIDTH:483,POPUP_HEIGHT:600,POPUP_NAME_PREFIX:"msal",DEFAULT_POLL_INTERVAL_MS:30,MSAL_SKU:"msal.js.browser"},ot_CHANNEL_ID="53ee284d-920a-4b59-9d30-a60315b26836",ie_LocalStorage="localStorage",ie_SessionStorage="sessionStorage",ie_MemoryStorage="memoryStorage";!function(i){i.Redirect="redirect",i.Popup="popup",i.Silent="silent",i.None="none"}(k||(k={}));var Mo={scopes:Je},Uo="jwk",ui="msal.db",as=`${ui}.keys`,ss=[0,5,4],g={AcquireTokenByCode:"acquireTokenByCode",AcquireTokenByRefreshToken:"acquireTokenByRefreshToken",AcquireTokenSilent:"acquireTokenSilent",AcquireTokenSilentAsync:"acquireTokenSilentAsync",AcquireTokenPopup:"acquireTokenPopup",AcquireTokenPreRedirect:"acquireTokenPreRedirect",AcquireTokenRedirect:"acquireTokenRedirect",CryptoOptsGetPublicKeyThumbprint:"cryptoOptsGetPublicKeyThumbprint",CryptoOptsSignJwt:"cryptoOptsSignJwt",SilentCacheClientAcquireToken:"silentCacheClientAcquireToken",SilentIframeClientAcquireToken:"silentIframeClientAcquireToken",AwaitConcurrentIframe:"awaitConcurrentIframe",SilentRefreshClientAcquireToken:"silentRefreshClientAcquireToken",SsoSilent:"ssoSilent",StandardInteractionClientGetDiscoveredAuthority:"standardInteractionClientGetDiscoveredAuthority",FetchAccountIdWithNativeBroker:"fetchAccountIdWithNativeBroker",NativeInteractionClientAcquireToken:"nativeInteractionClientAcquireToken",BaseClientCreateTokenRequestHeaders:"baseClientCreateTokenRequestHeaders",NetworkClientSendPostRequestAsync:"networkClientSendPostRequestAsync",RefreshTokenClientExecutePostToTokenEndpoint:"refreshTokenClientExecutePostToTokenEndpoint",AuthorizationCodeClientExecutePostToTokenEndpoint:"authorizationCodeClientExecutePostToTokenEndpoint",BrokerHandhshake:"brokerHandshake",AcquireTokenByRefreshTokenInBroker:"acquireTokenByRefreshTokenInBroker",AcquireTokenByBroker:"acquireTokenByBroker",RefreshTokenClientExecuteTokenRequest:"refreshTokenClientExecuteTokenRequest",RefreshTokenClientAcquireToken:"refreshTokenClientAcquireToken",RefreshTokenClientAcquireTokenWithCachedRefreshToken:"refreshTokenClientAcquireTokenWithCachedRefreshToken",RefreshTokenClientAcquireTokenByRefreshToken:"refreshTokenClientAcquireTokenByRefreshToken",RefreshTokenClientCreateTokenRequestBody:"refreshTokenClientCreateTokenRequestBody",AcquireTokenFromCache:"acquireTokenFromCache",SilentFlowClientAcquireCachedToken:"silentFlowClientAcquireCachedToken",SilentFlowClientGenerateResultFromCacheRecord:"silentFlowClientGenerateResultFromCacheRecord",AcquireTokenBySilentIframe:"acquireTokenBySilentIframe",InitializeBaseRequest:"initializeBaseRequest",InitializeSilentRequest:"initializeSilentRequest",InitializeClientApplication:"initializeClientApplication",SilentIframeClientTokenHelper:"silentIframeClientTokenHelper",SilentHandlerInitiateAuthRequest:"silentHandlerInitiateAuthRequest",SilentHandlerMonitorIframeForHash:"silentHandlerMonitorIframeForHash",SilentHandlerLoadFrame:"silentHandlerLoadFrame",SilentHandlerLoadFrameSync:"silentHandlerLoadFrameSync",StandardInteractionClientCreateAuthCodeClient:"standardInteractionClientCreateAuthCodeClient",StandardInteractionClientGetClientConfiguration:"standardInteractionClientGetClientConfiguration",StandardInteractionClientInitializeAuthorizationRequest:"standardInteractionClientInitializeAuthorizationRequest",StandardInteractionClientInitializeAuthorizationCodeRequest:"standardInteractionClientInitializeAuthorizationCodeRequest",GetAuthCodeUrl:"getAuthCodeUrl",HandleCodeResponseFromServer:"handleCodeResponseFromServer",HandleCodeResponse:"handleCodeResponse",UpdateTokenEndpointAuthority:"updateTokenEndpointAuthority",AuthClientAcquireToken:"authClientAcquireToken",AuthClientExecuteTokenRequest:"authClientExecuteTokenRequest",AuthClientCreateTokenRequestBody:"authClientCreateTokenRequestBody",AuthClientCreateQueryString:"authClientCreateQueryString",PopTokenGenerateCnf:"popTokenGenerateCnf",PopTokenGenerateKid:"popTokenGenerateKid",HandleServerTokenResponse:"handleServerTokenResponse",DeserializeResponse:"deserializeResponse",AuthorityFactoryCreateDiscoveredInstance:"authorityFactoryCreateDiscoveredInstance",AuthorityResolveEndpointsAsync:"authorityResolveEndpointsAsync",AuthorityResolveEndpointsFromLocalSources:"authorityResolveEndpointsFromLocalSources",AuthorityGetCloudDiscoveryMetadataFromNetwork:"authorityGetCloudDiscoveryMetadataFromNetwork",AuthorityUpdateCloudDiscoveryMetadata:"authorityUpdateCloudDiscoveryMetadata",AuthorityGetEndpointMetadataFromNetwork:"authorityGetEndpointMetadataFromNetwork",AuthorityUpdateEndpointMetadata:"authorityUpdateEndpointMetadata",AuthorityUpdateMetadataWithRegionalInformation:"authorityUpdateMetadataWithRegionalInformation",RegionDiscoveryDetectRegion:"regionDiscoveryDetectRegion",RegionDiscoveryGetRegionFromIMDS:"regionDiscoveryGetRegionFromIMDS",RegionDiscoveryGetCurrentVersion:"regionDiscoveryGetCurrentVersion",AcquireTokenByCodeAsync:"acquireTokenByCodeAsync",GetEndpointMetadataFromNetwork:"getEndpointMetadataFromNetwork",GetCloudDiscoveryMetadataFromNetworkMeasurement:"getCloudDiscoveryMetadataFromNetworkMeasurement",HandleRedirectPromiseMeasurement:"handleRedirectPromise",HandleNativeRedirectPromiseMeasurement:"handleNativeRedirectPromise",UpdateCloudDiscoveryMetadataMeasurement:"updateCloudDiscoveryMetadataMeasurement",UsernamePasswordClientAcquireToken:"usernamePasswordClientAcquireToken",NativeMessageHandlerHandshake:"nativeMessageHandlerHandshake",NativeGenerateAuthResult:"nativeGenerateAuthResult",RemoveHiddenIframe:"removeHiddenIframe",ClearTokensAndKeysWithClaims:"clearTokensAndKeysWithClaims",CacheManagerGetRefreshToken:"cacheManagerGetRefreshToken",GeneratePkceCodes:"generatePkceCodes",GenerateCodeVerifier:"generateCodeVerifier",GenerateCodeChallengeFromVerifier:"generateCodeChallengeFromVerifier",Sha256Digest:"sha256Digest",GetRandomValues:"getRandomValues"};function fn(i){return encodeURIComponent(hi(i).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function pn(i){return Do(i).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function hi(i){return Do((new TextEncoder).encode(i))}function Do(i){var e=Array.from(i,t=>String.fromCodePoint(t)).join("");return btoa(e)}var Lo="SHA-256",gs=new Uint8Array([1,0,1]),Ho="0123456789abcdef",xo=new Uint32Array(1),gi={name:"RSASSA-PKCS1-v1_5",hash:Lo,modulusLength:2048,publicExponent:gs};function Ko(i,e,t){return fi.apply(this,arguments)}function fi(){return fi=(0,p.A)(function*(i,e,t){e?.addQueueMeasurement(g.Sha256Digest,t);var n=(new TextEncoder).encode(i);return window.crypto.subtle.digest(Lo,n)}),fi.apply(this,arguments)}function ms(i){return window.crypto.getRandomValues(i)}function pi(){return window.crypto.getRandomValues(xo),xo[0]}function ke(){var i=Date.now(),e=1024*pi()+(1023&pi()),t=new Uint8Array(16),r=Math.trunc(e/2**30),n=e&2**30-1,o=pi();t[0]=i/2**40,t[1]=i/2**32,t[2]=i/2**24,t[3]=i/65536,t[4]=i/256,t[5]=i,t[6]=112|r>>>8,t[7]=r,t[8]=128|n>>>24,t[9]=n>>>16,t[10]=n>>>8,t[11]=n,t[12]=o>>>24,t[13]=o>>>16,t[14]=o>>>8,t[15]=o;for(var a="",s=0;s<t.length;s++)a+=Ho.charAt(t[s]>>>4),a+=Ho.charAt(15&t[s]),(3===s||5===s||7===s||9===s)&&(a+="-");return a}function mi(){return mi=(0,p.A)(function*(i,e){return window.crypto.subtle.generateKey(gi,i,e)}),mi.apply(this,arguments)}function vi(i){return Ci.apply(this,arguments)}function Ci(){return Ci=(0,p.A)(function*(i){return window.crypto.subtle.exportKey(Uo,i)}),Ci.apply(this,arguments)}function yi(){return yi=(0,p.A)(function*(i,e,t){return window.crypto.subtle.importKey(Uo,i,gi,e,t)}),yi.apply(this,arguments)}function Ai(){return Ai=(0,p.A)(function*(i,e){return window.crypto.subtle.sign(gi,i,e)}),Ai.apply(this,arguments)}function Fo(i){return Ti.apply(this,arguments)}function Ti(){return Ti=(0,p.A)(function*(i){var e=yield Ko(i);return pn(new Uint8Array(e))}),Ti.apply(this,arguments)}var at="storage_not_supported",jt="in_mem_redirect_unavailable",mn={[at]:"Given storage configuration option was not supported.",stubbed_public_client_application_called:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors",[jt]:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."};class Ei extends G{constructor(e,t){super(e,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,Ei.prototype)}}function Si(i){return new Ei(i,mn[i])}function vn(){return window.parent!==window}function be(){return window.location.href.split("?")[0].split("#")[0]}function Bo(){if(typeof window>"u")throw w(nt)}function $o(i){if(!i)throw w(ln)}function _i(i){Bo(),function(){if(H.hashContainsKnownProperties(window.location.hash)&&vn())throw w(Yr)}(),function(){if(typeof window<"u"&&window.opener&&window.opener!==window&&"string"==typeof window.name&&0===window.name.indexOf(`${se.POPUP_NAME_PREFIX}.`))throw w(jr)}(),$o(i)}function Go(i,e){if(_i(i),function(i){if(vn()&&!i)throw w(Vr)}(e.system.allowRedirectInIframe),e.cache.cacheLocation===ie_MemoryStorage&&!e.cache.storeAuthStateInCookie)throw Si(jt)}function qo(i){var e=document.createElement("link");e.rel="preconnect",e.href=new URL(i).origin,e.crossOrigin="anonymous",document.head.appendChild(e),window.setTimeout(()=>{try{document.head.removeChild(e)}catch{}},1e4)}var ks=_(390),bs=_(728),Ps=_(636),Os=_(913),Ns=_(353),Ms=_(483);class Us extends ks.B7{constructor(e=Number.POSITIVE_INFINITY,t=Number.POSITIVE_INFINITY,r){super(),this.scheduler=r,this._events=[],this._infiniteTimeWindow=!1,this._bufferSize=e<1?1:e,this._windowTime=t<1?1:t,t===Number.POSITIVE_INFINITY?(this._infiniteTimeWindow=!0,this.next=this.nextInfiniteTimeWindow):this.next=this.nextTimeWindow}nextInfiniteTimeWindow(e){if(!this.isStopped){var t=this._events;t.push(e),t.length>this._bufferSize&&t.shift()}super.next(e)}nextTimeWindow(e){this.isStopped||(this._events.push(new Ds(this._getNow(),e)),this._trimBufferThenGetEvents()),super.next(e)}_subscribe(e){var a,t=this._infiniteTimeWindow,r=t?this._events:this._trimBufferThenGetEvents(),n=this.scheduler,o=r.length;if(this.closed)throw new Ns.P;if(this.isStopped||this.hasError?a=Ps.y.EMPTY:(this.observers.push(e),a=new Ms.Y(this,e)),n&&e.add(e=new Os.YZ(e,n)),t)for(var s=0;s<o&&!e.closed;s++)e.next(r[s]);else for(var c=0;c<o&&!e.closed;c++)e.next(r[c].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),a}_getNow(){return(this.scheduler||bs.g).now()}_trimBufferThenGetEvents(){for(var e=this._getNow(),t=this._bufferSize,r=this._windowTime,n=this._events,o=n.length,a=0;a<o&&!(e-n[a].time<r);)a++;return o>t&&(a=Math.max(a,o-t)),a>0&&n.splice(0,a),n}}class Ds{constructor(e,t){this.time=e,this.value=t}}var Ls=_(26),Ks=new(_(163).q)(Ls.R),Bs=_(362),zo=_(106);class Gs{constructor(e,t){this.delay=e,this.scheduler=t}call(e,t){return t.subscribe(new wi(e,this.delay,this.scheduler))}}class wi extends Bs.v{constructor(e,t,r){super(e),this.delay=t,this.scheduler=r,this.queue=[],this.active=!1,this.errored=!1}static dispatch(e){for(var t=e.source,r=t.queue,n=e.scheduler,o=e.destination;r.length>0&&r[0].time-n.now()<=0;)r.shift().notification.observe(o);if(r.length>0){var a=Math.max(0,r[0].time-n.now());this.schedule(e,a)}else this.unsubscribe(),t.active=!1}_schedule(e){this.active=!0,this.destination.add(e.schedule(wi.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))}scheduleNotification(e){if(!0!==this.errored){var t=this.scheduler,r=new qs(t.now()+this.delay,e);this.queue.push(r),!1===this.active&&this._schedule(t)}}_next(e){this.scheduleNotification(zo.E.createNext(e))}_error(e){this.errored=!0,this.queue=[],this.destination.error(e),this.unsubscribe()}_complete(){this.scheduleNotification(zo.E.createComplete()),this.unsubscribe()}}class qs{constructor(e,t){this.time=e,this.notification=t}}var Ke=window,Jt=function(i){return i.UserInteractionRequired="User interaction is required.",i.UserNotSignedIn="User is not signed in.",i.UserInteractionDeclined="User interaction is declined.",i.UserAccountChanged="User account has changed.",i.FallbackToRedirection="Failed to get token silently, using redirection as fallback.",i.NoNetworkMessage="No network connectivity. Check your internet connection.",i.FalsyAccessToken="Access token is empty or undefined.",i}({}),Ri="FabricSignedInFlag",Qo="[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}",zs=[/^msal\./,/^server-telemetry-/,new RegExp(`^${Qo}.${Qo}-`,"i")],Ae=function(i){return i[i.Low=-1]="Low",i[i.Medium=0]="Medium",i[i.High=1]="High",i}({}),Wo=[...zs.map(i=>({pattern:i,priority:Ae.High})),{pattern:Ri,priority:Ae.High},{pattern:"multitaskingTabs",priority:Ae.Medium},{pattern:"AI_sentBuffer",priority:Ae.Low},{pattern:"AI_buffer",priority:Ae.Low}],Vo=[],ki=new Map,Qs={localStorage:Vo,sessionStorage:Wo};(()=>{var i=function(){var r={keyNameToPriorityMap:new Map,keyPatternToPriorityArray:new Array,lowPriorityKeyNames:[],lowPriorityKeyPatterns:[]};t.forEach(n=>{"string"==typeof n.pattern?(r.keyNameToPriorityMap.set(n.pattern,n.priority),n.priority===Ae.Low&&r.lowPriorityKeyNames.push(n.pattern)):(r.keyPatternToPriorityArray.push({pattern:n.pattern,priority:n.priority}),n.priority===Ae.Low&&r.lowPriorityKeyPatterns.push(n.pattern))}),ki.set(e,r)};for(var[e,t]of Object.entries(Qs))i()})();var B,Yo=(i,e)=>{var t=e===localStorage?"localStorage":"sessionStorage",r=ki.get(t);return r?r.keyNameToPriorityMap.get(i)??r.keyPatternToPriorityArray.find(n=>n.pattern.test(i))?.priority??Ae.Medium:Ae.Medium};class Cn{constructor(){this.storageEventSubject=new Us(20),this.storageEvent$=this.storageEventSubject.pipe(function(i,e=Ks){var t=function(i){return i instanceof Date&&!isNaN(+i)}(i),r=t?+i-e.now():Math.abs(i);return n=>n.lift(new Gs(r,e))}(0))}static init(){if(Ke.webStorageManagementEnabled&&!Ke.webStorageManager){var e=Ke.webStorageManager=new Cn;if(Wo.length>0)try{e.applyMgmtToStorage(sessionStorage)}catch(t){e.storageEventSubject.next({type:"overrideFail",storage:"sessionStorage",err:t})}if(Vo.length>0)try{e.applyMgmtToStorage(localStorage)}catch(t){e.storageEventSubject.next({type:"overrideFail",storage:"localStorage",err:t})}}}static getInstance(){return Ke.webStorageManager||Cn.init(),Ke.webStorageManager}applyMgmtToStorage(e){var t=e.setItem,r=[];e.setItem=(n,o)=>{try{t.call(e,n,o),this.storageEventSubject.next({type:"setItemSuccess",storage:e,key:n,removedItems:[...r]}),r.length=0}catch(s){if((i=>"QuotaExceededError"===i?.name)(s)&&r.length<5&&(r.length>0||Yo(n,e)>0)){var a=(i=>{var e=i===localStorage?"localStorage":"sessionStorage",t=ki.get(e);if(!t)return null;for(var r of t.lowPriorityKeyNames)if(i.hasOwnProperty(r))return r;var n=Object.keys(i);for(var o of t.lowPriorityKeyPatterns)for(var a of n)if(o.test(a))return a;var s=n.filter(u=>Yo(u,i)===Ae.Medium);if(s.length>0){var c=0,l="";for(var d of s.slice(0,20)){var h=d.length+(i.getItem(d)?.length||0);h>c&&(c=h,l=d)}return l}return null})(e);if(a)return e.removeItem(a),r.push(a),void e.setItem(n,o)}throw this.storageEventSubject.next({type:"setItemFail",storage:e,key:n,removedItems:[...r],err:s}),r.length=0,s}}}}!function(i){i[i.Error=0]="Error",i[i.Warning=1]="Warning",i[i.Info=2]="Info",i[i.Verbose=3]="Verbose",i[i.Trace=4]="Trace"}(B||(B={}));class Fe{constructor(e,t,r){this.level=B.Info;var o=e||Fe.createDefaultLoggerOptions();this.localCallback=o.loggerCallback||(()=>{}),this.piiLoggingEnabled=o.piiLoggingEnabled||!1,this.level="number"==typeof o.logLevel?o.logLevel:B.Info,this.correlationId=o.correlationId||C.EMPTY_STRING,this.packageName=t||C.EMPTY_STRING,this.packageVersion=r||C.EMPTY_STRING}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:B.Info}}clone(e,t,r){return new Fe({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:r||this.correlationId},e,t)}logMessage(e,t){if(!(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)){var r=(new Date).toUTCString();this.executeCallback(t.logLevel,`[${r}] : [${t.correlationId||this.correlationId||""}] : ${this.packageName}@${this.packageVersion} : ${B[t.logLevel]} - ${e}`,t.containsPii||!1)}}executeCallback(e,t,r){this.localCallback&&this.localCallback(e,t,r)}error(e,t){this.logMessage(e,{logLevel:B.Error,containsPii:!1,correlationId:t||C.EMPTY_STRING})}errorPii(e,t){this.logMessage(e,{logLevel:B.Error,containsPii:!0,correlationId:t||C.EMPTY_STRING})}warning(e,t){this.logMessage(e,{logLevel:B.Warning,containsPii:!1,correlationId:t||C.EMPTY_STRING})}warningPii(e,t){this.logMessage(e,{logLevel:B.Warning,containsPii:!0,correlationId:t||C.EMPTY_STRING})}info(e,t){this.logMessage(e,{logLevel:B.Info,containsPii:!1,correlationId:t||C.EMPTY_STRING})}infoPii(e,t){this.logMessage(e,{logLevel:B.Info,containsPii:!0,correlationId:t||C.EMPTY_STRING})}verbose(e,t){this.logMessage(e,{logLevel:B.Verbose,containsPii:!1,correlationId:t||C.EMPTY_STRING})}verbosePii(e,t){this.logMessage(e,{logLevel:B.Verbose,containsPii:!0,correlationId:t||C.EMPTY_STRING})}trace(e,t){this.logMessage(e,{logLevel:B.Trace,containsPii:!1,correlationId:t||C.EMPTY_STRING})}tracePii(e,t){this.logMessage(e,{logLevel:B.Trace,containsPii:!0,correlationId:t||C.EMPTY_STRING})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}}var yn={createNewGuid:()=>{throw A(U)},base64Decode:()=>{throw A(U)},base64Encode:()=>{throw A(U)},base64UrlEncode:()=>{throw A(U)},encodeKid:()=>{throw A(U)},getPublicKeyThumbprint:()=>(0,p.A)(function*(){throw A(U)})(),removeTokenBindingKey:()=>(0,p.A)(function*(){throw A(U)})(),clearKeystore:()=>(0,p.A)(function*(){throw A(U)})(),signJwt:()=>(0,p.A)(function*(){throw A(U)})(),hashString:()=>(0,p.A)(function*(){throw A(U)})()},jo="@azure/msal-common",Pi="14.16.0";function Qe(i,e){var t=function(i){if(!i)throw A(_r);var t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(i);if(!t||t.length<4)throw A(bt);return t[2]}(i);try{var r=e(t);return JSON.parse(r)}catch{throw A(bt)}}function Jo(i,e){if(0===e||Date.now()-3e5>i+e)throw A(Pr)}function Te(){return Math.round((new Date).getTime()/1e3)}function Oi(i,e){var t=Number(i)||0;return Te()+e>t}function st(i){return[Xs(i),Zs(i),ec(i),tc(i),rc(i)].join(te.CACHE_KEY_SEPARATOR).toLowerCase()}function An(i,e,t,r,n){return{credentialType:P.ID_TOKEN,homeAccountId:i,environment:e,clientId:r,secret:t,realm:n}}function Tn(i,e,t,r,n,o,a,s,c,l,d,h,u,f,m){var v={homeAccountId:i,credentialType:P.ACCESS_TOKEN,secret:t,cachedAt:Te().toString(),expiresOn:a.toString(),extendedExpiresOn:s.toString(),environment:e,clientId:r,realm:n,target:o,tokenType:d||F.BEARER};if(h&&(v.userAssertionHash=h),l&&(v.refreshOn=l.toString()),f&&(v.requestedClaims=f,v.requestedClaimsHash=m),v.tokenType?.toLowerCase()!==F.BEARER.toLowerCase())switch(v.credentialType=P.ACCESS_TOKEN_WITH_AUTH_SCHEME,v.tokenType){case F.POP:var S=Qe(t,c);if(!S?.cnf?.kid)throw A(Lr);v.keyId=S.cnf.kid;break;case F.SSH:v.keyId=u}return v}function Xo(i,e,t,r,n,o,a){var s={credentialType:P.REFRESH_TOKEN,homeAccountId:i,environment:e,clientId:r,secret:t};return o&&(s.userAssertionHash=o),n&&(s.familyId=n),a&&(s.expiresOn=a.toString()),s}function Ni(i){return i.hasOwnProperty("homeAccountId")&&i.hasOwnProperty("environment")&&i.hasOwnProperty("credentialType")&&i.hasOwnProperty("clientId")&&i.hasOwnProperty("secret")}function Zo(i){return!!i&&Ni(i)&&i.hasOwnProperty("realm")&&i.hasOwnProperty("target")&&(i.credentialType===P.ACCESS_TOKEN||i.credentialType===P.ACCESS_TOKEN_WITH_AUTH_SCHEME)}function ea(i){return!!i&&Ni(i)&&i.hasOwnProperty("realm")&&i.credentialType===P.ID_TOKEN}function ta(i){return!!i&&Ni(i)&&i.credentialType===P.REFRESH_TOKEN}function Xs(i){return[i.homeAccountId,i.environment].join(te.CACHE_KEY_SEPARATOR).toLowerCase()}function Zs(i){return[i.credentialType,i.credentialType===P.REFRESH_TOKEN&&i.familyId||i.clientId,i.realm||""].join(te.CACHE_KEY_SEPARATOR).toLowerCase()}function ec(i){return(i.target||"").toLowerCase()}function tc(i){return(i.requestedClaimsHash||"").toLowerCase()}function rc(i){return i.tokenType&&i.tokenType.toLowerCase()!==F.BEARER.toLowerCase()?i.tokenType.toLowerCase():""}function ra(){return Te()+86400}function In(i,e,t){i.authorization_endpoint=e.authorization_endpoint,i.token_endpoint=e.token_endpoint,i.end_session_endpoint=e.end_session_endpoint,i.issuer=e.issuer,i.endpointsFromNetwork=t,i.jwks_uri=e.jwks_uri}function Mi(i,e,t){i.aliases=e.aliases,i.preferred_cache=e.preferred_cache,i.preferred_network=e.preferred_network,i.aliasesFromNetwork=t}function na(i){return i.expiresAt<=Te()}class W{constructor(e){var t=e?he.trimArrayEntries([...e]):[],r=t?he.removeEmptyStringsFromArray(t):[];this.validateInputScopes(r),this.scopes=new Set,r.forEach(n=>this.scopes.add(n))}static fromString(e){var r=(e||C.EMPTY_STRING).split(" ");return new W(r)}static createSearchScopes(e){var t=new W(e);return t.containsOnlyOIDCScopes()?t.removeScope(C.OFFLINE_ACCESS_SCOPE):t.removeOIDCScopes(),t}validateInputScopes(e){if(!e||e.length<1)throw $(fr)}containsScope(e){var t=this.printScopesLowerCase().split(" "),r=new W(t);return!!e&&r.scopes.has(e.toLowerCase())}containsScopeSet(e){return!(!e||e.scopes.size<=0)&&this.scopes.size>=e.scopes.size&&e.asArray().every(t=>this.containsScope(t))}containsOnlyOIDCScopes(){var e=0;return Eo.forEach(t=>{this.containsScope(t)&&(e+=1)}),this.scopes.size===e}appendScope(e){e&&this.scopes.add(e.trim())}appendScopes(e){try{e.forEach(t=>this.appendScope(t))}catch{throw A(Ur)}}removeScope(e){if(!e)throw A(Mr);this.scopes.delete(e.trim())}removeOIDCScopes(){Eo.forEach(e=>{this.scopes.delete(e)})}unionScopeSets(e){if(!e)throw A(Nt);var t=new Set;return e.scopes.forEach(r=>t.add(r.toLowerCase())),this.scopes.forEach(r=>t.add(r.toLowerCase())),t}intersectingScopeSets(e){if(!e)throw A(Nt);e.containsOnlyOIDCScopes()||e.removeOIDCScopes();var t=this.unionScopeSets(e),r=e.getScopeCount(),n=this.getScopeCount();return t.size<n+r}getScopeCount(){return this.scopes.size}asArray(){var e=[];return this.scopes.forEach(t=>e.push(t)),e}printScopes(){return this.scopes?this.asArray().join(" "):C.EMPTY_STRING}printScopesLowerCase(){return this.printScopes().toLowerCase()}}function En(i,e){if(!i)throw A(Sr);try{var t=e(i);return JSON.parse(t)}catch{throw A(kt)}}function ct(i){if(!i)throw A(kt);var e=i.split(te.CLIENT_INFO_SEPARATOR,2);return{uid:e[0],utid:e.length<2?C.EMPTY_STRING:e[1]}}function Sn(i,e){return!!i&&!!e&&i===e.split(".")[1]}function Ui(i,e,t,r){if(r){var{oid:n,sub:o,tid:a,name:s,tfp:c,acr:l}=r,d=a||c||l||"";return{tenantId:d,localAccountId:n||o||"",name:s,isHomeTenant:Sn(d,i)}}return{tenantId:t,localAccountId:e,isHomeTenant:Sn(t,i)}}function Di(i,e,t,r){var n=i;if(e){var{isHomeTenant:o,...a}=e;n={...i,...a}}if(t){var{isHomeTenant:s,...c}=Ui(i.homeAccountId,i.localAccountId,i.tenantId,t);return{...n,...c,idTokenClaims:t,idToken:r}}return n}function ia(i){return i&&(i.tid||i.tfp||i.acr)||null}class Y{generateAccountId(){return[this.homeAccountId,this.environment].join(te.CACHE_KEY_SEPARATOR).toLowerCase()}generateAccountKey(){return Y.generateAccountCacheKey({homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId})}getAccountInfo(){return{homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId,name:this.name,nativeAccountId:this.nativeAccountId,authorityType:this.authorityType,tenantProfiles:new Map((this.tenantProfiles||[]).map(e=>[e.tenantId,e]))}}isSingleTenant(){return!this.tenantProfiles}static generateAccountCacheKey(e){var t=e.homeAccountId.split(".")[1];return[e.homeAccountId,e.environment||"",t||e.tenantId||""].join(te.CACHE_KEY_SEPARATOR).toLowerCase()}static createAccount(e,t,r){var o,n=new Y;n.authorityType=1===t.authorityType?"ADFS":"AAD"===t.protocolMode?"MSSTS":"Generic",e.clientInfo&&r&&(o=En(e.clientInfo,r)),n.clientInfo=e.clientInfo,n.homeAccountId=e.homeAccountId,n.nativeAccountId=e.nativeAccountId;var a=e.environment||t&&t.getPreferredCache();if(!a)throw A(Ut);if(n.environment=a,n.realm=o?.utid||ia(e.idTokenClaims)||"",n.localAccountId=o?.uid||e.idTokenClaims?.oid||e.idTokenClaims?.sub||"",n.username=e.idTokenClaims?.preferred_username||e.idTokenClaims?.upn||(e.idTokenClaims?.emails?e.idTokenClaims.emails[0]:null)||"",n.name=e.idTokenClaims?.name||"",n.cloudGraphHostName=e.cloudGraphHostName,n.msGraphHost=e.msGraphHost,e.tenantProfiles)n.tenantProfiles=e.tenantProfiles;else{var l=Ui(e.homeAccountId,n.localAccountId,n.realm,e.idTokenClaims);n.tenantProfiles=[l]}return n}static createFromAccountInfo(e,t,r){var n=new Y;return n.authorityType=e.authorityType||"Generic",n.homeAccountId=e.homeAccountId,n.localAccountId=e.localAccountId,n.nativeAccountId=e.nativeAccountId,n.realm=e.tenantId,n.environment=e.environment,n.username=e.username,n.name=e.name,n.cloudGraphHostName=t,n.msGraphHost=r,n.tenantProfiles=Array.from(e.tenantProfiles?.values()||[]),n}static generateHomeAccountId(e,t,r,n,o){if(1!==t&&2!==t){if(e)try{var a=En(e,n.base64Decode);if(a.uid&&a.utid)return`${a.uid}.${a.utid}`}catch{}r.warning("No client info in response")}return o?.sub||""}static isAccountEntity(e){return!!e&&e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("localAccountId")&&e.hasOwnProperty("username")&&e.hasOwnProperty("authorityType")}static accountInfoIsEqual(e,t,r){if(!e||!t)return!1;var n=!0;if(r){var o=e.idTokenClaims||{},a=t.idTokenClaims||{};n=o.iat===a.iat&&o.nonce===a.nonce}return e.homeAccountId===t.homeAccountId&&e.localAccountId===t.localAccountId&&e.username===t.username&&e.tenantId===t.tenantId&&e.environment===t.environment&&e.nativeAccountId===t.nativeAccountId&&n}}var aa={"login.microsoftonline.com":{token_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.com/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/logout"},"login.chinacloudapi.cn":{token_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.chinacloudapi.cn/{tenantid}/discovery/v2.0/keys",issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",authorization_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/logout"},"login.microsoftonline.us":{token_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.us/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/logout"}},Li={tenant_discovery_endpoint:"https://{canonicalAuthority}/v2.0/.well-known/openid-configuration",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},sa=new Set;function ca(i,e,t,r){if(r?.trace(`getAliasesFromMetadata called with source: ${t}`),i&&e){var n=_n(e,i);if(n)return r?.trace(`getAliasesFromMetadata: found cloud discovery metadata in ${t}, returning aliases`),n.aliases;r?.trace(`getAliasesFromMetadata: did not find cloud discovery metadata in ${t}`)}return null}function _n(i,e){for(var t=0;t<i.length;t++){var r=i[t];if(r.aliases.includes(e))return r}return null}Li.metadata.forEach(i=>{i.aliases.forEach(e=>{sa.add(e)})});var la="cache_quota_exceeded",Hi="cache_error_unknown",xi={[la]:"Exceeded cache storage capacity.",[Hi]:"Unexpected error occurred when using cache storage."};class lt extends Error{constructor(e,t){var r=t||(xi[e]?xi[e]:xi[Hi]);super(`${e}: ${r}`),Object.setPrototypeOf(this,lt.prototype),this.name="CacheError",this.errorCode=e,this.errorMessage=r}}class dt{constructor(e,t,r,n){this.clientId=e,this.cryptoImpl=t,this.commonLogger=r.clone(jo,Pi),this.staticAuthorityOptions=n}getAllAccounts(e){return this.buildTenantProfiles(this.getAccountsFilteredBy(e||{}),e)}getAccountInfoFilteredBy(e){var t=this.getAllAccounts(e);return t.length>1?t.sort(n=>n.idTokenClaims?-1:1)[0]:1===t.length?t[0]:null}getBaseAccountInfo(e){var t=this.getAccountsFilteredBy(e);return t.length>0?t[0].getAccountInfo():null}buildTenantProfiles(e,t){return e.flatMap(r=>this.getTenantProfilesFromAccountEntity(r,t?.tenantId,t))}getTenantedAccountInfoByFilter(e,t,r,n){var a;if(n&&!this.tenantProfileMatchesFilter(r,n))return null;var s=this.getIdToken(e,t,r.tenantId);return s&&(a=Qe(s.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(a,n))?null:Di(e,r,a,s?.secret)}getTenantProfilesFromAccountEntity(e,t,r){var n=e.getAccountInfo(),o=n.tenantProfiles||new Map,a=this.getTokenKeys();if(t){var s=o.get(t);if(!s)return[];o=new Map([[t,s]])}var c=[];return o.forEach(l=>{var d=this.getTenantedAccountInfoByFilter(n,a,l,r);d&&c.push(d)}),c}tenantProfileMatchesFilter(e,t){return!(t.localAccountId&&!this.matchLocalAccountIdFromTenantProfile(e,t.localAccountId)||t.name&&e.name!==t.name||void 0!==t.isHomeTenant&&e.isHomeTenant!==t.isHomeTenant)}idTokenClaimsMatchTenantProfileFilter(e,t){return!(t&&(t.localAccountId&&!this.matchLocalAccountIdFromTokenClaims(e,t.localAccountId)||t.loginHint&&!this.matchLoginHintFromTokenClaims(e,t.loginHint)||t.username&&!this.matchUsername(e.preferred_username,t.username)||t.name&&!this.matchName(e,t.name)||t.sid&&!this.matchSid(e,t.sid)))}saveCacheRecord(e,t,r){var n=this;return(0,p.A)(function*(){if(!e)throw A(Dr);try{e.account&&n.setAccount(e.account),e.idToken&&!1!==t?.idToken&&n.setIdTokenCredential(e.idToken),e.accessToken&&!1!==t?.accessToken&&(yield n.saveAccessToken(e.accessToken)),e.refreshToken&&!1!==t?.refreshToken&&n.setRefreshTokenCredential(e.refreshToken),e.appMetadata&&n.setAppMetadata(e.appMetadata)}catch(o){throw n.commonLogger?.error("CacheManager.saveCacheRecord: failed"),o instanceof Error?(n.commonLogger?.errorPii(`CacheManager.saveCacheRecord: ${o.message}`,r),"QuotaExceededError"===o.name||"NS_ERROR_DOM_QUOTA_REACHED"===o.name||o.message.includes("exceeded the quota")?(n.commonLogger?.error("CacheManager.saveCacheRecord: exceeded storage quota",r),new lt(la)):new lt(o.name,o.message)):(n.commonLogger?.errorPii(`CacheManager.saveCacheRecord: ${o}`,r),new lt(Hi))}})()}saveAccessToken(e){var t=this;return(0,p.A)(function*(){var r={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType,requestedClaimsHash:e.requestedClaimsHash},n=t.getTokenKeys(),o=W.fromString(e.target),a=[];n.accessToken.forEach(s=>{if(t.accessTokenKeyMatchesFilter(s,r,!1)){var c=t.getAccessTokenCredential(s);c&&t.credentialMatchesFilter(c,r)&&W.fromString(c.target).intersectingScopeSets(o)&&a.push(t.removeAccessToken(s))}}),yield Promise.all(a),t.setAccessTokenCredential(e)})()}getAccountsFilteredBy(e){var t=this.getAccountKeys(),r=[];return t.forEach(n=>{if(this.isAccountKey(n,e.homeAccountId)){var o=this.getAccount(n,this.commonLogger);if(o&&(!e.homeAccountId||this.matchHomeAccountId(o,e.homeAccountId))&&(!e.username||this.matchUsername(o.username,e.username))&&(!e.environment||this.matchEnvironment(o,e.environment))&&(!e.realm||this.matchRealm(o,e.realm))&&(!e.nativeAccountId||this.matchNativeAccountId(o,e.nativeAccountId))&&(!e.authorityType||this.matchAuthorityType(o,e.authorityType))){var a={localAccountId:e?.localAccountId,name:e?.name},s=o.tenantProfiles?.filter(c=>this.tenantProfileMatchesFilter(c,a));s&&0===s.length||r.push(o)}}}),r}isAccountKey(e,t,r){return!(e.split(te.CACHE_KEY_SEPARATOR).length<3||t&&!e.toLowerCase().includes(t.toLowerCase())||r&&!e.toLowerCase().includes(r.toLowerCase()))}isCredentialKey(e){if(e.split(te.CACHE_KEY_SEPARATOR).length<6)return!1;var t=e.toLowerCase();if(-1===t.indexOf(P.ID_TOKEN.toLowerCase())&&-1===t.indexOf(P.ACCESS_TOKEN.toLowerCase())&&-1===t.indexOf(P.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase())&&-1===t.indexOf(P.REFRESH_TOKEN.toLowerCase()))return!1;if(t.indexOf(P.REFRESH_TOKEN.toLowerCase())>-1){var n=`${P.REFRESH_TOKEN}${te.CACHE_KEY_SEPARATOR}1${te.CACHE_KEY_SEPARATOR}`;if(-1===t.indexOf(`${P.REFRESH_TOKEN}${te.CACHE_KEY_SEPARATOR}${this.clientId}${te.CACHE_KEY_SEPARATOR}`.toLowerCase())&&-1===t.indexOf(n.toLowerCase()))return!1}else if(-1===t.indexOf(this.clientId.toLowerCase()))return!1;return!0}credentialMatchesFilter(e,t){return!(t.clientId&&!this.matchClientId(e,t.clientId)||t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash)||"string"==typeof t.homeAccountId&&!this.matchHomeAccountId(e,t.homeAccountId)||t.environment&&!this.matchEnvironment(e,t.environment)||t.realm&&!this.matchRealm(e,t.realm)||t.credentialType&&!this.matchCredentialType(e,t.credentialType)||t.familyId&&!this.matchFamilyId(e,t.familyId)||t.target&&!this.matchTarget(e,t.target)||(t.requestedClaimsHash||e.requestedClaimsHash)&&e.requestedClaimsHash!==t.requestedClaimsHash||e.credentialType===P.ACCESS_TOKEN_WITH_AUTH_SCHEME&&(t.tokenType&&!this.matchTokenType(e,t.tokenType)||t.tokenType===F.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId)))}getAppMetadataFilteredBy(e){var t=this.getKeys(),r={};return t.forEach(n=>{if(this.isAppMetadata(n)){var o=this.getAppMetadata(n);o&&(e.environment&&!this.matchEnvironment(o,e.environment)||e.clientId&&!this.matchClientId(o,e.clientId)||(r[n]=o))}}),r}getAuthorityMetadataByAlias(e){var t=this.getAuthorityMetadataKeys(),r=null;return t.forEach(n=>{if(this.isAuthorityMetadata(n)&&-1!==n.indexOf(this.clientId)){var o=this.getAuthorityMetadata(n);o&&-1!==o.aliases.indexOf(e)&&(r=o)}}),r}removeAllAccounts(){var e=this;return(0,p.A)(function*(){var t=e.getAccountKeys(),r=[];t.forEach(n=>{r.push(e.removeAccount(n))}),yield Promise.all(r)})()}removeAccount(e){var t=this;return(0,p.A)(function*(){var r=t.getAccount(e,t.commonLogger);r&&(yield t.removeAccountContext(r),t.removeItem(e))})()}removeAccountContext(e){var t=this;return(0,p.A)(function*(){var r=t.getTokenKeys(),n=e.generateAccountId(),o=[];r.idToken.forEach(a=>{0===a.indexOf(n)&&t.removeIdToken(a)}),r.accessToken.forEach(a=>{0===a.indexOf(n)&&o.push(t.removeAccessToken(a))}),r.refreshToken.forEach(a=>{0===a.indexOf(n)&&t.removeRefreshToken(a)}),yield Promise.all(o)})()}updateOutdatedCachedAccount(e,t,r){if(t&&t.isSingleTenant()){this.commonLogger?.verbose("updateOutdatedCachedAccount: Found a single-tenant (outdated) account entity in the cache, migrating to multi-tenant account entity");var n=this.getAccountKeys().filter(l=>l.startsWith(t.homeAccountId)),o=[];n.forEach(l=>{var d=this.getCachedAccountEntity(l);d&&o.push(d)});var a=o.find(l=>Sn(l.realm,l.homeAccountId))||o[0];a.tenantProfiles=o.map(l=>({tenantId:l.realm,localAccountId:l.localAccountId,name:l.name,isHomeTenant:Sn(l.realm,l.homeAccountId)}));var s=dt.toObject(new Y,{...a}),c=s.generateAccountKey();return n.forEach(l=>{l!==c&&this.removeOutdatedAccount(e)}),this.setAccount(s),r?.verbose("Updated an outdated account entity in the cache"),s}return t}removeAccessToken(e){var t=this;return(0,p.A)(function*(){var r=t.getAccessTokenCredential(e);if(r){if(r.credentialType.toLowerCase()===P.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()&&r.tokenType===F.POP){var o=r.keyId;if(o)try{yield t.cryptoImpl.removeTokenBindingKey(o)}catch{throw A(xr)}}return t.removeItem(e)}})()}removeAppMetadata(){return this.getKeys().forEach(t=>{this.isAppMetadata(t)&&this.removeItem(t)}),!0}readAccountFromCache(e){var t=Y.generateAccountCacheKey(e);return this.getAccount(t,this.commonLogger)}getIdToken(e,t,r,n,o){this.commonLogger.trace("CacheManager - getIdToken called");var s=this.getIdTokensByFilter({homeAccountId:e.homeAccountId,environment:e.environment,credentialType:P.ID_TOKEN,clientId:this.clientId,realm:r},t),c=s.size;if(c<1)return this.commonLogger.info("CacheManager:getIdToken - No token found"),null;if(c>1){var l=s;if(!r){var d=new Map;s.forEach((u,f)=>{u.realm===e.tenantId&&d.set(f,u)});var h=d.size;if(h<1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account but none match account entity tenant id, returning first result"),s.values().next().value;if(1===h)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account, defaulting to home tenant profile"),d.values().next().value;l=d}return this.commonLogger.info("CacheManager:getIdToken - Multiple matching ID tokens found, clearing them"),l.forEach((u,f)=>{this.removeIdToken(f)}),n&&o&&n.addFields({multiMatchedID:s.size},o),null}return this.commonLogger.info("CacheManager:getIdToken - Returning ID token"),s.values().next().value}getIdTokensByFilter(e,t){var r=t&&t.idToken||this.getTokenKeys().idToken,n=new Map;return r.forEach(o=>{if(this.idTokenKeyMatchesFilter(o,{clientId:this.clientId,...e})){var a=this.getIdTokenCredential(o);a&&this.credentialMatchesFilter(a,e)&&n.set(o,a)}}),n}idTokenKeyMatchesFilter(e,t){var r=e.toLowerCase();return!(t.clientId&&-1===r.indexOf(t.clientId.toLowerCase())||t.homeAccountId&&-1===r.indexOf(t.homeAccountId.toLowerCase()))}removeIdToken(e){this.removeItem(e)}removeRefreshToken(e){this.removeItem(e)}getAccessToken(e,t,r,n,o,a){this.commonLogger.trace("CacheManager - getAccessToken called");var s=W.createSearchScopes(t.scopes),c=t.authenticationScheme||F.BEARER,l=c&&c.toLowerCase()!==F.BEARER.toLowerCase()?P.ACCESS_TOKEN_WITH_AUTH_SCHEME:P.ACCESS_TOKEN,d={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:l,clientId:this.clientId,realm:n||e.tenantId,target:s,tokenType:c,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash},h=r&&r.accessToken||this.getTokenKeys().accessToken,u=[];h.forEach(m=>{if(this.accessTokenKeyMatchesFilter(m,d,!0)){var v=this.getAccessTokenCredential(m);v&&this.credentialMatchesFilter(v,d)&&u.push(v)}});var f=u.length;return f<1?(this.commonLogger.info("CacheManager:getAccessToken - No token found"),null):f>1?(this.commonLogger.info("CacheManager:getAccessToken - Multiple access tokens found, clearing them"),u.forEach(m=>{this.removeAccessToken(st(m))}),o&&a&&o.addFields({multiMatchedAT:u.length},a),null):(this.commonLogger.info("CacheManager:getAccessToken - Returning access token"),u[0])}accessTokenKeyMatchesFilter(e,t,r){var n=e.toLowerCase();if(t.clientId&&-1===n.indexOf(t.clientId.toLowerCase())||t.homeAccountId&&-1===n.indexOf(t.homeAccountId.toLowerCase())||t.realm&&-1===n.indexOf(t.realm.toLowerCase())||t.requestedClaimsHash&&-1===n.indexOf(t.requestedClaimsHash.toLowerCase()))return!1;if(t.target)for(var o=t.target.asArray(),a=0;a<o.length;a++){if(r&&!n.includes(o[a].toLowerCase()))return!1;if(!r&&n.includes(o[a].toLowerCase()))return!0}return!0}getAccessTokensByFilter(e){var t=this.getTokenKeys(),r=[];return t.accessToken.forEach(n=>{if(this.accessTokenKeyMatchesFilter(n,e,!0)){var o=this.getAccessTokenCredential(n);o&&this.credentialMatchesFilter(o,e)&&r.push(o)}}),r}getRefreshToken(e,t,r,n,o){this.commonLogger.trace("CacheManager - getRefreshToken called");var s={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:P.REFRESH_TOKEN,clientId:this.clientId,familyId:t?"1":void 0},c=r&&r.refreshToken||this.getTokenKeys().refreshToken,l=[];c.forEach(h=>{if(this.refreshTokenKeyMatchesFilter(h,s)){var u=this.getRefreshTokenCredential(h);u&&this.credentialMatchesFilter(u,s)&&l.push(u)}});var d=l.length;return d<1?(this.commonLogger.info("CacheManager:getRefreshToken - No refresh token found."),null):(d>1&&n&&o&&n.addFields({multiMatchedRT:d},o),this.commonLogger.info("CacheManager:getRefreshToken - returning refresh token"),l[0])}refreshTokenKeyMatchesFilter(e,t){var r=e.toLowerCase();return!(t.familyId&&-1===r.indexOf(t.familyId.toLowerCase())||!t.familyId&&t.clientId&&-1===r.indexOf(t.clientId.toLowerCase())||t.homeAccountId&&-1===r.indexOf(t.homeAccountId.toLowerCase()))}readAppMetadataFromCache(e){var r=this.getAppMetadataFilteredBy({environment:e,clientId:this.clientId}),n=Object.keys(r).map(a=>r[a]),o=n.length;if(o<1)return null;if(o>1)throw A(Or);return n[0]}isAppMetadataFOCI(e){var t=this.readAppMetadataFromCache(e);return!(!t||"1"!==t.familyId)}matchHomeAccountId(e,t){return"string"==typeof e.homeAccountId&&t===e.homeAccountId}matchLocalAccountIdFromTokenClaims(e,t){return t===(e.oid||e.sub)}matchLocalAccountIdFromTenantProfile(e,t){return e.localAccountId===t}matchName(e,t){return t.toLowerCase()===e.name?.toLowerCase()}matchUsername(e,t){return!(!e||"string"!=typeof e||t?.toLowerCase()!==e.toLowerCase())}matchUserAssertionHash(e,t){return!(!e.userAssertionHash||t!==e.userAssertionHash)}matchEnvironment(e,t){if(this.staticAuthorityOptions){var r=function(i,e){var t,r=i.canonicalAuthority;if(r){var n=new H(r).getUrlComponents().HostNameAndPort;t=ca(n,i.cloudDiscoveryMetadata?.metadata,"config",e)||ca(n,Li.metadata,"hardcoded_values",e)||i.knownAuthorities}return t||[]}(this.staticAuthorityOptions,this.commonLogger);if(r.includes(t)&&r.includes(e.environment))return!0}var n=this.getAuthorityMetadataByAlias(t);return!!(n&&n.aliases.indexOf(e.environment)>-1)}matchCredentialType(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()}matchClientId(e,t){return!(!e.clientId||t!==e.clientId)}matchFamilyId(e,t){return!(!e.familyId||t!==e.familyId)}matchRealm(e,t){return e.realm?.toLowerCase()===t.toLowerCase()}matchNativeAccountId(e,t){return!(!e.nativeAccountId||t!==e.nativeAccountId)}matchLoginHintFromTokenClaims(e,t){return e.login_hint===t||e.preferred_username===t||e.upn===t}matchSid(e,t){return e.sid===t}matchAuthorityType(e,t){return!(!e.authorityType||t.toLowerCase()!==e.authorityType.toLowerCase())}matchTarget(e,t){return!(e.credentialType!==P.ACCESS_TOKEN&&e.credentialType!==P.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target)&&W.fromString(e.target).containsScopeSet(t)}matchTokenType(e,t){return!(!e.tokenType||e.tokenType!==t)}matchKeyId(e,t){return!(!e.keyId||e.keyId!==t)}isAppMetadata(e){return-1!==e.indexOf(Bn)}isAuthorityMetadata(e){return-1!==e.indexOf("authority-metadata")}generateAuthorityMetadataCacheKey(e){return`authority-metadata-${this.clientId}-${e}`}static toObject(e,t){for(var r in t)e[r]=t[r];return e}}class dc extends dt{setAccount(){throw A(U)}getAccount(){throw A(U)}getCachedAccountEntity(){throw A(U)}setIdTokenCredential(){throw A(U)}getIdTokenCredential(){throw A(U)}setAccessTokenCredential(){throw A(U)}getAccessTokenCredential(){throw A(U)}setRefreshTokenCredential(){throw A(U)}getRefreshTokenCredential(){throw A(U)}setAppMetadata(){throw A(U)}getAppMetadata(){throw A(U)}setServerTelemetry(){throw A(U)}getServerTelemetry(){throw A(U)}setAuthorityMetadata(){throw A(U)}getAuthorityMetadata(){throw A(U)}getAuthorityMetadataKeys(){throw A(U)}setThrottlingCache(){throw A(U)}getThrottlingCache(){throw A(U)}removeItem(){throw A(U)}getKeys(){throw A(U)}getAccountKeys(){throw A(U)}getTokenKeys(){throw A(U)}updateCredentialCacheKey(){throw A(U)}removeOutdatedAccount(){throw A(U)}}var da={tokenRenewalOffsetSeconds:300,preventCorsPreflight:!1},uc={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:B.Info,correlationId:C.EMPTY_STRING},hc={claimsBasedCachingEnabled:!1},gc={sendGetRequestAsync:()=>(0,p.A)(function*(){throw A(U)})(),sendPostRequestAsync:()=>(0,p.A)(function*(){throw A(U)})()},fc={sku:C.SKU,version:Pi,cpu:C.EMPTY_STRING,os:C.EMPTY_STRING},pc={clientSecret:C.EMPTY_STRING,clientAssertion:void 0},mc={azureCloudInstance:"none",tenant:`${C.DEFAULT_COMMON_TENANT}`},vc={application:{appName:"",appVersion:""}};function yc(i){return{clientCapabilities:[],azureCloudOptions:mc,skipAuthorityMetadataCache:!1,instanceAware:!1,...i}}function Ki(i){return"OIDC"===i.authOptions.authority.options.protocolMode}var Ac={sendGetRequestAsync:()=>Promise.reject(A(U)),sendPostRequestAsync:()=>Promise.reject(A(U))};class ua{startMeasurement(){}endMeasurement(){}flushMeasurement(){return null}}class Tc{generateId(){return"callback-id"}startMeasurement(e,t){return{end:()=>null,discard:()=>{},add:()=>{},increment:()=>{},event:{eventId:this.generateId(),status:1,authority:"",libraryName:"",libraryVersion:"",clientId:"",name:e,startTimeMs:Date.now(),correlationId:t||""},measurement:new ua}}startPerformanceMeasurement(){return new ua}calculateQueuedTime(){return 0}addQueueMeasurement(){}setPreQueueTime(){}endMeasurement(){return null}discardMeasurements(){}removePerformanceCallback(){return!0}addPerformanceCallback(){return""}emitEvents(){}addFields(){}incrementFields(){}cacheEventByCorrelationId(){}}class wn{navigateInternal(e,t){return wn.defaultNavigateWindow(e,t)}navigateExternal(e,t){return wn.defaultNavigateWindow(e,t)}static defaultNavigateWindow(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise(r=>{setTimeout(()=>{r(!0)},t.timeout)})}}class Rn extends G{constructor(e,t,r){super(e.errorCode,e.errorMessage,e.subError),Object.setPrototypeOf(this,Rn.prototype),this.name="NetworkError",this.error=e,this.httpStatus=t,this.responseHeaders=r}}function ha(i,e,t){return new Rn(i,e,t)}class Ic{sendGetRequestAsync(e,t){return(0,p.A)(function*(){var r,n,o=0,a=ga(t);try{r=yield fetch(e,{method:"GET",headers:a})}catch{throw w(window.navigator.onLine?en:it)}n=fa(r.headers);try{return o=r.status,{headers:n,body:yield r.json(),status:o}}catch{throw ha(w(Qt),o,n)}})()}sendPostRequestAsync(e,t){return(0,p.A)(function*(){var o,s,r=t&&t.body||"",n=ga(t),a=0;try{o=yield fetch(e,{method:"POST",headers:n,body:r})}catch{throw w(window.navigator.onLine?zt:it)}s=fa(o.headers);try{return a=o.status,{headers:s,body:yield o.json(),status:a}}catch{throw ha(w(Qt),a,s)}})()}}function ga(i){try{var e=new Headers;return i&&i.headers?(Object.entries(i.headers).forEach(([r,n])=>{e.append(r,n)}),e):e}catch{throw w(Po)}}function fa(i){try{var e={};return i.forEach((t,r)=>{e[r]=t}),e}catch{throw w(Oo)}}var Fi=1e4,kn="3.28.0";class Bi{static loggerCallback(e,t){}constructor(e){var t;this.browserEnvironment=typeof window<"u",this.config=function({auth:i,cache:e,system:t,telemetry:r},n){var o={clientId:C.EMPTY_STRING,authority:`${C.DEFAULT_AUTHORITY}`,knownAuthorities:[],cloudDiscoveryMetadata:C.EMPTY_STRING,authorityMetadata:C.EMPTY_STRING,redirectUri:typeof window<"u"?be():"",postLogoutRedirectUri:C.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:"AAD",OIDCOptions:{serverResponseType:At.FRAGMENT,defaultScopes:[C.OPENID_SCOPE,C.PROFILE_SCOPE,C.OFFLINE_ACCESS_SCOPE]},azureCloudOptions:{azureCloudInstance:"none",tenant:C.EMPTY_STRING},skipAuthorityMetadataCache:!1,supportsNestedAppAuth:!1,instanceAware:!1},a={cacheLocation:ie_SessionStorage,temporaryCacheLocation:ie_SessionStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!(!e||e.cacheLocation!==ie_LocalStorage),claimsBasedCachingEnabled:!1},s={loggerCallback:()=>{},logLevel:B.Info,piiLoggingEnabled:!1},l={...{...da,loggerOptions:s,networkClient:n?new Ic:Ac,navigationClient:new wn,loadFrameTimeout:0,windowHashTimeout:t?.loadFrameTimeout||6e4,iframeHashTimeout:t?.loadFrameTimeout||Fi,navigateFrameWait:0,redirectNavigationTimeout:3e4,asyncPopups:!1,allowRedirectInIframe:!1,allowNativeBroker:!1,nativeBrokerHandshakeTimeout:t?.nativeBrokerHandshakeTimeout||2e3,pollIntervalMilliseconds:se.DEFAULT_POLL_INTERVAL_MS},...t,loggerOptions:t?.loggerOptions||s},d={application:{appName:C.EMPTY_STRING,appVersion:C.EMPTY_STRING},client:new Tc};if("OIDC"!==i?.protocolMode&&i?.OIDCOptions&&new Fe(l.loggerOptions).warning(JSON.stringify($(Tr))),i?.protocolMode&&"AAD"!==i.protocolMode&&l?.allowNativeBroker)throw $(Ir);return{auth:{...o,...i,OIDCOptions:{...o.OIDCOptions,...i?.OIDCOptions}},cache:{...a,...e},system:l,telemetry:{...d,...r}}}(e,this.browserEnvironment);try{t=window[ie_SessionStorage]}catch{}var r=t?.getItem("msal.browser.log.level"),n=t?.getItem("msal.browser.log.pii")?.toLowerCase(),o="true"===n||"false"!==n&&void 0,a={...this.config.system.loggerOptions},s=r&&Object.keys(B).includes(r)?B[r]:void 0;s&&(a.loggerCallback=Bi.loggerCallback,a.logLevel=s),void 0!==o&&(a.piiLoggingEnabled=o),this.logger=new Fe(a,"@azure/msal-browser",kn),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}}class We extends Bi{getModuleName(){return We.MODULE_NAME}getId(){return We.ID}initialize(){var e=this;return(0,p.A)(function*(){return e.available=typeof window<"u",e.available})()}}We.MODULE_NAME="",We.ID="StandardOperatingContext";var pa="missing_kid_error",ma="missing_alg_error",kc={[pa]:"The JOSE Header for the requested JWT, JWS or JWK object requires a keyId to be configured as the 'kid' header claim. No 'kid' value was provided.",[ma]:"The JOSE Header for the requested JWT, JWS or JWK object requires an algorithm to be specified as the 'alg' header claim. No 'alg' value was provided."};class $i extends G{constructor(e,t){super(e,t),this.name="JoseHeaderError",Object.setPrototypeOf(this,$i.prototype)}}function va(i){return new $i(i,kc[i])}class Gi{constructor(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}static getShrHeaderString(e){if(!e.kid)throw va(pa);if(!e.alg)throw va(ma);var t=new Gi({typ:e.typ||"pop",kid:e.kid,alg:e.alg});return JSON.stringify(t)}}function Ie(i){return(new TextDecoder).decode(function(i){var e=i.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw w(un)}var t=atob(e);return Uint8Array.from(t,r=>r.codePointAt(0)||0)}(i))}class Pc{constructor(){this.dbName=ui,this.version=1,this.tableName=as,this.dbOpen=!1}open(){var e=this;return(0,p.A)(function*(){return new Promise((t,r)=>{var n=window.indexedDB.open(e.dbName,e.version);n.addEventListener("upgradeneeded",o=>{o.target.result.createObjectStore(e.tableName)}),n.addEventListener("success",o=>{e.db=o.target.result,e.dbOpen=!0,t()}),n.addEventListener("error",()=>r(w(Vt)))})})()}closeConnection(){var e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}validateDbIsOpen(){var e=this;return(0,p.A)(function*(){if(!e.dbOpen)return e.open()})()}getItem(e){var t=this;return(0,p.A)(function*(){return yield t.validateDbIsOpen(),new Promise((r,n)=>{if(!t.db)return n(w(He));var s=t.db.transaction([t.tableName],"readonly").objectStore(t.tableName).get(e);s.addEventListener("success",c=>{var l=c;t.closeConnection(),r(l.target.result)}),s.addEventListener("error",c=>{t.closeConnection(),n(c)})})})()}setItem(e,t){var r=this;return(0,p.A)(function*(){return yield r.validateDbIsOpen(),new Promise((n,o)=>{if(!r.db)return o(w(He));var c=r.db.transaction([r.tableName],"readwrite").objectStore(r.tableName).put(t,e);c.addEventListener("success",()=>{r.closeConnection(),n()}),c.addEventListener("error",l=>{r.closeConnection(),o(l)})})})()}removeItem(e){var t=this;return(0,p.A)(function*(){return yield t.validateDbIsOpen(),new Promise((r,n)=>{if(!t.db)return n(w(He));var s=t.db.transaction([t.tableName],"readwrite").objectStore(t.tableName).delete(e);s.addEventListener("success",()=>{t.closeConnection(),r()}),s.addEventListener("error",c=>{t.closeConnection(),n(c)})})})()}getKeys(){var e=this;return(0,p.A)(function*(){return yield e.validateDbIsOpen(),new Promise((t,r)=>{if(!e.db)return r(w(He));var a=e.db.transaction([e.tableName],"readonly").objectStore(e.tableName).getAllKeys();a.addEventListener("success",s=>{var c=s;e.closeConnection(),t(c.target.result)}),a.addEventListener("error",s=>{e.closeConnection(),r(s)})})})()}containsKey(e){var t=this;return(0,p.A)(function*(){return yield t.validateDbIsOpen(),new Promise((r,n)=>{if(!t.db)return n(w(He));var s=t.db.transaction([t.tableName],"readonly").objectStore(t.tableName).count(e);s.addEventListener("success",c=>{var l=c;t.closeConnection(),r(1===l.target.result)}),s.addEventListener("error",c=>{t.closeConnection(),n(c)})})})()}deleteDatabase(){var e=this;return(0,p.A)(function*(){return e.db&&e.dbOpen&&e.closeConnection(),new Promise((t,r)=>{var n=window.indexedDB.deleteDatabase(ui),o=setTimeout(()=>r(!1),200);n.addEventListener("success",()=>(clearTimeout(o),t(!0))),n.addEventListener("blocked",()=>(clearTimeout(o),t(!0))),n.addEventListener("error",()=>(clearTimeout(o),r(!1)))})})()}}class qi{constructor(){this.cache=new Map}getItem(e){return this.cache.get(e)||null}setItem(e,t){this.cache.set(e,t)}removeItem(e){this.cache.delete(e)}getKeys(){var e=[];return this.cache.forEach((t,r)=>{e.push(r)}),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}}class Oc{constructor(e){this.inMemoryCache=new qi,this.indexedDBCache=new Pc,this.logger=e}handleDatabaseAccessError(e){if(!(e instanceof Yt&&e.errorCode===Vt))throw e;this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.")}getItem(e){var t=this;return(0,p.A)(function*(){var r=t.inMemoryCache.getItem(e);if(!r)try{return t.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),yield t.indexedDBCache.getItem(e)}catch(n){t.handleDatabaseAccessError(n)}return r})()}setItem(e,t){var r=this;return(0,p.A)(function*(){r.inMemoryCache.setItem(e,t);try{yield r.indexedDBCache.setItem(e,t)}catch(n){r.handleDatabaseAccessError(n)}})()}removeItem(e){var t=this;return(0,p.A)(function*(){t.inMemoryCache.removeItem(e);try{yield t.indexedDBCache.removeItem(e)}catch(r){t.handleDatabaseAccessError(r)}})()}getKeys(){var e=this;return(0,p.A)(function*(){var t=e.inMemoryCache.getKeys();if(0===t.length)try{return e.logger.verbose("In-memory cache is empty, now querying persistent storage."),yield e.indexedDBCache.getKeys()}catch(r){e.handleDatabaseAccessError(r)}return t})()}containsKey(e){var t=this;return(0,p.A)(function*(){var r=t.inMemoryCache.containsKey(e);if(!r)try{return t.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),yield t.indexedDBCache.containsKey(e)}catch(n){t.handleDatabaseAccessError(n)}return r})()}clearInMemory(){this.logger.verbose("Deleting in-memory keystore"),this.inMemoryCache.clear(),this.logger.verbose("In-memory keystore deleted")}clearPersistent(){var e=this;return(0,p.A)(function*(){try{e.logger.verbose("Deleting persistent keystore");var t=yield e.indexedDBCache.deleteDatabase();return t&&e.logger.verbose("Persistent keystore deleted"),t}catch(r){return e.handleDatabaseAccessError(r),!1}})()}}class ut{constructor(e,t){this.logger=e,function(){if(!window)throw w(nt);if(!window.crypto)throw w(Ft);if(!window.crypto.subtle)throw w(Ft,"crypto_subtle_undefined")}(),this.cache=new Oc(this.logger),this.performanceClient=t}createNewGuid(){return ke()}base64Encode(e){return hi(e)}base64Decode(e){return Ie(e)}base64UrlEncode(e){return fn(e)}encodeKid(e){return this.base64UrlEncode(JSON.stringify({kid:e}))}getPublicKeyThumbprint(e){var t=this;return(0,p.A)(function*(){var r=t.performanceClient?.startMeasurement(g.CryptoOptsGetPublicKeyThumbprint,e.correlationId),n=yield function(i,e){return mi.apply(this,arguments)}(ut.EXTRACTABLE,ut.POP_KEY_USAGES),o=yield vi(n.publicKey),s=Ca({e:o.e,kty:o.kty,n:o.n}),c=yield t.hashString(s),l=yield vi(n.privateKey),d=yield function(i,e,t){return yi.apply(this,arguments)}(l,!1,["sign"]);return yield t.cache.setItem(c,{privateKey:d,publicKey:n.publicKey,requestMethod:e.resourceRequestMethod,requestUri:e.resourceRequestUri}),r&&r.end({success:!0}),c})()}removeTokenBindingKey(e){var t=this;return(0,p.A)(function*(){return yield t.cache.removeItem(e),!(yield t.cache.containsKey(e))})()}clearKeystore(){var e=this;return(0,p.A)(function*(){e.cache.clearInMemory();try{return yield e.cache.clearPersistent(),!0}catch(t){return t instanceof Error?e.logger.error(`Clearing keystore failed with error: ${t.message}`):e.logger.error("Clearing keystore failed with unknown error"),!1}})()}signJwt(e,t,r,n){var o=this;return(0,p.A)(function*(){var a=o.performanceClient?.startMeasurement(g.CryptoOptsSignJwt,n),s=yield o.cache.getItem(t);if(!s)throw w(Wt);var c=yield vi(s.publicKey),l=Ca(c),d=fn(JSON.stringify({kid:t})),u=fn(Gi.getShrHeaderString({...r?.header,alg:c.alg,kid:d}));e.cnf={jwk:JSON.parse(l)};var m=`${u}.${fn(JSON.stringify(e))}`,S=(new TextEncoder).encode(m),T=yield function(i,e){return Ai.apply(this,arguments)}(s.privateKey,S),V=`${m}.${pn(new Uint8Array(T))}`;return a&&a.end({success:!0}),V})()}hashString(e){return(0,p.A)(function*(){return Fo(e)})()}}function Ca(i){return JSON.stringify(i,Object.keys(i).sort())}ut.POP_KEY_USAGES=["sign","verify"],ut.EXTRACTABLE=!0;var Ve=(i,e,t,r,n)=>(...o)=>{t.trace(`Executing function ${e}`);var a=r?.startMeasurement(e,n);if(n){var s=e+"CallCount";r?.incrementFields({[s]:1},n)}try{var c=i(...o);return a?.end({success:!0}),t.trace(`Returning result from ${e}`),c}catch(l){t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(l))}catch{t.trace("Unable to print error message.")}throw a?.end({success:!1},l),l}},E=(i,e,t,r,n)=>(...o)=>{t.trace(`Executing function ${e}`);var a=r?.startMeasurement(e,n);if(n){var s=e+"CallCount";r?.incrementFields({[s]:1},n)}return r?.setPreQueueTime(e,n),i(...o).then(c=>(t.trace(`Returning result from ${e}`),a?.end({success:!0}),c)).catch(c=>{t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(c))}catch{t.trace("Unable to print error message.")}throw a?.end({success:!1},c),c})};class bn{constructor(e,t,r,n){this.networkInterface=e,this.logger=t,this.performanceClient=r,this.correlationId=n}detectRegion(e,t){var r=this;return(0,p.A)(function*(){r.performanceClient?.addQueueMeasurement(g.RegionDiscoveryDetectRegion,r.correlationId);var n=e;if(n)t.region_source="3";else{var o=bn.IMDS_OPTIONS;try{var a=yield E(r.getRegionFromIMDS.bind(r),g.RegionDiscoveryGetRegionFromIMDS,r.logger,r.performanceClient,r.correlationId)(C.IMDS_VERSION,o);if(200===a.status&&(n=a.body,t.region_source="4"),400===a.status){var s=yield E(r.getCurrentVersion.bind(r),g.RegionDiscoveryGetCurrentVersion,r.logger,r.performanceClient,r.correlationId)(o);if(!s)return t.region_source="1",null;var c=yield E(r.getRegionFromIMDS.bind(r),g.RegionDiscoveryGetRegionFromIMDS,r.logger,r.performanceClient,r.correlationId)(s,o);200===c.status&&(n=c.body,t.region_source="4")}}catch{return t.region_source="1",null}}return n||(t.region_source="1"),n||null})()}getRegionFromIMDS(e,t){var r=this;return(0,p.A)(function*(){return r.performanceClient?.addQueueMeasurement(g.RegionDiscoveryGetRegionFromIMDS,r.correlationId),r.networkInterface.sendGetRequestAsync(`${C.IMDS_ENDPOINT}?api-version=${e}&format=text`,t,C.IMDS_TIMEOUT)})()}getCurrentVersion(e){var t=this;return(0,p.A)(function*(){t.performanceClient?.addQueueMeasurement(g.RegionDiscoveryGetCurrentVersion,t.correlationId);try{var r=yield t.networkInterface.sendGetRequestAsync(`${C.IMDS_ENDPOINT}?format=json`,e);return 400===r.status&&r.body&&r.body["newest-versions"]&&r.body["newest-versions"].length>0?r.body["newest-versions"][0]:null}catch{return null}})()}}bn.IMDS_OPTIONS={headers:{Metadata:"true"}};class re{constructor(e,t,r,n,o,a,s,c){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=r,this.authorityOptions=n,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=o,this.performanceClient=s,this.correlationId=a,this.managedIdentity=c||!1,this.regionDiscovery=new bn(t,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(C.CIAM_AUTH_URL))return 3;var t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case C.ADFS:return 1;case C.DSTS:return 2}return 0}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new H(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw A(ge)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw A(ge)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw A(ge)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw A(Kr);return this.replacePath(this.metadata.end_session_endpoint)}throw A(ge)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw A(ge)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw A(ge)}canReplaceTenant(e){return 1===e.PathSegments.length&&!re.reservedTenantDomains.has(e.PathSegments[0])&&0===this.getAuthorityType(e)&&"AAD"===this.protocolMode}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){var t=e,n=new H(this.metadata.canonical_authority).getUrlComponents(),o=n.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((s,c)=>{var l=o[c];if(0===c&&this.canReplaceTenant(n)){var d=new H(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];l!==d&&(this.logger.verbose(`Replacing tenant domain name ${l} with id ${d}`),l=d)}s!==l&&(t=t.replace(`/${l}/`,`/${s}/`))}),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){var e=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||1===this.authorityType||"AAD"!==this.protocolMode&&!this.isAliasOfKnownMicrosoftAuthority(e)?`${this.canonicalAuthority}.well-known/openid-configuration`:`${this.canonicalAuthority}v2.0/.well-known/openid-configuration`}discoveryComplete(){return!!this.metadata}resolveEndpointsAsync(){var e=this;return(0,p.A)(function*(){e.performanceClient?.addQueueMeasurement(g.AuthorityResolveEndpointsAsync,e.correlationId);var t=e.getCurrentMetadataEntity(),r=yield E(e.updateCloudDiscoveryMetadata.bind(e),g.AuthorityUpdateCloudDiscoveryMetadata,e.logger,e.performanceClient,e.correlationId)(t);e.canonicalAuthority=e.canonicalAuthority.replace(e.hostnameAndPort,t.preferred_network);var n=yield E(e.updateEndpointMetadata.bind(e),g.AuthorityUpdateEndpointMetadata,e.logger,e.performanceClient,e.correlationId)(t);e.updateCachedMetadata(t,r,{source:n}),e.performanceClient?.addFields({cloudDiscoverySource:r,authorityEndpointSource:n},e.correlationId)})()}getCurrentMetadataEntity(){var e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort);return e||(e={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:ra(),jwks_uri:""}),e}updateCachedMetadata(e,t,r){"cache"!==t&&"cache"!==r?.source&&(e.expiresAt=ra(),e.canonical_authority=this.canonicalAuthority);var n=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache);this.cacheManager.setAuthorityMetadata(n,e),this.metadata=e}updateEndpointMetadata(e){var t=this;return(0,p.A)(function*(){t.performanceClient?.addQueueMeasurement(g.AuthorityUpdateEndpointMetadata,t.correlationId);var r=t.updateEndpointMetadataFromLocalSources(e);if(r){if("hardcoded_values"===r.source&&t.authorityOptions.azureRegionConfiguration?.azureRegion&&r.metadata){var n=yield E(t.updateMetadataWithRegionalInformation.bind(t),g.AuthorityUpdateMetadataWithRegionalInformation,t.logger,t.performanceClient,t.correlationId)(r.metadata);In(e,n,!1),e.canonical_authority=t.canonicalAuthority}return r.source}var o=yield E(t.getEndpointMetadataFromNetwork.bind(t),g.AuthorityGetEndpointMetadataFromNetwork,t.logger,t.performanceClient,t.correlationId)();if(o)return t.authorityOptions.azureRegionConfiguration?.azureRegion&&(o=yield E(t.updateMetadataWithRegionalInformation.bind(t),g.AuthorityUpdateMetadataWithRegionalInformation,t.logger,t.performanceClient,t.correlationId)(o)),In(e,o,!0),"network";throw A(Pt,t.defaultOpenIdConfigurationEndpoint)})()}updateEndpointMetadataFromLocalSources(e){this.logger.verbose("Attempting to get endpoint metadata from authority configuration");var t=this.getEndpointMetadataFromConfig();if(t)return this.logger.verbose("Found endpoint metadata in authority configuration"),In(e,t,!1),{source:"config"};if(this.logger.verbose("Did not find endpoint metadata in the config... Attempting to get endpoint metadata from the hardcoded values."),this.authorityOptions.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get endpoint metadata from the network metadata cache.");else{var r=this.getEndpointMetadataFromHardcodedValues();if(r)return In(e,r,!1),{source:"hardcoded_values",metadata:r};this.logger.verbose("Did not find endpoint metadata in hardcoded values... Attempting to get endpoint metadata from the network metadata cache.")}var n=na(e);return this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!n?(this.logger.verbose("Found endpoint metadata in the cache."),{source:"cache"}):(n&&this.logger.verbose("The metadata entity is expired."),null)}isAuthoritySameType(e){return new H(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch{throw $(yr)}return null}getEndpointMetadataFromNetwork(){var e=this;return(0,p.A)(function*(){e.performanceClient?.addQueueMeasurement(g.AuthorityGetEndpointMetadataFromNetwork,e.correlationId);var r=e.defaultOpenIdConfigurationEndpoint;e.logger.verbose(`Authority.getEndpointMetadataFromNetwork: attempting to retrieve OAuth endpoints from ${r}`);try{var n=yield e.networkInterface.sendGetRequestAsync(r,{}),o=function(i){return i.hasOwnProperty("authorization_endpoint")&&i.hasOwnProperty("token_endpoint")&&i.hasOwnProperty("issuer")&&i.hasOwnProperty("jwks_uri")}(n.body);return o?n.body:(e.logger.verbose("Authority.getEndpointMetadataFromNetwork: could not parse response as OpenID configuration"),null)}catch(a){return e.logger.verbose(`Authority.getEndpointMetadataFromNetwork: ${a}`),null}})()}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in aa?aa[this.hostnameAndPort]:null}updateMetadataWithRegionalInformation(e){var t=this;return(0,p.A)(function*(){t.performanceClient?.addQueueMeasurement(g.AuthorityUpdateMetadataWithRegionalInformation,t.correlationId);var r=t.authorityOptions.azureRegionConfiguration?.azureRegion;if(r){if(r!==C.AZURE_REGION_AUTO_DISCOVER_FLAG)return t.regionDiscoveryMetadata.region_outcome="2",t.regionDiscoveryMetadata.region_used=r,re.replaceWithRegionalInformation(e,r);var n=yield E(t.regionDiscovery.detectRegion.bind(t.regionDiscovery),g.RegionDiscoveryDetectRegion,t.logger,t.performanceClient,t.correlationId)(t.authorityOptions.azureRegionConfiguration?.environmentRegion,t.regionDiscoveryMetadata);if(n)return t.regionDiscoveryMetadata.region_outcome="4",t.regionDiscoveryMetadata.region_used=n,re.replaceWithRegionalInformation(e,n);t.regionDiscoveryMetadata.region_outcome="5"}return e})()}updateCloudDiscoveryMetadata(e){var t=this;return(0,p.A)(function*(){t.performanceClient?.addQueueMeasurement(g.AuthorityUpdateCloudDiscoveryMetadata,t.correlationId);var r=t.updateCloudDiscoveryMetadataFromLocalSources(e);if(r)return r;var n=yield E(t.getCloudDiscoveryMetadataFromNetwork.bind(t),g.AuthorityGetCloudDiscoveryMetadataFromNetwork,t.logger,t.performanceClient,t.correlationId)();if(n)return Mi(e,n,!0),"network";throw $(Rt)})()}updateCloudDiscoveryMetadataFromLocalSources(e){this.logger.verbose("Attempting to get cloud discovery metadata  from authority configuration"),this.logger.verbosePii(`Known Authorities: ${this.authorityOptions.knownAuthorities||C.NOT_APPLICABLE}`),this.logger.verbosePii(`Authority Metadata: ${this.authorityOptions.authorityMetadata||C.NOT_APPLICABLE}`),this.logger.verbosePii(`Canonical Authority: ${e.canonical_authority||C.NOT_APPLICABLE}`);var t=this.getCloudDiscoveryMetadataFromConfig();if(t)return this.logger.verbose("Found cloud discovery metadata in authority configuration"),Mi(e,t,!1),"config";if(this.logger.verbose("Did not find cloud discovery metadata in the config... Attempting to get cloud discovery metadata from the hardcoded values."),this.options.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded cloud discovery metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get cloud discovery metadata from the network metadata cache.");else{var r=function(i){return _n(Li.metadata,i)}(this.hostnameAndPort);if(r)return this.logger.verbose("Found cloud discovery metadata from hardcoded values."),Mi(e,r,!1),"hardcoded_values";this.logger.verbose("Did not find cloud discovery metadata in hardcoded values... Attempting to get cloud discovery metadata from the network metadata cache.")}var n=na(e);return this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!n?(this.logger.verbose("Found cloud discovery metadata in the cache."),"cache"):(n&&this.logger.verbose("The metadata entity is expired."),null)}getCloudDiscoveryMetadataFromConfig(){if(3===this.authorityType)return this.logger.verbose("CIAM authorities do not support cloud discovery metadata, generate the aliases from authority host."),re.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("The cloud discovery metadata has been provided as a network response, in the config.");try{this.logger.verbose("Attempting to parse the cloud discovery metadata.");var t=_n(JSON.parse(this.authorityOptions.cloudDiscoveryMetadata).metadata,this.hostnameAndPort);if(this.logger.verbose("Parsed the cloud discovery metadata."),t)return this.logger.verbose("There is returnable metadata attached to the parsed cloud discovery metadata."),t;this.logger.verbose("There is no metadata attached to the parsed cloud discovery metadata.")}catch{throw this.logger.verbose("Unable to parse the cloud discovery metadata. Throwing Invalid Cloud Discovery Metadata Error."),$(wt)}}return this.isInKnownAuthorities()?(this.logger.verbose("The host is included in knownAuthorities. Creating new cloud discovery metadata from the host."),re.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}getCloudDiscoveryMetadataFromNetwork(){var e=this;return(0,p.A)(function*(){e.performanceClient?.addQueueMeasurement(g.AuthorityGetCloudDiscoveryMetadataFromNetwork,e.correlationId);var t=`${C.AAD_INSTANCE_DISCOVERY_ENDPT}${e.canonicalAuthority}oauth2/v2.0/authorize`,n=null;try{var a,s,o=yield e.networkInterface.sendGetRequestAsync(t,{});if(function(i){return i.hasOwnProperty("tenant_discovery_endpoint")&&i.hasOwnProperty("metadata")}(o.body))s=(a=o.body).metadata,e.logger.verbosePii(`tenant_discovery_endpoint is: ${a.tenant_discovery_endpoint}`);else{if(!function(i){return i.hasOwnProperty("error")&&i.hasOwnProperty("error_description")}(o.body))return e.logger.error("AAD did not return a CloudInstanceDiscoveryResponse or CloudInstanceDiscoveryErrorResponse"),null;if(e.logger.warning(`A CloudInstanceDiscoveryErrorResponse was returned. The cloud instance discovery network request's status code is: ${o.status}`),(a=o.body).error===C.INVALID_INSTANCE)return e.logger.error("The CloudInstanceDiscoveryErrorResponse error is invalid_instance."),null;e.logger.warning(`The CloudInstanceDiscoveryErrorResponse error is ${a.error}`),e.logger.warning(`The CloudInstanceDiscoveryErrorResponse error description is ${a.error_description}`),e.logger.warning("Setting the value of the CloudInstanceDiscoveryMetadata (returned from the network) to []"),s=[]}e.logger.verbose("Attempting to find a match between the developer's authority and the CloudInstanceDiscoveryMetadata returned from the network request."),n=_n(s,e.hostnameAndPort)}catch(l){return e.logger.error(l instanceof G?`There was a network error while attempting to get the cloud discovery instance metadata.\nError: ${l.errorCode}\nError Description: ${l.errorMessage}`:`A non-MSALJS error was thrown while attempting to get the cloud instance discovery metadata.\nError: ${l.name}\nError Description: ${l.message}`),null}return n||(e.logger.warning("The developer's authority was not found within the CloudInstanceDiscoveryMetadata returned from the network request."),e.logger.verbose("Creating custom Authority for custom domain scenario."),n=re.createCloudDiscoveryMetadataFromHost(e.hostnameAndPort)),n})()}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(t=>t&&H.getDomainFromUrl(t).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(e,t){var r;return t&&"none"!==t.azureCloudInstance&&(r=`${t.azureCloudInstance}/${t.tenant?t.tenant:C.DEFAULT_COMMON_TENANT}/`),r||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}getPreferredCache(){if(this.managedIdentity)return C.DEFAULT_AUTHORITY_HOST;if(this.discoveryComplete())return this.metadata.preferred_cache;throw A(ge)}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}isAliasOfKnownMicrosoftAuthority(e){return sa.has(e)}static isPublicCloudAuthority(e){return C.KNOWN_PUBLIC_CLOUDS.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,r){var n=new H(e);n.validateAsUri();var o=n.getUrlComponents(),a=`${t}.${o.HostNameAndPort}`;this.isPublicCloudAuthority(o.HostNameAndPort)&&(a=`${t}.${C.REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX}`);var s=H.constructAuthorityUriFromObject({...n.getUrlComponents(),HostNameAndPort:a}).urlString;return r?`${s}?${r}`:s}static replaceWithRegionalInformation(e,t){var r={...e};return r.authorization_endpoint=re.buildRegionalAuthorityString(r.authorization_endpoint,t),r.token_endpoint=re.buildRegionalAuthorityString(r.token_endpoint,t),r.end_session_endpoint&&(r.end_session_endpoint=re.buildRegionalAuthorityString(r.end_session_endpoint,t)),r}static transformCIAMAuthority(e){var t=e,n=new H(e).getUrlComponents();return 0===n.PathSegments.length&&n.HostNameAndPort.endsWith(C.CIAM_AUTH_URL)&&(t=`${t}${n.HostNameAndPort.split(".")[0]}${C.AAD_TENANT_DOMAIN_SUFFIX}`),t}}function ya(i){return i.endsWith(C.FORWARD_SLASH)?i:`${i}${C.FORWARD_SLASH}`}re.reservedTenantDomains=new Set(["{tenant}","{tenantid}","common","consumers","organizations"]);var ht="no_tokens_found",Pn="native_account_unavailable",zi="refresh_token_expired",gt="bad_token",Aa=["interaction_required","consent_required","login_required",gt],Fc=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token"],On={[ht]:"No refresh token found in the cache. Please sign-in.",[Pn]:"The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API.",[zi]:"Refresh token has expired.",[gt]:"Identity provider returned bad_token due to an expired or invalid refresh token. Please invoke an interactive API to resolve."};class ue extends G{constructor(e,t,r,n,o,a,s,c){super(e,t,r),Object.setPrototypeOf(this,ue.prototype),this.timestamp=n||C.EMPTY_STRING,this.traceId=o||C.EMPTY_STRING,this.correlationId=a||C.EMPTY_STRING,this.claims=s||C.EMPTY_STRING,this.name="InteractionRequiredAuthError",this.errorNo=c}}function Ta(i,e,t){var r=!!i&&Aa.indexOf(i)>-1,n=!!t&&Fc.indexOf(t)>-1,o=!!e&&Aa.some(a=>e.indexOf(a)>-1);return r||o||n}function Qi(i){return new ue(i,On[i])}class me{static setRequestState(e,t,r){var n=me.generateLibraryState(e,r);return t?`${n}${C.RESOURCE_DELIM}${t}`:n}static generateLibraryState(e,t){if(!e)throw A(Lt);var r={id:e.createNewGuid()};t&&(r.meta=t);var n=JSON.stringify(r);return e.base64Encode(n)}static parseRequestState(e,t){if(!e)throw A(Lt);if(!t)throw A(Le);try{var r=t.split(C.RESOURCE_DELIM),n=r[0],o=r.length>1?r.slice(1).join(C.RESOURCE_DELIM):C.EMPTY_STRING,a=e.base64Decode(n),s=JSON.parse(a);return{userRequestState:o||C.EMPTY_STRING,libraryState:s}}catch{throw A(Le)}}}class Bc{constructor(){if(!window.localStorage)throw Si(at)}getItem(e){return window.localStorage.getItem(e)}setItem(e,t){window.localStorage.setItem(e,t)}removeItem(e){window.localStorage.removeItem(e)}getKeys(){return Object.keys(window.localStorage)}containsKey(e){return window.localStorage.hasOwnProperty(e)}}class $c{constructor(){if(!window.sessionStorage)throw Si(at)}getItem(e){return window.sessionStorage.getItem(e)}setItem(e,t){window.sessionStorage.setItem(e,t)}removeItem(e){window.sessionStorage.removeItem(e)}getKeys(){return Object.keys(window.sessionStorage)}containsKey(e){return window.sessionStorage.hasOwnProperty(e)}}function Ia(i,e){if(!e)return null;try{return me.parseRequestState(i,e).libraryState.meta}catch{throw A(Le)}}class qc{getItem(e){for(var t=`${encodeURIComponent(e)}`,r=document.cookie.split(";"),n=0;n<r.length;n++){var o=r[n],[a,...s]=decodeURIComponent(o).trim().split("="),c=s.join("=");if(a===t)return c}return""}setItem(e,t,r,n=!0){var o=`${encodeURIComponent(e)}=${encodeURIComponent(t)};path=/;SameSite=Lax;`;if(r){var a=function(i){return new Date((new Date).getTime()+864e5*i).toUTCString()}(r);o+=`expires=${a};`}n&&(o+="Secure;"),document.cookie=o}removeItem(e){this.setItem(e,"",-1)}getKeys(){var e=document.cookie.split(";"),t=[];return e.forEach(r=>{var n=decodeURIComponent(r).trim().split("=");t.push(n[0])}),t}containsKey(e){return this.getKeys().includes(e)}}class Wi extends dt{constructor(e,t,r,n,o,a){super(e,r,n,o),this.cacheConfig=t,this.logger=n,this.internalStorage=new qi,this.browserStorage=this.setupBrowserStorage(this.cacheConfig.cacheLocation),this.temporaryCacheStorage=this.setupBrowserStorage(this.cacheConfig.temporaryCacheLocation),this.cookieStorage=new qc,t.cacheMigrationEnabled&&(this.migrateCacheEntries(),this.createKeyMaps()),this.performanceClient=a}setupBrowserStorage(e){try{switch(e){case ie_LocalStorage:return new Bc;case ie_SessionStorage:return new $c}}catch(t){this.logger.error(t)}return this.cacheConfig.cacheLocation=ie_MemoryStorage,new qi}migrateCacheEntries(){var t=`${C.CACHE_PREFIX}.${j_CLIENT_INFO}`,r=`${C.CACHE_PREFIX}.${j_ERROR}`,n=`${C.CACHE_PREFIX}.${j_ERROR_DESC}`,l=[this.browserStorage.getItem(`${C.CACHE_PREFIX}.${j_ID_TOKEN}`),this.browserStorage.getItem(t),this.browserStorage.getItem(r),this.browserStorage.getItem(n)];[j_ID_TOKEN,j_CLIENT_INFO,j_ERROR,j_ERROR_DESC].forEach((h,u)=>{var f=l[u];f&&this.setTemporaryCache(h,f,!0)})}createKeyMaps(){this.logger.trace("BrowserCacheManager - createKeyMaps called.");var e=this.getItem("msal.account.keys"),t=this.getItem(`msal.token.keys.${this.clientId}`);e&&t?this.logger.verbose("BrowserCacheManager:createKeyMaps - account and token key maps already exist, skipping migration."):this.browserStorage.getKeys().forEach(n=>{if(this.isCredentialKey(n)){var o=this.getItem(n);if(o){var a=this.validateAndParseJson(o);if(a&&a.hasOwnProperty("credentialType"))switch(a.credentialType){case P.ID_TOKEN:if(ea(a)){this.logger.trace("BrowserCacheManager:createKeyMaps - idToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - idToken with key: ${n} found, saving key to token key map`);var c=this.updateCredentialCacheKey(n,a);return void this.addTokenKey(c,P.ID_TOKEN)}this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching idToken schema with value containing idToken credentialType field but value failed IdTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed idToken validation on key: ${n}`);break;case P.ACCESS_TOKEN:case P.ACCESS_TOKEN_WITH_AUTH_SCHEME:if(Zo(a)){this.logger.trace("BrowserCacheManager:createKeyMaps - accessToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - accessToken with key: ${n} found, saving key to token key map`);var d=this.updateCredentialCacheKey(n,a);return void this.addTokenKey(d,P.ACCESS_TOKEN)}this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching accessToken schema with value containing accessToken credentialType field but value failed AccessTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed accessToken validation on key: ${n}`);break;case P.REFRESH_TOKEN:if(ta(a)){this.logger.trace("BrowserCacheManager:createKeyMaps - refreshToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - refreshToken with key: ${n} found, saving key to token key map`);var u=this.updateCredentialCacheKey(n,a);return void this.addTokenKey(u,P.REFRESH_TOKEN)}this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching refreshToken schema with value containing refreshToken credentialType field but value failed RefreshTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed refreshToken validation on key: ${n}`)}}}if(this.isAccountKey(n)){var f=this.getItem(n);if(f){var m=this.validateAndParseJson(f);m&&Y.isAccountEntity(m)&&(this.logger.trace("BrowserCacheManager:createKeyMaps - account found, saving key to account key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - account with key: ${n} found, saving key to account key map`),this.addAccountKeyToMap(n))}}})}validateAndParseJson(e){try{var t=JSON.parse(e);return t&&"object"==typeof t?t:null}catch{return null}}getItem(e){return this.browserStorage.getItem(e)}setItem(e,t){this.browserStorage.setItem(e,t)}getAccount(e,t){this.logger.trace("BrowserCacheManager.getAccount called");var r=this.getCachedAccountEntity(e);return this.updateOutdatedCachedAccount(e,r,t)}getCachedAccountEntity(e){var t=this.getItem(e);if(!t)return this.removeAccountKeyFromMap(e),null;var r=this.validateAndParseJson(t);return r&&Y.isAccountEntity(r)?dt.toObject(new Y,r):(this.removeAccountKeyFromMap(e),null)}setAccount(e){this.logger.trace("BrowserCacheManager.setAccount called");var t=e.generateAccountKey();this.setItem(t,JSON.stringify(e)),this.addAccountKeyToMap(t)}getAccountKeys(){this.logger.trace("BrowserCacheManager.getAccountKeys called");var e=this.getItem("msal.account.keys");return e?JSON.parse(e):(this.logger.verbose("BrowserCacheManager.getAccountKeys - No account keys found"),[])}addAccountKeyToMap(e){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii(`BrowserCacheManager.addAccountKeyToMap called with key: ${e}`);var t=this.getAccountKeys();-1===t.indexOf(e)?(t.push(e),this.setItem("msal.account.keys",JSON.stringify(t)),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added")):this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map")}removeAccountKeyFromMap(e){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii(`BrowserCacheManager.removeAccountKeyFromMap called with key: ${e}`);var t=this.getAccountKeys(),r=t.indexOf(e);r>-1?(t.splice(r,1),this.setItem("msal.account.keys",JSON.stringify(t)),this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")):this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")}removeAccount(e){var t=()=>super.removeAccount,r=this;return(0,p.A)(function*(){t().call(r,e),r.removeAccountKeyFromMap(e)})()}removeOutdatedAccount(e){this.removeItem(e),this.removeAccountKeyFromMap(e)}removeIdToken(e){super.removeIdToken(e),this.removeTokenKey(e,P.ID_TOKEN)}removeAccessToken(e){var t=()=>super.removeAccessToken,r=this;return(0,p.A)(function*(){t().call(r,e),r.removeTokenKey(e,P.ACCESS_TOKEN)})()}removeRefreshToken(e){super.removeRefreshToken(e),this.removeTokenKey(e,P.REFRESH_TOKEN)}getTokenKeys(){this.logger.trace("BrowserCacheManager.getTokenKeys called");var e=this.getItem(`msal.token.keys.${this.clientId}`);if(e){var t=this.validateAndParseJson(e);if(t&&t.hasOwnProperty("idToken")&&t.hasOwnProperty("accessToken")&&t.hasOwnProperty("refreshToken"))return t;this.logger.error("BrowserCacheManager.getTokenKeys - Token keys found but in an unknown format. Returning empty key map.")}else this.logger.verbose("BrowserCacheManager.getTokenKeys - No token keys found");return{idToken:[],accessToken:[],refreshToken:[]}}addTokenKey(e,t){this.logger.trace("BrowserCacheManager addTokenKey called");var r=this.getTokenKeys();switch(t){case P.ID_TOKEN:-1===r.idToken.indexOf(e)&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),r.idToken.push(e));break;case P.ACCESS_TOKEN:-1===r.accessToken.indexOf(e)&&(this.logger.info("BrowserCacheManager: addTokenKey - accessToken added to map"),r.accessToken.push(e));break;case P.REFRESH_TOKEN:-1===r.refreshToken.indexOf(e)&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),r.refreshToken.push(e));break;default:throw this.logger.error(`BrowserCacheManager:addTokenKey - CredentialType provided invalid. CredentialType: ${t}`),A(Ht)}this.setItem(`msal.token.keys.${this.clientId}`,JSON.stringify(r))}removeTokenKey(e,t){this.logger.trace("BrowserCacheManager removeTokenKey called");var r=this.getTokenKeys();switch(t){case P.ID_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove idToken with key: ${e} from map`);var n=r.idToken.indexOf(e);n>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - idToken removed from map"),r.idToken.splice(n,1)):this.logger.info("BrowserCacheManager: removeTokenKey - idToken does not exist in map. Either it was previously removed or it was never added.");break;case P.ACCESS_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove accessToken with key: ${e} from map`);var o=r.accessToken.indexOf(e);o>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - accessToken removed from map"),r.accessToken.splice(o,1)):this.logger.info("BrowserCacheManager: removeTokenKey - accessToken does not exist in map. Either it was previously removed or it was never added.");break;case P.REFRESH_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove refreshToken with key: ${e} from map`);var a=r.refreshToken.indexOf(e);a>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken removed from map"),r.refreshToken.splice(a,1)):this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken does not exist in map. Either it was previously removed or it was never added.");break;default:throw this.logger.error(`BrowserCacheManager:removeTokenKey - CredentialType provided invalid. CredentialType: ${t}`),A(Ht)}this.setItem(`msal.token.keys.${this.clientId}`,JSON.stringify(r))}getIdTokenCredential(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,P.ID_TOKEN),null;var r=this.validateAndParseJson(t);return r&&ea(r)?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),r):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,P.ID_TOKEN),null)}setIdTokenCredential(e){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");var t=st(e);this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,P.ID_TOKEN)}getAccessTokenCredential(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,P.ACCESS_TOKEN),null;var r=this.validateAndParseJson(t);return r&&Zo(r)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),r):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,P.ACCESS_TOKEN),null)}setAccessTokenCredential(e){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");var t=st(e);this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,P.ACCESS_TOKEN)}getRefreshTokenCredential(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,P.REFRESH_TOKEN),null;var r=this.validateAndParseJson(t);return r&&ta(r)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),r):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,P.REFRESH_TOKEN),null)}setRefreshTokenCredential(e){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");var t=st(e);this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,P.REFRESH_TOKEN)}getAppMetadata(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null;var r=this.validateAndParseJson(t);return r&&function(i,e){return!!e&&0===i.indexOf(Bn)&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("environment")}(e,r)?(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),r):(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null)}setAppMetadata(e){this.logger.trace("BrowserCacheManager.setAppMetadata called");var t=function({environment:i,clientId:e}){return[Bn,i,e].join(te.CACHE_KEY_SEPARATOR).toLowerCase()}(e);this.setItem(t,JSON.stringify(e))}getServerTelemetry(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null;var r=this.validateAndParseJson(t);return r&&function(i,e){var t=0===i.indexOf(Z.CACHE_KEY),r=!0;return e&&(r=e.hasOwnProperty("failedRequests")&&e.hasOwnProperty("errors")&&e.hasOwnProperty("cacheHits")),t&&r}(e,r)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),r):(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null)}setServerTelemetry(e,t){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.setItem(e,JSON.stringify(t))}getAuthorityMetadata(e){var t=this.internalStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null;var r=this.validateAndParseJson(t);return r&&function(i,e){return!!e&&0===i.indexOf("authority-metadata")&&e.hasOwnProperty("aliases")&&e.hasOwnProperty("preferred_cache")&&e.hasOwnProperty("preferred_network")&&e.hasOwnProperty("canonical_authority")&&e.hasOwnProperty("authorization_endpoint")&&e.hasOwnProperty("token_endpoint")&&e.hasOwnProperty("issuer")&&e.hasOwnProperty("aliasesFromNetwork")&&e.hasOwnProperty("endpointsFromNetwork")&&e.hasOwnProperty("expiresAt")&&e.hasOwnProperty("jwks_uri")}(e,r)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),r):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter(t=>this.isAuthorityMetadata(t))}setWrapperMetadata(e,t){this.internalStorage.setItem("wrapper.sku",e),this.internalStorage.setItem("wrapper.version",t)}getWrapperMetadata(){return[this.internalStorage.getItem("wrapper.sku")||C.EMPTY_STRING,this.internalStorage.getItem("wrapper.version")||C.EMPTY_STRING]}setAuthorityMetadata(e,t){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(){var e=this.generateCacheKey("active-account-filters"),t=this.getItem(e);if(!t){this.logger.trace("BrowserCacheManager.getActiveAccount: No active account filters cache schema found, looking for legacy schema");var r=this.generateCacheKey("active-account"),n=this.getItem(r);if(!n)return this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null;var o=this.getAccountInfoFilteredBy({localAccountId:n});return o?(this.logger.trace("BrowserCacheManager.getActiveAccount: Legacy active account cache schema found"),this.logger.trace("BrowserCacheManager.getActiveAccount: Adding active account filters cache schema"),this.setActiveAccount(o),o):null}var a=this.validateAndParseJson(t);return a?(this.logger.trace("BrowserCacheManager.getActiveAccount: Active account filters schema found"),this.getAccountInfoFilteredBy({homeAccountId:a.homeAccountId,localAccountId:a.localAccountId,tenantId:a.tenantId})):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null)}setActiveAccount(e){var t=this.generateCacheKey("active-account-filters"),r=this.generateCacheKey("active-account");e?(this.logger.verbose("setActiveAccount: Active account set"),this.browserStorage.setItem(t,JSON.stringify({homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId})),this.browserStorage.setItem(r,e.localAccountId)):(this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(t),this.browserStorage.removeItem(r))}getThrottlingCache(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null;var r=this.validateAndParseJson(t);return r&&function(i,e){var t=!1;i&&(t=0===i.indexOf("throttling"));var r=!0;return e&&(r=e.hasOwnProperty("throttleTime")),t&&r}(e,r)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),r):(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null)}setThrottlingCache(e,t){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.setItem(e,JSON.stringify(t))}getTemporaryCache(e,t){var r=t?this.generateCacheKey(e):e;if(this.cacheConfig.storeAuthStateInCookie){var n=this.cookieStorage.getItem(r);if(n)return this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),n}var o=this.temporaryCacheStorage.getItem(r);if(!o){if(this.cacheConfig.cacheLocation===ie_LocalStorage){var a=this.browserStorage.getItem(r);if(a)return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),a}return this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null}return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),o}setTemporaryCache(e,t,r){var n=r?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(n,t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.cookieStorage.setItem(n,t,void 0,this.cacheConfig.secureCookies))}removeItem(e){this.browserStorage.removeItem(e)}removeTemporaryItem(e){this.temporaryCacheStorage.removeItem(e),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.cookieStorage.removeItem(e))}getKeys(){return this.browserStorage.getKeys()}clear(){var e=this;return(0,p.A)(function*(){yield e.removeAllAccounts(),e.removeAppMetadata(),e.temporaryCacheStorage.getKeys().forEach(t=>{(-1!==t.indexOf(C.CACHE_PREFIX)||-1!==t.indexOf(e.clientId))&&e.removeTemporaryItem(t)}),e.browserStorage.getKeys().forEach(t=>{(-1!==t.indexOf(C.CACHE_PREFIX)||-1!==t.indexOf(e.clientId))&&e.browserStorage.removeItem(t)}),e.internalStorage.clear()})()}clearTokensAndKeysWithClaims(e,t){var r=this;return(0,p.A)(function*(){e.addQueueMeasurement(g.ClearTokensAndKeysWithClaims,t);var n=r.getTokenKeys(),o=[];n.accessToken.forEach(a=>{var s=r.getAccessTokenCredential(a);s?.requestedClaimsHash&&a.includes(s.requestedClaimsHash.toLowerCase())&&o.push(r.removeAccessToken(a))}),yield Promise.all(o),o.length>0&&r.logger.warning(`${o.length} access tokens with claims in the cache keys have been removed from the cache.`)})()}generateCacheKey(e){return this.validateAndParseJson(e)?JSON.stringify(e):he.startsWith(e,C.CACHE_PREFIX)||he.startsWith(e,"adal.idtoken")?e:`${C.CACHE_PREFIX}.${this.clientId}.${e}`}generateAuthorityKey(e){var{libraryState:{id:t}}=me.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`authority.${t}`)}generateNonceKey(e){var{libraryState:{id:t}}=me.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`nonce.id_token.${t}`)}generateStateKey(e){var{libraryState:{id:t}}=me.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`request.state.${t}`)}getCachedAuthority(e){var t=this.generateStateKey(e),r=this.getTemporaryCache(t);if(!r)return null;var n=this.generateAuthorityKey(r);return this.getTemporaryCache(n)}updateCacheEntries(e,t,r,n,o){this.logger.trace("BrowserCacheManager.updateCacheEntries called");var a=this.generateStateKey(e);this.setTemporaryCache(a,e,!1);var s=this.generateNonceKey(e);this.setTemporaryCache(s,t,!1);var c=this.generateAuthorityKey(e);this.setTemporaryCache(c,r,!1),o?this.setTemporaryCache("ccs.credential",JSON.stringify({credential:o.homeAccountId,type:"home_account_id"}),!0):n&&this.setTemporaryCache("ccs.credential",JSON.stringify({credential:n,type:"UPN"}),!0)}resetRequestCache(e){this.logger.trace("BrowserCacheManager.resetRequestCache called"),e&&(this.temporaryCacheStorage.getKeys().forEach(t=>{-1!==t.indexOf(e)&&this.removeTemporaryItem(t)}),this.removeTemporaryItem(this.generateStateKey(e)),this.removeTemporaryItem(this.generateNonceKey(e)),this.removeTemporaryItem(this.generateAuthorityKey(e))),this.removeTemporaryItem(this.generateCacheKey("request.params")),this.removeTemporaryItem(this.generateCacheKey("request.origin")),this.removeTemporaryItem(this.generateCacheKey("urlHash")),this.removeTemporaryItem(this.generateCacheKey("request.correlationId")),this.removeTemporaryItem(this.generateCacheKey("ccs.credential")),this.removeTemporaryItem(this.generateCacheKey("request.native")),this.setInteractionInProgress(!1)}cleanRequestByState(e){if(this.logger.trace("BrowserCacheManager.cleanRequestByState called"),e){var t=this.generateStateKey(e),r=this.temporaryCacheStorage.getItem(t);this.logger.infoPii(`BrowserCacheManager.cleanRequestByState: Removing temporary cache items for state: ${r}`),this.resetRequestCache(r||C.EMPTY_STRING)}}cleanRequestByInteractionType(e){this.logger.trace("BrowserCacheManager.cleanRequestByInteractionType called"),this.temporaryCacheStorage.getKeys().forEach(t=>{if(-1!==t.indexOf("request.state")){var r=this.temporaryCacheStorage.getItem(t);if(r){var n=Ia(this.cryptoImpl,r);n&&n.interactionType===e&&(this.logger.infoPii(`BrowserCacheManager.cleanRequestByInteractionType: Removing temporary cache items for state: ${r}`),this.resetRequestCache(r))}}}),this.setInteractionInProgress(!1)}cacheCodeRequest(e){this.logger.trace("BrowserCacheManager.cacheCodeRequest called");var t=hi(JSON.stringify(e));this.setTemporaryCache("request.params",t,!0)}getCachedRequest(e){this.logger.trace("BrowserCacheManager.getCachedRequest called");var r,t=this.getTemporaryCache("request.params",!0);if(!t)throw w(Xr);try{r=JSON.parse(Ie(t))}catch(a){throw this.logger.errorPii(`Attempted to parse: ${t}`),this.logger.error(`Parsing cached token request threw with error: ${a}`),w(Zr)}if(this.removeTemporaryItem(this.generateCacheKey("request.params")),!r.authority){var n=this.generateAuthorityKey(e),o=this.getTemporaryCache(n);if(!o)throw w(qt);r.authority=o}return r}getCachedNativeRequest(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");var e=this.getTemporaryCache("request.native",!0);return e?this.validateAndParseJson(e)||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null):(this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null)}isInteractionInProgress(e){var t=this.getInteractionInProgress();return e?t===this.clientId:!!t}getInteractionInProgress(){return this.getTemporaryCache(`${C.CACHE_PREFIX}.interaction.status`,!1)}setInteractionInProgress(e){var t=`${C.CACHE_PREFIX}.interaction.status`;if(e){if(this.getInteractionInProgress())throw w($t);this.setTemporaryCache(t,this.clientId,!1)}else!e&&this.getInteractionInProgress()===this.clientId&&this.removeTemporaryItem(t)}getLegacyLoginHint(){var e=this.getTemporaryCache("adal.idtoken");e&&(this.browserStorage.removeItem("adal.idtoken"),this.logger.verbose("Cached ADAL id token retrieved."));var t=this.getTemporaryCache(j_ID_TOKEN,!0);t&&(this.browserStorage.removeItem(this.generateCacheKey(j_ID_TOKEN)),this.logger.verbose("Cached MSAL.js v1 id token retrieved"));var r=t||e;if(r){var n=Qe(r,Ie);if(n.preferred_username)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 preferred_username as loginHint"),n.preferred_username;if(n.upn)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 upn as loginHint"),n.upn;this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, however, no account hint claim found. Enable preferred_username or upn id token claim to get SSO.")}return null}updateCredentialCacheKey(e,t){var r=st(t);if(e!==r){var n=this.getItem(e);if(n)return this.browserStorage.removeItem(e),this.setItem(r,n),this.logger.verbose(`Updated an outdated ${t.credentialType} cache key`),r;this.logger.error(`Attempted to update an outdated ${t.credentialType} cache key but no item matching the outdated key was found in storage`)}return e}hydrateCache(e,t){var r=this;return(0,p.A)(function*(){var o,n=An(e.account?.homeAccountId,e.account?.environment,e.idToken,r.clientId,e.tenantId);t.claims&&(o=yield r.cryptoImpl.hashString(t.claims));var a=Tn(e.account?.homeAccountId,e.account.environment,e.accessToken,r.clientId,e.tenantId,e.scopes.join(" "),e.expiresOn?e.expiresOn.getTime()/1e3:0,e.extExpiresOn?e.extExpiresOn.getTime()/1e3:0,Ie,void 0,e.tokenType,void 0,t.sshKid,t.claims,o);return r.saveCacheRecord({idToken:n,accessToken:a})})()}saveCacheRecord(e,t,r){var n=()=>super.saveCacheRecord,o=this;return(0,p.A)(function*(){try{yield n().call(o,e,t,r)}catch(s){if(s instanceof lt&&o.performanceClient&&r)try{var a=o.getTokenKeys();o.performanceClient.addFields({cacheRtCount:a.refreshToken.length,cacheIdCount:a.idToken.length,cacheAtCount:a.accessToken.length},r)}catch{}throw s}})()}}class el{constructor(e){this.eventCallbacks=new Map,this.logger=e||new Fe({})}addEventCallback(e,t,r){if(typeof window<"u"){var n=r||ke();return this.eventCallbacks.has(n)?(this.logger.error(`Event callback with id: ${n} is already registered. Please provide a unique id or remove the existing callback and try again.`),null):(this.eventCallbacks.set(n,[e,t||[]]),this.logger.verbose(`Event callback registered with id: ${n}`),n)}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose(`Event callback ${e} removed.`)}emitEvent(e,t,r,n){if(typeof window<"u"){var o={eventType:e,interactionType:t||null,payload:r||null,error:n||null,timestamp:Date.now()};this.eventCallbacks.forEach(([a,s],c)=>{(0===s.length||s.includes(e))&&(this.logger.verbose(`Emitting event to callback ${c}: ${e}`),a.apply(null,[o]))})}}}class Be extends G{constructor(e,t,r,n,o){super(e,t,r),this.name="ServerError",this.errorNo=n,this.status=o,Object.setPrototypeOf(this,Be.prototype)}}class Ee{static generateThrottlingStorageKey(e){return`throttling.${JSON.stringify(e)}`}static preProcess(e,t){var r=Ee.generateThrottlingStorageKey(t),n=e.getThrottlingCache(r);if(n){if(n.throttleTime<Date.now())return void e.removeItem(r);throw new Be(n.errorCodes?.join(" ")||C.EMPTY_STRING,n.errorMessage,n.subError)}}static postProcess(e,t,r){if(Ee.checkResponseStatus(r)||Ee.checkResponseForRetryAfter(r)){var n={throttleTime:Ee.calculateThrottleTime(parseInt(r.headers["Retry-After"])),error:r.body.error,errorCodes:r.body.error_codes,errorMessage:r.body.error_description,subError:r.body.suberror};e.setThrottlingCache(Ee.generateThrottlingStorageKey(t),n)}}static checkResponseStatus(e){return 429===e.status||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return!!e.headers&&e.headers.hasOwnProperty("Retry-After")&&(e.status<200||e.status>=300)}static calculateThrottleTime(e){var t=e<=0?0:e,r=Date.now()/1e3;return Math.floor(1e3*Math.min(r+(t||60),r+3600))}static removeThrottle(e,t,r,n){var a=this.generateThrottlingStorageKey({clientId:t,authority:r.authority,scopes:r.scopes,homeAccountIdentifier:n,claims:r.claims,authenticationScheme:r.authenticationScheme,resourceRequestMethod:r.resourceRequestMethod,resourceRequestUri:r.resourceRequestUri,shrClaims:r.shrClaims,sshKid:r.sshKid});e.removeItem(a)}}var Ye="client_id",Ea="redirect_uri",Sa="response_type",_a="token_type",wa="req_cnf",Ra="return_spa_code",Vi="brk_client_id",Yi="brk_redirect_uri";class ft{static validateRedirectUri(e){if(!e)throw $(ur)}static validatePrompt(e){var t=[];for(var r in J)t.push(J[r]);if(t.indexOf(e)<0)throw $(pr)}static validateClaims(e){try{JSON.parse(e)}catch{throw $(St)}}static validateCodeChallengeParams(e,t){if(!e||!t)throw $(_t);this.validateCodeChallengeMethod(t)}static validateCodeChallengeMethod(e){if([So.PLAIN,So.S256].indexOf(e)<0)throw $(Cr)}}class Xt{constructor(e,t){this.parameters=new Map,this.performanceClient=t,this.correlationId=e}addResponseTypeCode(){this.parameters.set(Sa,encodeURIComponent(C.CODE_RESPONSE_TYPE))}addResponseTypeForTokenAndIdToken(){this.parameters.set(Sa,encodeURIComponent(`${C.TOKEN_RESPONSE_TYPE} ${C.ID_TOKEN_RESPONSE_TYPE}`))}addResponseMode(e){this.parameters.set("response_mode",encodeURIComponent(e||ts.QUERY))}addNativeBroker(){this.parameters.set("nativebroker",encodeURIComponent("1"))}addScopes(e,t=!0,r=Je){t&&!r.includes("openid")&&!e.includes("openid")&&r.push("openid");var n=t?[...e||[],...r]:e||[],o=new W(n);this.parameters.set("scope",encodeURIComponent(o.printScopes()))}addClientId(e){this.parameters.set(Ye,encodeURIComponent(e))}addRedirectUri(e){ft.validateRedirectUri(e),this.parameters.set(Ea,encodeURIComponent(e))}addPostLogoutRedirectUri(e){ft.validateRedirectUri(e),this.parameters.set("post_logout_redirect_uri",encodeURIComponent(e))}addIdTokenHint(e){this.parameters.set("id_token_hint",encodeURIComponent(e))}addDomainHint(e){this.parameters.set("domain_hint",encodeURIComponent(e))}addLoginHint(e){this.parameters.set("login_hint",encodeURIComponent(e))}addCcsUpn(e){this.parameters.set("X-AnchorMailbox",encodeURIComponent(`UPN:${e}`))}addCcsOid(e){this.parameters.set("X-AnchorMailbox",encodeURIComponent(`Oid:${e.uid}@${e.utid}`))}addSid(e){this.parameters.set("sid",encodeURIComponent(e))}addClaims(e,t){var r=this.addClientCapabilitiesToClaims(e,t);ft.validateClaims(r),this.parameters.set("claims",encodeURIComponent(r))}addCorrelationId(e){this.parameters.set("client-request-id",encodeURIComponent(e))}addLibraryInfo(e){this.parameters.set("x-client-SKU",e.sku),this.parameters.set("x-client-VER",e.version),e.os&&this.parameters.set("x-client-OS",e.os),e.cpu&&this.parameters.set("x-client-CPU",e.cpu)}addApplicationTelemetry(e){e?.appName&&this.parameters.set("x-app-name",e.appName),e?.appVersion&&this.parameters.set("x-app-ver",e.appVersion)}addPrompt(e){ft.validatePrompt(e),this.parameters.set("prompt",encodeURIComponent(e))}addState(e){e&&this.parameters.set("state",encodeURIComponent(e))}addNonce(e){this.parameters.set("nonce",encodeURIComponent(e))}addCodeChallengeParams(e,t){if(ft.validateCodeChallengeParams(e,t),!e||!t)throw $(_t);this.parameters.set("code_challenge",encodeURIComponent(e)),this.parameters.set("code_challenge_method",encodeURIComponent(t))}addAuthorizationCode(e){this.parameters.set("code",encodeURIComponent(e))}addDeviceCode(e){this.parameters.set("device_code",encodeURIComponent(e))}addRefreshToken(e){this.parameters.set("refresh_token",encodeURIComponent(e))}addCodeVerifier(e){this.parameters.set("code_verifier",encodeURIComponent(e))}addClientSecret(e){this.parameters.set("client_secret",encodeURIComponent(e))}addClientAssertion(e){e&&this.parameters.set("client_assertion",encodeURIComponent(e))}addClientAssertionType(e){e&&this.parameters.set("client_assertion_type",encodeURIComponent(e))}addOboAssertion(e){this.parameters.set("assertion",encodeURIComponent(e))}addRequestTokenUse(e){this.parameters.set("requested_token_use",encodeURIComponent(e))}addGrantType(e){this.parameters.set("grant_type",encodeURIComponent(e))}addClientInfo(){this.parameters.set("client_info","1")}addExtraQueryParameters(e){Object.entries(e).forEach(([t,r])=>{!this.parameters.has(t)&&r&&this.parameters.set(t,r)})}addClientCapabilitiesToClaims(e,t){var r;if(e)try{r=JSON.parse(e)}catch{throw $(St)}else r={};return t&&t.length>0&&(r.hasOwnProperty("access_token")||(r.access_token={}),r.access_token.xms_cc={values:t}),JSON.stringify(r)}addUsername(e){this.parameters.set("username",encodeURIComponent(e))}addPassword(e){this.parameters.set("password",encodeURIComponent(e))}addPopToken(e){e&&(this.parameters.set(_a,F.POP),this.parameters.set(wa,encodeURIComponent(e)))}addSshJwk(e){e&&(this.parameters.set(_a,F.SSH),this.parameters.set(wa,encodeURIComponent(e)))}addServerTelemetry(e){this.parameters.set("x-client-current-telemetry",e.generateCurrentRequestHeaderValue()),this.parameters.set("x-client-last-telemetry",e.generateLastRequestHeaderValue())}addThrottling(){this.parameters.set("x-ms-lib-capability","retry-after, h429")}addLogoutHint(e){this.parameters.set("logout_hint",encodeURIComponent(e))}addBrokerParameters(e){var t={};t[Vi]=e.brokerClientId,t[Yi]=e.brokerRedirectUri,this.addExtraQueryParameters(t)}createQueryString(){var e=new Array;return this.parameters.forEach((t,r)=>{e.push(`${r}=${t}`)}),function(i,e,t){if(e){var r=i.get(Ye);r&&i.has(Vi)&&t?.addFields({embeddedClientId:r,embeddedRedirectUri:i.get(Ea)},e)}}(this.parameters,this.correlationId,this.performanceClient),e.join("&")}}function ka(i,e,t,r,n,o,a){return ji.apply(this,arguments)}function ji(){return ji=(0,p.A)(function*(i,e,t,r,n,o,a){a?.addQueueMeasurement(g.AuthorityFactoryCreateDiscoveredInstance,o);var s=re.transformCIAMAuthority(ya(i)),c=new re(s,e,t,r,n,o,a);try{return yield E(c.resolveEndpointsAsync.bind(c),g.AuthorityResolveEndpointsAsync,n,a,o)(),c}catch{throw A(ge)}}),ji.apply(this,arguments)}class Ji{constructor(e,t){this.config=function({authOptions:i,systemOptions:e,loggerOptions:t,cacheOptions:r,storageInterface:n,networkInterface:o,cryptoInterface:a,clientCredentials:s,libraryInfo:c,telemetry:l,serverTelemetryManager:d,persistencePlugin:h,serializableCache:u}){var f={...uc,...t};return{authOptions:yc(i),systemOptions:{...da,...e},loggerOptions:f,cacheOptions:{...hc,...r},storageInterface:n||new dc(i.clientId,yn,new Fe(f)),networkInterface:o||gc,cryptoInterface:a||yn,clientCredentials:s||pc,libraryInfo:{...fc,...c},telemetry:{...vc,...l},serverTelemetryManager:d||null,persistencePlugin:h||null,serializableCache:u||null}}(e),this.logger=new Fe(this.config.loggerOptions,jo,Pi),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}createTokenRequestHeaders(e){var t={};if(t["Content-Type"]=C.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case"home_account_id":try{var r=ct(e.credential);t["X-AnchorMailbox"]=`Oid:${r.uid}@${r.utid}`}catch(n){this.logger.verbose("Could not parse home account ID for CCS Header: "+n)}break;case"UPN":t["X-AnchorMailbox"]=`UPN: ${e.credential}`}return t}executePostToTokenEndpoint(e,t,r,n,o,a){var s=this;return(0,p.A)(function*(){a&&s.performanceClient?.addQueueMeasurement(a,o);var c=yield s.sendPostRequest(n,e,{body:t,headers:r},o);return s.config.serverTelemetryManager&&c.status<500&&429!==c.status&&s.config.serverTelemetryManager.clearTelemetryCache(),c})()}sendPostRequest(e,t,r,n){var o=this;return(0,p.A)(function*(){var a;Ee.preProcess(o.cacheManager,e);try{var s=(a=yield E(o.networkClient.sendPostRequestAsync.bind(o.networkClient),g.NetworkClientSendPostRequestAsync,o.logger,o.performanceClient,n)(t,r)).headers||{};o.performanceClient?.addFields({refreshTokenSize:a.body.refresh_token?.length||0,httpVerToken:s["x-ms-httpver"]||"",requestId:s["x-ms-request-id"]||""},n)}catch(l){if(l instanceof Rn){var c=l.responseHeaders;throw c&&o.performanceClient?.addFields({httpVerToken:c["x-ms-httpver"]||"",requestId:c["x-ms-request-id"]||"",contentTypeHeader:c["Content-Type"]||void 0,contentLengthHeader:c["Content-Length"]||void 0,httpStatus:l.httpStatus},n),l.error}throw l instanceof G?l:A(wr)}return Ee.postProcess(o.cacheManager,e,a),a})()}updateAuthority(e,t){var r=this;return(0,p.A)(function*(){r.performanceClient?.addQueueMeasurement(g.UpdateTokenEndpointAuthority,t);var n=`https://${e}/${r.authority.tenant}/`,o=yield ka(n,r.networkClient,r.cacheManager,r.authority.options,r.logger,t,r.performanceClient);r.authority=o})()}createTokenQueryParameters(e){var t=new Xt(e.correlationId,this.performanceClient);return e.embeddedClientId&&t.addBrokerParameters({brokerClientId:this.config.authOptions.clientId,brokerRedirectUri:this.config.authOptions.redirectUri}),e.tokenQueryParameters&&t.addExtraQueryParameters(e.tokenQueryParameters),t.addCorrelationId(e.correlationId),t.createQueryString()}}class pt{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}generateCnf(e,t){var r=this;return(0,p.A)(function*(){r.performanceClient?.addQueueMeasurement(g.PopTokenGenerateCnf,e.correlationId);var n=yield E(r.generateKid.bind(r),g.PopTokenGenerateCnf,t,r.performanceClient,e.correlationId)(e),o=r.cryptoUtils.base64UrlEncode(JSON.stringify(n));return{kid:n.kid,reqCnfString:o}})()}generateKid(e){var t=this;return(0,p.A)(function*(){return t.performanceClient?.addQueueMeasurement(g.PopTokenGenerateKid,e.correlationId),{kid:yield t.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:"sw"}})()}signPopToken(e,t,r){var n=this;return(0,p.A)(function*(){return n.signPayload(e,t,r)})()}signPayload(e,t,r,n){var o=this;return(0,p.A)(function*(){var{resourceRequestMethod:a,resourceRequestUri:s,shrClaims:c,shrNonce:l,shrOptions:d}=r,h=s?new H(s):void 0,u=h?.getUrlComponents();return o.cryptoUtils.signJwt({at:e,ts:Te(),m:a?.toUpperCase(),u:u?.HostNameAndPort,nonce:l||o.cryptoUtils.createNewGuid(),p:u?.AbsolutePath,q:u?.QueryString?[[],u.QueryString]:void 0,client_claims:c||void 0,...n},t,d,r.correlationId)})()}}class Kl{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}}class je{constructor(e,t,r,n,o,a,s){this.clientId=e,this.cacheStorage=t,this.cryptoObj=r,this.logger=n,this.serializableCache=o,this.persistencePlugin=a,this.performanceClient=s}validateServerAuthorizationCodeResponse(e,t){if(!e.state||!t)throw A(et,e.state?"Cached State":"Server State");var r,n;try{r=decodeURIComponent(e.state)}catch{throw A(Le,e.state)}try{n=decodeURIComponent(t)}catch{throw A(Le,e.state)}if(r!==n)throw A(kr);if(e.error||e.error_description||e.suberror){var o=function(i){var t=i.error_uri?.lastIndexOf("code=");return t&&t>=0?i.error_uri?.substring(t+5):void 0}(e);throw Ta(e.error,e.error_description,e.suberror)?new ue(e.error||"",e.error_description,e.suberror,e.timestamp||"",e.trace_id||"",e.correlation_id||"",e.claims||"",o):new Be(e.error||"",e.error_description,e.suberror,o)}}validateTokenResponse(e,t){if(e.error||e.error_description||e.suberror){var r=`Error(s): ${e.error_codes||C.NOT_AVAILABLE} - Timestamp: ${e.timestamp||C.NOT_AVAILABLE} - Description: ${e.error_description||C.NOT_AVAILABLE} - Correlation ID: ${e.correlation_id||C.NOT_AVAILABLE} - Trace ID: ${e.trace_id||C.NOT_AVAILABLE}`,n=e.error_codes?.length?e.error_codes[0]:void 0,o=new Be(e.error,r,e.suberror,n,e.status);if(t&&e.status&&e.status>=500&&e.status<=599)return void this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently unavailable and the access token is unable to be refreshed.\n${o}`);if(t&&e.status&&e.status>=400&&e.status<=499)return void this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently available but is unable to refresh the access token.\n${o}`);throw Ta(e.error,e.error_description,e.suberror)?new ue(e.error,e.error_description,e.suberror,e.timestamp||C.EMPTY_STRING,e.trace_id||C.EMPTY_STRING,e.correlation_id||C.EMPTY_STRING,e.claims||C.EMPTY_STRING,n):o}}handleServerTokenResponse(e,t,r,n,o,a,s,c,l){var d=this;return(0,p.A)(function*(){var h,f;if(d.performanceClient?.addQueueMeasurement(g.HandleServerTokenResponse,e.correlation_id),e.id_token){if(h=Qe(e.id_token||C.EMPTY_STRING,d.cryptoObj.base64Decode),o&&o.nonce&&h.nonce!==o.nonce)throw A(br);if(n.maxAge||0===n.maxAge){var u=h.auth_time;if(!u)throw A(Ot);Jo(u,n.maxAge)}}d.homeAccountIdentifier=Y.generateHomeAccountId(e.client_info||C.EMPTY_STRING,t.authorityType,d.logger,d.cryptoObj,h),o&&o.state&&(f=me.parseRequestState(d.cryptoObj,o.state)),e.key_id=e.key_id||n.sshKid||void 0;var v,m=d.generateCacheRecord(e,t,r,n,h,a,o);try{if(d.persistencePlugin&&d.serializableCache&&(d.logger.verbose("Persistence enabled, calling beforeCacheAccess"),v=new Kl(d.serializableCache,!0),yield d.persistencePlugin.beforeCacheAccess(v)),s&&!c&&m.account){var S=m.account.generateAccountKey();if(!d.cacheStorage.getAccount(S,d.logger))return d.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),yield je.generateAuthenticationResult(d.cryptoObj,t,m,!1,n,h,f,void 0,l)}yield d.cacheStorage.saveCacheRecord(m,n.storeInCache,n.correlationId)}finally{d.persistencePlugin&&d.serializableCache&&v&&(d.logger.verbose("Persistence enabled, calling afterCacheAccess"),yield d.persistencePlugin.afterCacheAccess(v))}return je.generateAuthenticationResult(d.cryptoObj,t,m,!1,n,h,f,e,l)})()}generateCacheRecord(e,t,r,n,o,a,s){var c=t.getPreferredCache();if(!c)throw A(Ut);var d,h,l=ia(o);e.id_token&&o&&(d=An(this.homeAccountIdentifier,c,e.id_token,this.clientId,l||""),h=Xi(this.cacheStorage,t,this.homeAccountIdentifier,this.cryptoObj.base64Decode,o,e.client_info,c,l,s,void 0,this.logger));var u=null;if(e.access_token){var f=e.scope?W.fromString(e.scope):new W(n.scopes||[]),m=("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0,v=("string"==typeof e.ext_expires_in?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,S=("string"==typeof e.refresh_in?parseInt(e.refresh_in,10):e.refresh_in)||void 0,T=r+m,R=T+v,V=S&&S>0?r+S:void 0;u=Tn(this.homeAccountIdentifier,c,e.access_token,this.clientId,l||t.tenant||"",f.printScopes(),T,R,this.cryptoObj.base64Decode,V,e.token_type,a,e.key_id,n.claims,n.requestedClaimsHash)}var K,ee=null;e.refresh_token&&(e.refresh_token_expires_in&&(K=r+("string"==typeof e.refresh_token_expires_in?parseInt(e.refresh_token_expires_in,10):e.refresh_token_expires_in)),ee=Xo(this.homeAccountIdentifier,c,e.refresh_token,this.clientId,e.foci,a,K));var Kn=null;return e.foci&&(Kn={clientId:this.clientId,environment:c,familyId:e.foci}),{account:h,idToken:d,accessToken:u,refreshToken:ee,appMetadata:Kn}}static generateAuthenticationResult(e,t,r,n,o,a,s,c,l){return(0,p.A)(function*(){var f,m,d=C.EMPTY_STRING,h=[],u=null,v=C.EMPTY_STRING;if(r.accessToken){if(r.accessToken.tokenType!==F.POP||o.popKid)d=r.accessToken.secret;else{var S=new pt(e),{secret:T,keyId:R}=r.accessToken;if(!R)throw A(xt);d=yield S.signPopToken(T,R,o)}h=W.fromString(r.accessToken.target).asArray(),u=new Date(1e3*Number(r.accessToken.expiresOn)),f=new Date(1e3*Number(r.accessToken.extendedExpiresOn)),r.accessToken.refreshOn&&(m=new Date(1e3*Number(r.accessToken.refreshOn)))}r.appMetadata&&(v="1"===r.appMetadata.familyId?"1":"");var V=a?.oid||a?.sub||"",ee=a?.tid||"";c?.spa_accountid&&r.account&&(r.account.nativeAccountId=c?.spa_accountid);var K=r.account?Di(r.account.getAccountInfo(),void 0,a,r.idToken?.secret):null;return{authority:t.canonicalAuthority,uniqueId:V,tenantId:ee,scopes:h,account:K,idToken:r?.idToken?.secret||"",idTokenClaims:a||{},accessToken:d,fromCache:n,expiresOn:u,extExpiresOn:f,refreshOn:m,correlationId:o.correlationId,requestId:l||C.EMPTY_STRING,familyId:v,tokenType:r.accessToken?.tokenType||C.EMPTY_STRING,state:s?s.userRequestState:C.EMPTY_STRING,cloudGraphHostName:r.account?.cloudGraphHostName||C.EMPTY_STRING,msGraphHost:r.account?.msGraphHost||C.EMPTY_STRING,code:c?.spa_code,fromNativeBroker:!1}})()}}function Xi(i,e,t,r,n,o,a,s,c,l,d){d?.verbose("setCachedAccount called");var u=i.getAccountKeys().find(R=>R.startsWith(t)),f=null;u&&(f=i.getAccount(u,d));var m=f||Y.createAccount({homeAccountId:t,idTokenClaims:n,clientInfo:o,environment:a,cloudGraphHostName:c?.cloud_graph_host_name,msGraphHost:c?.msgraph_host,nativeAccountId:l},e,r),v=m.tenantProfiles||[],S=s||m.realm;if(S&&!v.find(R=>R.tenantId===S)){var T=Ui(t,m.localAccountId,S,n);v.push(T)}return m.tenantProfiles=v,m}function ba(i,e,t){return Zi.apply(this,arguments)}function Zi(){return Zi=(0,p.A)(function*(i,e,t){return"string"==typeof i?i:i({clientId:e,tokenEndpoint:t})}),Zi.apply(this,arguments)}class Pa extends Ji{constructor(e,t){super(e,t),this.includeRedirectUri=!0,this.oidcDefaultScopes=this.config.authOptions.authority.options.OIDCOptions?.defaultScopes}getAuthCodeUrl(e){var t=this;return(0,p.A)(function*(){t.performanceClient?.addQueueMeasurement(g.GetAuthCodeUrl,e.correlationId);var r=yield E(t.createAuthCodeUrlQueryString.bind(t),g.AuthClientCreateQueryString,t.logger,t.performanceClient,e.correlationId)(e);return H.appendQueryString(t.authority.authorizationEndpoint,r)})()}acquireToken(e,t){var r=this;return(0,p.A)(function*(){if(r.performanceClient?.addQueueMeasurement(g.AuthClientAcquireToken,e.correlationId),!e.code)throw A(Nr);var n=Te(),o=yield E(r.executeTokenRequest.bind(r),g.AuthClientExecuteTokenRequest,r.logger,r.performanceClient,e.correlationId)(r.authority,e),a=o.headers?.["x-ms-request-id"],s=new je(r.config.authOptions.clientId,r.cacheManager,r.cryptoUtils,r.logger,r.config.serializableCache,r.config.persistencePlugin,r.performanceClient);return s.validateTokenResponse(o.body),E(s.handleServerTokenResponse.bind(s),g.HandleServerTokenResponse,r.logger,r.performanceClient,e.correlationId)(o.body,r.authority,n,e,t,void 0,void 0,void 0,a)})()}handleFragmentResponse(e,t){if(new je(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,null,null).validateServerAuthorizationCodeResponse(e,t),!e.code)throw A(Hr);return e}getLogoutUri(e){if(!e)throw $(vr);var t=this.createLogoutUrlQueryString(e);return H.appendQueryString(this.authority.endSessionEndpoint,t)}executeTokenRequest(e,t){var r=this;return(0,p.A)(function*(){r.performanceClient?.addQueueMeasurement(g.AuthClientExecuteTokenRequest,t.correlationId);var n=r.createTokenQueryParameters(t),o=H.appendQueryString(e.tokenEndpoint,n),a=yield E(r.createTokenRequestBody.bind(r),g.AuthClientCreateTokenRequestBody,r.logger,r.performanceClient,t.correlationId)(t),s=void 0;if(t.clientInfo)try{var c=En(t.clientInfo,r.cryptoUtils.base64Decode);s={credential:`${c.uid}${te.CLIENT_INFO_SEPARATOR}${c.utid}`,type:"home_account_id"}}catch(h){r.logger.verbose("Could not parse client info for CCS Header: "+h)}var l=r.createTokenRequestHeaders(s||t.ccsCredential),d={clientId:t.tokenBodyParameters?.clientId||r.config.authOptions.clientId,authority:e.canonicalAuthority,scopes:t.scopes,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid};return E(r.executePostToTokenEndpoint.bind(r),g.AuthorizationCodeClientExecutePostToTokenEndpoint,r.logger,r.performanceClient,t.correlationId)(o,a,l,d,t.correlationId,g.AuthorizationCodeClientExecutePostToTokenEndpoint)})()}createTokenRequestBody(e){var t=this;return(0,p.A)(function*(){t.performanceClient?.addQueueMeasurement(g.AuthClientCreateTokenRequestBody,e.correlationId);var r=new Xt(e.correlationId,t.performanceClient);if(r.addClientId(e.embeddedClientId||e.tokenBodyParameters?.[Ye]||t.config.authOptions.clientId),t.includeRedirectUri?r.addRedirectUri(e.redirectUri):ft.validateRedirectUri(e.redirectUri),r.addScopes(e.scopes,!0,t.oidcDefaultScopes),r.addAuthorizationCode(e.code),r.addLibraryInfo(t.config.libraryInfo),r.addApplicationTelemetry(t.config.telemetry.application),r.addThrottling(),t.serverTelemetryManager&&!Ki(t.config)&&r.addServerTelemetry(t.serverTelemetryManager),e.codeVerifier&&r.addCodeVerifier(e.codeVerifier),t.config.clientCredentials.clientSecret&&r.addClientSecret(t.config.clientCredentials.clientSecret),t.config.clientCredentials.clientAssertion){var n=t.config.clientCredentials.clientAssertion;r.addClientAssertion(yield ba(n.assertion,t.config.authOptions.clientId,e.resourceRequestUri)),r.addClientAssertionType(n.assertionType)}if(r.addGrantType("authorization_code"),r.addClientInfo(),e.authenticationScheme===F.POP){var a,o=new pt(t.cryptoUtils,t.performanceClient);a=e.popKid?t.cryptoUtils.encodeKid(e.popKid):(yield E(o.generateCnf.bind(o),g.PopTokenGenerateCnf,t.logger,t.performanceClient,e.correlationId)(e,t.logger)).reqCnfString,r.addPopToken(a)}else if(e.authenticationScheme===F.SSH){if(!e.sshJwk)throw $(Ze);r.addSshJwk(e.sshJwk)}(!he.isEmptyObj(e.claims)||t.config.authOptions.clientCapabilities&&t.config.authOptions.clientCapabilities.length>0)&&r.addClaims(e.claims,t.config.authOptions.clientCapabilities);var c=void 0;if(e.clientInfo)try{var l=En(e.clientInfo,t.cryptoUtils.base64Decode);c={credential:`${l.uid}${te.CLIENT_INFO_SEPARATOR}${l.utid}`,type:"home_account_id"}}catch(h){t.logger.verbose("Could not parse client info for CCS Header: "+h)}else c=e.ccsCredential;if(t.config.systemOptions.preventCorsPreflight&&c)switch(c.type){case"home_account_id":try{var d=ct(c.credential);r.addCcsOid(d)}catch(h){t.logger.verbose("Could not parse home account ID for CCS Header: "+h)}break;case"UPN":r.addCcsUpn(c.credential)}return e.embeddedClientId&&r.addBrokerParameters({brokerClientId:t.config.authOptions.clientId,brokerRedirectUri:t.config.authOptions.redirectUri}),e.tokenBodyParameters&&r.addExtraQueryParameters(e.tokenBodyParameters),e.enableSpaAuthorizationCode&&(!e.tokenBodyParameters||!e.tokenBodyParameters[Ra])&&r.addExtraQueryParameters({[Ra]:"1"}),r.createQueryString()})()}createAuthCodeUrlQueryString(e){var t=this;return(0,p.A)(function*(){var r=e.correlationId||t.config.cryptoInterface.createNewGuid();t.performanceClient?.addQueueMeasurement(g.AuthClientCreateQueryString,r);var n=new Xt(r,t.performanceClient);n.addClientId(e.embeddedClientId||e.extraQueryParameters?.[Ye]||t.config.authOptions.clientId);var o=[...e.scopes||[],...e.extraScopesToConsent||[]];if(n.addScopes(o,!0,t.oidcDefaultScopes),n.addRedirectUri(e.redirectUri),n.addCorrelationId(r),n.addResponseMode(e.responseMode),n.addResponseTypeCode(),n.addLibraryInfo(t.config.libraryInfo),Ki(t.config)||n.addApplicationTelemetry(t.config.telemetry.application),n.addClientInfo(),e.codeChallenge&&e.codeChallengeMethod&&n.addCodeChallengeParams(e.codeChallenge,e.codeChallengeMethod),e.prompt&&n.addPrompt(e.prompt),e.domainHint&&n.addDomainHint(e.domainHint),e.prompt!==J.SELECT_ACCOUNT)if(e.sid&&e.prompt===J.NONE)t.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),n.addSid(e.sid);else if(e.account){var a=t.extractAccountSid(e.account),s=t.extractLoginHint(e.account);if(s&&e.domainHint&&(t.logger.warning('AuthorizationCodeClient.createAuthCodeUrlQueryString: "domainHint" param is set, skipping opaque "login_hint" claim. Please consider not passing domainHint'),s=null),s){t.logger.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),n.addLoginHint(s);try{var c=ct(e.account.homeAccountId);n.addCcsOid(c)}catch{t.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(a&&e.prompt===J.NONE){t.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),n.addSid(a);try{var l=ct(e.account.homeAccountId);n.addCcsOid(l)}catch{t.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(e.loginHint)t.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),n.addLoginHint(e.loginHint),n.addCcsUpn(e.loginHint);else if(e.account.username){t.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),n.addLoginHint(e.account.username);try{var d=ct(e.account.homeAccountId);n.addCcsOid(d)}catch{t.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else e.loginHint&&(t.logger.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),n.addLoginHint(e.loginHint),n.addCcsUpn(e.loginHint));else t.logger.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");if(e.nonce&&n.addNonce(e.nonce),e.state&&n.addState(e.state),(e.claims||t.config.authOptions.clientCapabilities&&t.config.authOptions.clientCapabilities.length>0)&&n.addClaims(e.claims,t.config.authOptions.clientCapabilities),e.embeddedClientId&&n.addBrokerParameters({brokerClientId:t.config.authOptions.clientId,brokerRedirectUri:t.config.authOptions.redirectUri}),t.addExtraQueryParams(e,n),e.nativeBroker&&(n.addNativeBroker(),e.authenticationScheme===F.POP)){var u,h=new pt(t.cryptoUtils);u=e.popKid?t.cryptoUtils.encodeKid(e.popKid):(yield E(h.generateCnf.bind(h),g.PopTokenGenerateCnf,t.logger,t.performanceClient,e.correlationId)(e,t.logger)).reqCnfString,n.addPopToken(u)}return n.createQueryString()})()}createLogoutUrlQueryString(e){var t=new Xt(e.correlationId,this.performanceClient);return e.postLogoutRedirectUri&&t.addPostLogoutRedirectUri(e.postLogoutRedirectUri),e.correlationId&&t.addCorrelationId(e.correlationId),e.idTokenHint&&t.addIdTokenHint(e.idTokenHint),e.state&&t.addState(e.state),e.logoutHint&&t.addLogoutHint(e.logoutHint),this.addExtraQueryParams(e,t),t.createQueryString()}addExtraQueryParams(e,t){!(e.extraQueryParameters&&e.extraQueryParameters.hasOwnProperty("instance_aware"))&&this.config.authOptions.instanceAware&&(e.extraQueryParameters=e.extraQueryParameters||{},e.extraQueryParameters.instance_aware="true"),e.extraQueryParameters&&t.addExtraQueryParameters(e.extraQueryParameters)}extractAccountSid(e){return e.idTokenClaims?.sid||null}extractLoginHint(e){return e.idTokenClaims?.login_hint||null}}class Zt{constructor(e,t){this.cacheOutcome="0",this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||C.EMPTY_STRING,this.wrapperVer=e.wrapperVer||C.EMPTY_STRING,this.telemetryCacheKey=Z.CACHE_KEY+te.CACHE_KEY_SEPARATOR+e.clientId}generateCurrentRequestHeaderValue(){var e=`${this.apiId}${Z.VALUE_SEPARATOR}${this.cacheOutcome}`,t=[this.wrapperSKU,this.wrapperVer],r=this.getNativeBrokerErrorCode();r?.length&&t.push(`broker_error=${r}`);var n=t.join(Z.VALUE_SEPARATOR),a=[e,this.getRegionDiscoveryFields()].join(Z.VALUE_SEPARATOR);return[Z.SCHEMA_VERSION,a,n].join(Z.CATEGORY_SEPARATOR)}generateLastRequestHeaderValue(){var e=this.getLastRequests(),t=Zt.maxErrorsToSend(e),r=e.failedRequests.slice(0,2*t).join(Z.VALUE_SEPARATOR),n=e.errors.slice(0,t).join(Z.VALUE_SEPARATOR),o=e.errors.length,s=[o,t<o?Z.OVERFLOW_TRUE:Z.OVERFLOW_FALSE].join(Z.VALUE_SEPARATOR);return[Z.SCHEMA_VERSION,e.cacheHits,r,n,s].join(Z.CATEGORY_SEPARATOR)}cacheFailedRequest(e){var t=this.getLastRequests();t.errors.length>=Z.MAX_CACHED_ERRORS&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?t.errors.push(e instanceof G?e.subError?e.subError:e.errorCode?e.errorCode:e.toString():e.toString()):t.errors.push(Z.UNKNOWN_ERROR),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t)}incrementCacheHits(){var e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e),e.cacheHits}getLastRequests(){return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||{failedRequests:[],errors:[],cacheHits:0}}clearTelemetryCache(){var e=this.getLastRequests(),t=Zt.maxErrorsToSend(e);if(t===e.errors.length)this.cacheManager.removeItem(this.telemetryCacheKey);else{var n={failedRequests:e.failedRequests.slice(2*t),errors:e.errors.slice(t),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,n)}}static maxErrorsToSend(e){var t,r=0,n=0,o=e.errors.length;for(t=0;t<o;t++){var s=e.failedRequests[2*t+1]||C.EMPTY_STRING,c=e.errors[t]||C.EMPTY_STRING;if(!((n+=(e.failedRequests[2*t]||C.EMPTY_STRING).toString().length+s.toString().length+c.length+3)<Z.MAX_LAST_HEADER_BYTES))break;r+=1}return r}getRegionDiscoveryFields(){var e=[];return e.push(this.regionUsed||C.EMPTY_STRING),e.push(this.regionSource||C.EMPTY_STRING),e.push(this.regionOutcome||C.EMPTY_STRING),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}setNativeBrokerErrorCode(e){var t=this.getLastRequests();t.nativeBrokerErrorCode=e,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t)}getNativeBrokerErrorCode(){return this.getLastRequests().nativeBrokerErrorCode}clearNativeBrokerErrorCode(){var e=this.getLastRequests();delete e.nativeBrokerErrorCode,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e)}static makeExtraSkuString(e){return function(i){var{skus:e,libraryName:t,libraryVersion:r,extensionName:n,extensionVersion:o}=i,a=new Map([[0,[t,r]],[2,[n,o]]]),s=[];if(e?.length){if((s=e.split(",")).length<4)return e}else s=Array.from({length:4},()=>"|");return a.forEach((c,l)=>{2===c.length&&c[0]?.length&&c[1]?.length&&function(i){var{skuArr:e,index:t,skuName:r,skuVersion:n}=i;t>=e.length||(e[t]=[r,n].join("|"))}({skuArr:s,index:l,skuName:c[0],skuVersion:c[1]})}),s.join(",")}(e)}}class Ma{constructor(e,t,r,n,o,a,s,c,l){this.config=e,this.browserStorage=t,this.browserCrypto=r,this.networkClient=this.config.system.networkClient,this.eventHandler=o,this.navigationClient=a,this.nativeMessageHandler=c,this.correlationId=l||ke(),this.logger=n.clone(se.MSAL_SKU,kn,this.correlationId),this.performanceClient=s}clearCacheOnLogout(e){var t=this;return(0,p.A)(function*(){if(e){Y.accountInfoIsEqual(e,t.browserStorage.getActiveAccount(),!1)&&(t.logger.verbose("Setting active account to null"),t.browserStorage.setActiveAccount(null));try{yield t.browserStorage.removeAccount(Y.generateAccountCacheKey(e)),t.logger.verbose("Cleared cache items belonging to the account provided in the logout request.")}catch{t.logger.error("Account provided in logout request was not found. Local cache unchanged.")}}else try{t.logger.verbose("No account provided in logout request, clearing all cache items.",t.correlationId),yield t.browserStorage.clear(),yield t.browserCrypto.clearKeystore()}catch{t.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged.")}})()}getRedirectUri(e){return this.logger.verbose("getRedirectUri called"),H.getAbsoluteUrl(e||this.config.auth.redirectUri,be())}initializeServerTelemetryManager(e,t){this.logger.verbose("initializeServerTelemetryManager called");var r={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]};return new Zt(r,this.browserStorage)}getDiscoveredAuthority(e){var t=this;return(0,p.A)(function*(){var{account:r}=e,n=e.requestExtraQueryParameters&&e.requestExtraQueryParameters.hasOwnProperty("instance_aware")?e.requestExtraQueryParameters.instance_aware:void 0;t.performanceClient.addQueueMeasurement(g.StandardInteractionClientGetDiscoveredAuthority,t.correlationId);var o={protocolMode:t.config.auth.protocolMode,OIDCOptions:t.config.auth.OIDCOptions,knownAuthorities:t.config.auth.knownAuthorities,cloudDiscoveryMetadata:t.config.auth.cloudDiscoveryMetadata,authorityMetadata:t.config.auth.authorityMetadata,skipAuthorityMetadataCache:t.config.auth.skipAuthorityMetadataCache},a=e.requestAuthority||t.config.auth.authority,c=r&&(n?.length?"true"===n:t.config.auth.instanceAware)?t.config.auth.authority.replace(H.getDomainFromUrl(a),r.environment):a,l=re.generateAuthority(c,e.requestAzureCloudOptions||t.config.auth.azureCloudOptions),d=yield E(ka,g.AuthorityFactoryCreateDiscoveredInstance,t.logger,t.performanceClient,t.correlationId)(l,t.config.system.networkClient,t.browserStorage,o,t.logger,t.correlationId,t.performanceClient);if(r&&!d.isAlias(r.environment))throw $(Er);return d})()}}var Gl=32;function ql(i,e,t){return eo.apply(this,arguments)}function eo(){return eo=(0,p.A)(function*(i,e,t){i.addQueueMeasurement(g.GeneratePkceCodes,t);var r=Ve(zl,g.GenerateCodeVerifier,e,i,t)(i,e,t);return{verifier:r,challenge:yield E(Ql,g.GenerateCodeChallengeFromVerifier,e,i,t)(r,i,e,t)}}),eo.apply(this,arguments)}function zl(i,e,t){try{var r=new Uint8Array(Gl);return Ve(ms,g.GetRandomValues,e,i,t)(r),pn(r)}catch{throw w(Kt)}}function Ql(i,e,t,r){return to.apply(this,arguments)}function to(){return to=(0,p.A)(function*(i,e,t,r){e.addQueueMeasurement(g.GenerateCodeChallengeFromVerifier,r);try{var n=yield E(Ko,g.Sha256Digest,t,e,r)(i,e,r);return pn(new Uint8Array(n))}catch{throw w(Kt)}}),to.apply(this,arguments)}function ro(i,e,t,r){return no.apply(this,arguments)}function no(){return no=(0,p.A)(function*(i,e,t,r){t.addQueueMeasurement(g.InitializeBaseRequest,i.correlationId);var n=i.authority||e.auth.authority,o=[...i&&i.scopes||[]],a={...i,correlationId:i.correlationId,authority:n,scopes:o};if(a.authenticationScheme){if(a.authenticationScheme===F.SSH){if(!i.sshJwk)throw $(Ze);if(!i.sshKid)throw $(Ar)}r.verbose(`Authentication Scheme set to "${a.authenticationScheme}" as configured in Auth request`)}else a.authenticationScheme=F.BEARER,r.verbose('Authentication Scheme wasn\'t explicitly set in request, defaulting to "Bearer" request');return e.cache.claimsBasedCachingEnabled&&i.claims&&!he.isEmptyObj(i.claims)&&(a.requestedClaimsHash=yield Fo(i.claims)),a}),no.apply(this,arguments)}function Wl(i,e,t,r,n){return io.apply(this,arguments)}function io(){return io=(0,p.A)(function*(i,e,t,r,n){r.addQueueMeasurement(g.InitializeSilentRequest,i.correlationId);var o=yield E(ro,g.InitializeBaseRequest,n,r,i.correlationId)(i,t,r,n);return{...i,...o,account:e,forceRefresh:i.forceRefresh||!1}}),io.apply(this,arguments)}class mt extends Ma{initializeAuthorizationCodeRequest(e){var t=this;return(0,p.A)(function*(){t.performanceClient.addQueueMeasurement(g.StandardInteractionClientInitializeAuthorizationCodeRequest,t.correlationId);var r=yield E(ql,g.GeneratePkceCodes,t.logger,t.performanceClient,t.correlationId)(t.performanceClient,t.logger,t.correlationId),n={...e,redirectUri:e.redirectUri,code:C.EMPTY_STRING,codeVerifier:r.verifier};return e.codeChallenge=r.challenge,e.codeChallengeMethod=C.S256_CODE_CHALLENGE_METHOD,n})()}initializeLogoutRequest(e){this.logger.verbose("initializeLogoutRequest called",e?.correlationId);var t={correlationId:this.correlationId||ke(),...e};if(e)if(e.logoutHint)this.logger.verbose("logoutHint has already been set in logoutRequest");else if(e.account){var r=this.getLogoutHintFromIdTokenClaims(e.account);r&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),t.logoutHint=r)}else this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set");else this.logger.verbose("logoutHint will not be set since no logout request was configured");return e&&null===e.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",t.correlationId):e&&e.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",t.correlationId),t.postLogoutRedirectUri=H.getAbsoluteUrl(e.postLogoutRedirectUri,be())):null===this.config.auth.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",t.correlationId),t.postLogoutRedirectUri=H.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,be())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",t.correlationId),t.postLogoutRedirectUri=H.getAbsoluteUrl(be(),be())),t}getLogoutHintFromIdTokenClaims(e){var t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request")}else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null}createAuthCodeClient(e){var t=this;return(0,p.A)(function*(){t.performanceClient.addQueueMeasurement(g.StandardInteractionClientCreateAuthCodeClient,t.correlationId);var r=yield E(t.getClientConfiguration.bind(t),g.StandardInteractionClientGetClientConfiguration,t.logger,t.performanceClient,t.correlationId)(e);return new Pa(r,t.performanceClient)})()}getClientConfiguration(e){var t=this;return(0,p.A)(function*(){var{serverTelemetryManager:r,requestAuthority:n,requestAzureCloudOptions:o,requestExtraQueryParameters:a,account:s}=e;t.performanceClient.addQueueMeasurement(g.StandardInteractionClientGetClientConfiguration,t.correlationId);var c=yield E(t.getDiscoveredAuthority.bind(t),g.StandardInteractionClientGetDiscoveredAuthority,t.logger,t.performanceClient,t.correlationId)({requestAuthority:n,requestAzureCloudOptions:o,requestExtraQueryParameters:a,account:s}),l=t.config.system.loggerOptions;return{authOptions:{clientId:t.config.auth.clientId,authority:c,clientCapabilities:t.config.auth.clientCapabilities,redirectUri:t.config.auth.redirectUri},systemOptions:{tokenRenewalOffsetSeconds:t.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:l.loggerCallback,piiLoggingEnabled:l.piiLoggingEnabled,logLevel:l.logLevel,correlationId:t.correlationId},cacheOptions:{claimsBasedCachingEnabled:t.config.cache.claimsBasedCachingEnabled},cryptoInterface:t.browserCrypto,networkInterface:t.networkClient,storageInterface:t.browserStorage,serverTelemetryManager:r,libraryInfo:{sku:se.MSAL_SKU,version:kn,cpu:C.EMPTY_STRING,os:C.EMPTY_STRING},telemetry:t.config.telemetry}})()}initializeAuthorizationRequest(e,t){var r=this;return(0,p.A)(function*(){r.performanceClient.addQueueMeasurement(g.StandardInteractionClientInitializeAuthorizationRequest,r.correlationId);var n=r.getRedirectUri(e.redirectUri),a=me.setRequestState(r.browserCrypto,e&&e.state||C.EMPTY_STRING,{interactionType:t}),c={...yield E(ro,g.InitializeBaseRequest,r.logger,r.performanceClient,r.correlationId)({...e,correlationId:r.correlationId},r.config,r.performanceClient,r.logger),redirectUri:n,state:a,nonce:e.nonce||ke(),responseMode:r.config.auth.OIDCOptions.serverResponseType};if(e.loginHint||e.sid)return c;var l=e.account||r.browserStorage.getActiveAccount();if(l&&(r.logger.verbose("Setting validated request account",r.correlationId),r.logger.verbosePii(`Setting validated request account: ${l.homeAccountId}`,r.correlationId),c.account=l),!c.loginHint&&!l){var d=r.browserStorage.getLegacyLoginHint();d&&(c.loginHint=d)}return c})()}}var Ua="user_switch",rd={[Ua]:"User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again."};class Se extends G{constructor(e,t,r){super(e,t),Object.setPrototypeOf(this,Se.prototype),this.name="NativeAuthError",this.ext=r}}function vt(i){return!!(i.ext&&i.ext.status&&("PERSISTENT_ERROR"===i.ext.status||"DISABLED"===i.ext.status)||i.ext&&i.ext.error&&-2147186943===i.ext.error)||"ContentError"===i.errorCode}function oo(i,e,t){if(t&&t.status)switch(t.status){case"ACCOUNT_UNAVAILABLE":return Qi(Pn);case"USER_INTERACTION_REQUIRED":return new ue(i,e);case"USER_CANCEL":return w(ye);case"NO_NETWORK":return w(it)}return new Se(i,rd[i]||e,t)}class ao extends Ji{constructor(e,t){super(e,t)}acquireToken(e){var t=this;return(0,p.A)(function*(){t.performanceClient?.addQueueMeasurement(g.RefreshTokenClientAcquireToken,e.correlationId);var r=Te(),n=yield E(t.executeTokenRequest.bind(t),g.RefreshTokenClientExecuteTokenRequest,t.logger,t.performanceClient,e.correlationId)(e,t.authority),o=n.headers?.["x-ms-request-id"],a=new je(t.config.authOptions.clientId,t.cacheManager,t.cryptoUtils,t.logger,t.config.serializableCache,t.config.persistencePlugin);return a.validateTokenResponse(n.body),E(a.handleServerTokenResponse.bind(a),g.HandleServerTokenResponse,t.logger,t.performanceClient,e.correlationId)(n.body,t.authority,r,e,void 0,void 0,!0,e.forceCache,o)})()}acquireTokenByRefreshToken(e){var t=this;return(0,p.A)(function*(){if(!e)throw $(mr);if(t.performanceClient?.addQueueMeasurement(g.RefreshTokenClientAcquireTokenByRefreshToken,e.correlationId),!e.account)throw A(Mt);if(t.cacheManager.isAppMetadataFOCI(e.account.environment))try{return yield E(t.acquireTokenWithCachedRefreshToken.bind(t),g.RefreshTokenClientAcquireTokenWithCachedRefreshToken,t.logger,t.performanceClient,e.correlationId)(e,!0)}catch(a){if(a instanceof ue&&a.errorCode===ht||a instanceof Be&&"invalid_grant"===a.errorCode&&"client_mismatch"===a.subError)return E(t.acquireTokenWithCachedRefreshToken.bind(t),g.RefreshTokenClientAcquireTokenWithCachedRefreshToken,t.logger,t.performanceClient,e.correlationId)(e,!1);throw a}return E(t.acquireTokenWithCachedRefreshToken.bind(t),g.RefreshTokenClientAcquireTokenWithCachedRefreshToken,t.logger,t.performanceClient,e.correlationId)(e,!1)})()}acquireTokenWithCachedRefreshToken(e,t){var r=this;return(0,p.A)(function*(){r.performanceClient?.addQueueMeasurement(g.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId);var n=Ve(r.cacheManager.getRefreshToken.bind(r.cacheManager),g.CacheManagerGetRefreshToken,r.logger,r.performanceClient,e.correlationId)(e.account,t,void 0,r.performanceClient,e.correlationId);if(!n)throw Qi(ht);if(n.expiresOn&&Oi(n.expiresOn,e.refreshTokenExpirationOffsetSeconds||300))throw Qi(zi);var o={...e,refreshToken:n.secret,authenticationScheme:e.authenticationScheme||F.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:"home_account_id"}};try{return yield E(r.acquireToken.bind(r),g.RefreshTokenClientAcquireToken,r.logger,r.performanceClient,e.correlationId)(o)}catch(s){if(s instanceof ue&&s.subError===gt){r.logger.verbose("acquireTokenWithRefreshToken: bad refresh token, removing from cache");var a=st(n);r.cacheManager.removeRefreshToken(a)}throw s}})()}executeTokenRequest(e,t){var r=this;return(0,p.A)(function*(){r.performanceClient?.addQueueMeasurement(g.RefreshTokenClientExecuteTokenRequest,e.correlationId);var n=r.createTokenQueryParameters(e),o=H.appendQueryString(t.tokenEndpoint,n),a=yield E(r.createTokenRequestBody.bind(r),g.RefreshTokenClientCreateTokenRequestBody,r.logger,r.performanceClient,e.correlationId)(e),s=r.createTokenRequestHeaders(e.ccsCredential),c={clientId:e.tokenBodyParameters?.clientId||r.config.authOptions.clientId,authority:t.canonicalAuthority,scopes:e.scopes,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid};return E(r.executePostToTokenEndpoint.bind(r),g.RefreshTokenClientExecutePostToTokenEndpoint,r.logger,r.performanceClient,e.correlationId)(o,a,s,c,e.correlationId,g.RefreshTokenClientExecutePostToTokenEndpoint)})()}createTokenRequestBody(e){var t=this;return(0,p.A)(function*(){t.performanceClient?.addQueueMeasurement(g.RefreshTokenClientCreateTokenRequestBody,e.correlationId);var n=new Xt(e.correlationId,t.performanceClient);if(n.addClientId(e.embeddedClientId||e.tokenBodyParameters?.[Ye]||t.config.authOptions.clientId),e.redirectUri&&n.addRedirectUri(e.redirectUri),n.addScopes(e.scopes,!0,t.config.authOptions.authority.options.OIDCOptions?.defaultScopes),n.addGrantType("refresh_token"),n.addClientInfo(),n.addLibraryInfo(t.config.libraryInfo),n.addApplicationTelemetry(t.config.telemetry.application),n.addThrottling(),t.serverTelemetryManager&&!Ki(t.config)&&n.addServerTelemetry(t.serverTelemetryManager),n.addRefreshToken(e.refreshToken),t.config.clientCredentials.clientSecret&&n.addClientSecret(t.config.clientCredentials.clientSecret),t.config.clientCredentials.clientAssertion){var o=t.config.clientCredentials.clientAssertion;n.addClientAssertion(yield ba(o.assertion,t.config.authOptions.clientId,e.resourceRequestUri)),n.addClientAssertionType(o.assertionType)}if(e.authenticationScheme===F.POP){var s,a=new pt(t.cryptoUtils,t.performanceClient);s=e.popKid?t.cryptoUtils.encodeKid(e.popKid):(yield E(a.generateCnf.bind(a),g.PopTokenGenerateCnf,t.logger,t.performanceClient,e.correlationId)(e,t.logger)).reqCnfString,n.addPopToken(s)}else if(e.authenticationScheme===F.SSH){if(!e.sshJwk)throw $(Ze);n.addSshJwk(e.sshJwk)}if((!he.isEmptyObj(e.claims)||t.config.authOptions.clientCapabilities&&t.config.authOptions.clientCapabilities.length>0)&&n.addClaims(e.claims,t.config.authOptions.clientCapabilities),t.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case"home_account_id":try{var l=ct(e.ccsCredential.credential);n.addCcsOid(l)}catch(d){t.logger.verbose("Could not parse home account ID for CCS Header: "+d)}break;case"UPN":n.addCcsUpn(e.ccsCredential.credential)}return e.embeddedClientId&&n.addBrokerParameters({brokerClientId:t.config.authOptions.clientId,brokerRedirectUri:t.config.authOptions.redirectUri}),e.tokenBodyParameters&&n.addExtraQueryParameters(e.tokenBodyParameters),n.createQueryString()})()}}class id extends Ji{constructor(e,t){super(e,t)}acquireToken(e){var t=this;return(0,p.A)(function*(){try{var[r,n]=yield t.acquireCachedToken({...e,scopes:e.scopes?.length?e.scopes:[...Je]});return"4"===n&&(t.logger.info("SilentFlowClient:acquireCachedToken - Cached access token's refreshOn property has been exceeded'. It's not expired, but must be refreshed."),new ao(t.config,t.performanceClient).acquireTokenByRefreshToken(e).catch(()=>{})),r}catch(s){if(s instanceof Fr&&s.errorCode===fe)return new ao(t.config,t.performanceClient).acquireTokenByRefreshToken(e);throw s}})()}acquireCachedToken(e){var t=this;return(0,p.A)(function*(){t.performanceClient?.addQueueMeasurement(g.SilentFlowClientAcquireCachedToken,e.correlationId);var r="0";if(e.forceRefresh||!t.config.cacheOptions.claimsBasedCachingEnabled&&!he.isEmptyObj(e.claims))throw t.setCacheOutcome("1",e.correlationId),A(fe);if(!e.account)throw A(Mt);var n=e.account.tenantId||function(i){var t=new H(i).getUrlComponents(),r=t.PathSegments.slice(-1)[0]?.toLowerCase();switch(r){case"common":case"organizations":case"consumers":return;default:return r}}(e.authority),o=t.cacheManager.getTokenKeys(),a=t.cacheManager.getAccessToken(e.account,e,o,n,t.performanceClient,e.correlationId);if(!a)throw t.setCacheOutcome("2",e.correlationId),A(fe);if(function(i){return Number(i)>Te()}(a.cachedAt)||Oi(a.expiresOn,t.config.systemOptions.tokenRenewalOffsetSeconds))throw t.setCacheOutcome("3",e.correlationId),A(fe);a.refreshOn&&Oi(a.refreshOn,0)&&(r="4");var s=e.authority||t.authority.getPreferredCache(),c={account:t.cacheManager.readAccountFromCache(e.account),accessToken:a,idToken:t.cacheManager.getIdToken(e.account,o,n,t.performanceClient,e.correlationId),refreshToken:null,appMetadata:t.cacheManager.readAppMetadataFromCache(s)};return t.setCacheOutcome(r,e.correlationId),t.config.serverTelemetryManager&&t.config.serverTelemetryManager.incrementCacheHits(),[yield E(t.generateResultFromCacheRecord.bind(t),g.SilentFlowClientGenerateResultFromCacheRecord,t.logger,t.performanceClient,e.correlationId)(c,e),r]})()}setCacheOutcome(e,t){this.serverTelemetryManager?.setCacheOutcome(e),this.performanceClient?.addFields({cacheOutcome:e},t),"0"!==e&&this.logger.info(`Token refresh is required due to cache outcome: ${e}`)}generateResultFromCacheRecord(e,t){var r=this;return(0,p.A)(function*(){var n;if(r.performanceClient?.addQueueMeasurement(g.SilentFlowClientGenerateResultFromCacheRecord,t.correlationId),e.idToken&&(n=Qe(e.idToken.secret,r.config.cryptoInterface.base64Decode)),t.maxAge||0===t.maxAge){var o=n?.auth_time;if(!o)throw A(Ot);Jo(o,t.maxAge)}return je.generateAuthenticationResult(r.cryptoUtils,r.authority,e,!0,t,n)})()}}class Da extends mt{acquireToken(e){var t=this;return(0,p.A)(function*(){t.performanceClient.addQueueMeasurement(g.SilentCacheClientAcquireToken,e.correlationId);var r=t.initializeServerTelemetryManager(61),n=yield E(t.getClientConfiguration.bind(t),g.StandardInteractionClientGetClientConfiguration,t.logger,t.performanceClient,t.correlationId)({serverTelemetryManager:r,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}),o=new id(n,t.performanceClient);t.logger.verbose("Silent auth client created");try{var s=(yield E(o.acquireCachedToken.bind(o),g.SilentFlowClientAcquireCachedToken,t.logger,t.performanceClient,e.correlationId)(e))[0];return t.performanceClient.addFields({fromCache:!0},e.correlationId),s}catch(c){throw c instanceof Yt&&c.errorCode===Wt&&t.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),c}})()}logout(e){this.logger.verbose("logoutRedirect called");var t=this.initializeLogoutRequest(e);return this.clearCacheOnLogout(t?.account)}}class Ct extends Ma{constructor(e,t,r,n,o,a,s,c,l,d,h,u){super(e,t,r,n,o,a,c,l,u),this.apiId=s,this.accountId=d,this.nativeMessageHandler=l,this.nativeStorageManager=h,this.silentCacheClient=new Da(e,this.nativeStorageManager,r,n,o,a,c,l,u),this.serverTelemetryManager=this.initializeServerTelemetryManager(this.apiId);var f="ppnbnpeolgkicgegkbkbjmhlideopiji"===this.nativeMessageHandler.getExtensionId()?"chrome":this.nativeMessageHandler.getExtensionId()?.length?"unknown":void 0;this.skus=Zt.makeExtraSkuString({libraryName:se.MSAL_SKU,libraryVersion:kn,extensionName:f,extensionVersion:this.nativeMessageHandler.getExtensionVersion()})}addRequestSKUs(e){e.extraParameters={...e.extraParameters,"x-client-xtra-sku":this.skus}}acquireToken(e){var t=this;return(0,p.A)(function*(){t.performanceClient.addQueueMeasurement(g.NativeInteractionClientAcquireToken,e.correlationId),t.logger.trace("NativeInteractionClient - acquireToken called.");var r=t.performanceClient.startMeasurement(g.NativeInteractionClientAcquireToken,e.correlationId),n=Te();try{var o=yield t.initializeNativeRequest(e);try{var a=yield t.acquireTokensFromCache(t.accountId,o);return r.end({success:!0,isNativeBroker:!1,fromCache:!0}),a}catch{t.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call")}var{...s}=o,c={method:"GetToken",request:s},l=yield t.nativeMessageHandler.sendMessage(c),d=t.validateNativeResponse(l);return yield t.handleNativeResponse(d,o,n).then(h=>(r.end({success:!0,isNativeBroker:!0,requestId:h.requestId}),t.serverTelemetryManager.clearNativeBrokerErrorCode(),h)).catch(h=>{throw r.end({success:!1,errorCode:h.errorCode,subErrorCode:h.subError,isNativeBroker:!0}),h})}catch(h){throw h instanceof Se&&t.serverTelemetryManager.setNativeBrokerErrorCode(h.errorCode),h}})()}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:W.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}acquireTokensFromCache(e,t){var r=this;return(0,p.A)(function*(){if(!e)throw r.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),A(Dt);var n=r.browserStorage.getBaseAccountInfo({nativeAccountId:e});if(!n)throw A(Dt);try{var o=r.createSilentCacheRequest(t,n),a=yield r.silentCacheClient.acquireToken(o),s={...n,idTokenClaims:a?.idTokenClaims,idToken:a?.idToken};return{...a,account:s}}catch(c){throw c}})()}acquireTokenRedirect(e,t){var r=this;return(0,p.A)(function*(){r.logger.trace("NativeInteractionClient - acquireTokenRedirect called.");var{...n}=e;delete n.onRedirectNavigate;var o=yield r.initializeNativeRequest(n),a={method:"GetToken",request:o};try{var s=yield r.nativeMessageHandler.sendMessage(a);r.validateNativeResponse(s)}catch(d){if(d instanceof Se&&(r.serverTelemetryManager.setNativeBrokerErrorCode(d.errorCode),vt(d)))throw d}r.browserStorage.setTemporaryCache("request.native",JSON.stringify(o),!0);var c={apiId:861,timeout:r.config.system.redirectNavigationTimeout,noHistory:!1},l=r.config.auth.navigateToLoginRequestUrl?window.location.href:r.getRedirectUri(e.redirectUri);t.end({success:!0}),yield r.navigationClient.navigateExternal(l,c)})()}handleRedirectPromise(e,t){var r=this;return(0,p.A)(function*(){if(r.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!r.browserStorage.isInteractionInProgress(!0))return r.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;var n=r.browserStorage.getCachedNativeRequest();if(!n)return r.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),e&&t&&e?.addFields({errorCode:"no_cached_request"},t),null;var{prompt:o,...a}=n;o&&r.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),r.browserStorage.removeItem(r.browserStorage.generateCacheKey("request.native"));var s={method:"GetToken",request:a},c=Te();try{r.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker.");var l=yield r.nativeMessageHandler.sendMessage(s);r.validateNativeResponse(l);var d=r.handleNativeResponse(l,a,c);r.browserStorage.setInteractionInProgress(!1);var h=yield d;return r.serverTelemetryManager.clearNativeBrokerErrorCode(),h}catch(u){throw r.browserStorage.setInteractionInProgress(!1),u}})()}logout(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")}handleNativeResponse(e,t,r){var n=this;return(0,p.A)(function*(){n.logger.trace("NativeInteractionClient - handleNativeResponse called.");var o=Qe(e.id_token,Ie),a=n.createHomeAccountIdentifier(e,o),s=n.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t.accountId})?.homeAccountId;if(a!==s&&e.account.id!==t.accountId)throw oo(Ua);var c=yield n.getDiscoveredAuthority({requestAuthority:t.authority}),l=Xi(n.browserStorage,c,a,Ie,o,e.client_info,void 0,o.tid,void 0,e.account.id,n.logger),d=yield n.generateAuthenticationResult(e,t,o,l,c.canonicalAuthority,r);return n.cacheAccount(l),n.cacheNativeTokens(e,t,a,o,e.access_token,d.tenantId,r),d})()}createHomeAccountIdentifier(e,t){return Y.generateHomeAccountId(e.client_info||C.EMPTY_STRING,0,this.logger,this.browserCrypto,t)}generateScopes(e,t){return W.fromString(e.scope?e.scope:t.scope)}generatePopAccessToken(e,t){var r=this;return(0,p.A)(function*(){if(t.tokenType===F.POP&&t.signPopToken){if(e.shr)return r.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),e.shr;var n=new pt(r.browserCrypto),o={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce};if(!t.keyId)throw A(xt);return n.signPopToken(e.access_token,t.keyId,o)}return e.access_token})()}generateAuthenticationResult(e,t,r,n,o,a){var s=this;return(0,p.A)(function*(){var c=s.addTelemetryFromNativeResponse(e),l=W.fromString(e.scope?e.scope:t.scope),d=e.account.properties||{},h=d.UID||r.oid||r.sub||C.EMPTY_STRING,u=d.TenantId||r.tid||C.EMPTY_STRING,f=Di(n.getAccountInfo(),void 0,r,e.id_token);f.nativeAccountId!==e.account.id&&(f.nativeAccountId=e.account.id);var m=yield s.generatePopAccessToken(e,t),v=t.tokenType===F.POP?F.POP:F.BEARER;return{authority:o,uniqueId:h,tenantId:u,scopes:l.asArray(),account:f,idToken:e.id_token,idTokenClaims:r,accessToken:m,fromCache:!!c&&s.isResponseFromCache(c),expiresOn:new Date(1e3*Number(a+e.expires_in)),tokenType:v,correlationId:s.correlationId,state:e.state,fromNativeBroker:!0}})()}cacheAccount(e){this.browserStorage.setAccount(e),this.browserStorage.removeAccountContext(e).catch(t=>{this.logger.error(`Error occurred while removing account context from browser storage. ${t}`)})}cacheNativeTokens(e,t,r,n,o,a,s){var c=An(r,t.authority,e.id_token||"",t.clientId,n.tid||""),d=s+(t.tokenType===F.POP?C.SHR_NONCE_VALIDITY:("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0),h=this.generateScopes(e,t),u=Tn(r,t.authority,o,t.clientId,n.tid||a,h.printScopes(),d,0,Ie,void 0,t.tokenType,void 0,t.keyId);this.nativeStorageManager.saveCacheRecord({idToken:c,accessToken:u},t.storeInCache)}addTelemetryFromNativeResponse(e){var t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.nativeMessageHandler.getExtensionId(),extensionVersion:this.nativeMessageHandler.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}validateNativeResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw ko(Et,"Response missing expected properties.")}getMATSFromResponse(e){if(e.properties.MATS)try{return JSON.parse(e.properties.MATS)}catch{this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null}isResponseFromCache(e){return typeof e.is_cached>"u"?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!e.is_cached}initializeNativeRequest(e){var t=this;return(0,p.A)(function*(){t.logger.trace("NativeInteractionClient - initializeNativeRequest called");var r=e.authority||t.config.auth.authority;e.account&&(yield t.getDiscoveredAuthority({requestAuthority:r,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}));var n=new H(r);n.validateAsUri();var{scopes:o,...a}=e,s=new W(o||[]);s.appendScopes(Je);var l={...a,accountId:t.accountId,clientId:t.config.auth.clientId,authority:n.urlString,scope:s.printScopes(),redirectUri:t.getRedirectUri(e.redirectUri),prompt:(()=>{switch(t.apiId){case 863:case 61:return t.logger.trace("initializeNativeRequest: silent request sets prompt to none"),J.NONE}if(e.prompt)switch(e.prompt){case J.NONE:case J.CONSENT:case J.LOGIN:return t.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),e.prompt;default:throw t.logger.trace(`initializeNativeRequest: prompt = ${e.prompt} is not compatible with native flow`),w(dn)}else t.logger.trace("initializeNativeRequest: prompt was not provided")})(),correlationId:t.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:{...e.extraQueryParameters,...e.tokenQueryParameters},extendedExpiryToken:!1,keyId:e.popKid};if(l.signPopToken&&e.popKid)throw w(hn);if(t.handleExtraBrokerParams(l),l.extraParameters=l.extraParameters||{},l.extraParameters.telemetry="MATS",e.authenticationScheme===F.POP){var u,d={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce},h=new pt(t.browserCrypto);if(l.keyId)u=t.browserCrypto.base64UrlEncode(JSON.stringify({kid:l.keyId})),l.signPopToken=!1;else{var f=yield E(h.generateCnf.bind(h),g.PopTokenGenerateCnf,t.logger,t.performanceClient,e.correlationId)(d,t.logger);u=f.reqCnfString,l.keyId=f.kid,l.signPopToken=!0}l.reqCnf=u}return t.addRequestSKUs(l),l})()}handleExtraBrokerParams(e){var t=e.extraParameters&&e.extraParameters.hasOwnProperty(Vi)&&e.extraParameters.hasOwnProperty(Yi)&&e.extraParameters.hasOwnProperty(Ye);if(e.embeddedClientId||t){var r="",n=e.redirectUri;e.embeddedClientId?(e.redirectUri=this.config.auth.redirectUri,r=e.embeddedClientId):e.extraParameters&&(e.redirectUri=e.extraParameters[Yi],r=e.extraParameters[Ye]),e.extraParameters={child_client_id:r,child_redirect_uri:n},this.performanceClient?.addFields({embeddedClientId:r,embeddedRedirectUri:n},e.correlationId)}}}class _e{constructor(e,t,r,n){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=n,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=r,this.handshakeEvent=r.startMeasurement(g.NativeMessageHandlerHandshake)}sendMessage(e){var t=this;return(0,p.A)(function*(){t.logger.trace("NativeMessageHandler - sendMessage called.");var r={channel:ot_CHANNEL_ID,extensionId:t.extensionId,responseId:ke(),body:e};return t.logger.trace("NativeMessageHandler - Sending request to browser extension"),t.logger.tracePii(`NativeMessageHandler - Sending request to browser extension: ${JSON.stringify(r)}`),t.messageChannel.port1.postMessage(r),new Promise((n,o)=>{t.resolvers.set(r.responseId,{resolve:n,reject:o})})})()}static createProvider(e,t,r){return(0,p.A)(function*(){e.trace("NativeMessageHandler - createProvider called.");try{var n=new _e(e,t,r,"ppnbnpeolgkicgegkbkbjmhlideopiji");return yield n.sendHandshakeRequest(),n}catch{var o=new _e(e,t,r);return yield o.sendHandshakeRequest(),o}})()}sendHandshakeRequest(){var e=this;return(0,p.A)(function*(){e.logger.trace("NativeMessageHandler - sendHandshakeRequest called."),window.addEventListener("message",e.windowListener,!1);var t={channel:ot_CHANNEL_ID,extensionId:e.extensionId,responseId:ke(),body:{method:"Handshake"}};return e.handshakeEvent.add({extensionId:e.extensionId,extensionHandshakeTimeoutMs:e.handshakeTimeoutMs}),e.messageChannel.port1.onmessage=r=>{e.onChannelMessage(r)},window.postMessage(t,window.origin,[e.messageChannel.port2]),new Promise((r,n)=>{e.handshakeResolvers.set(t.responseId,{resolve:r,reject:n}),e.timeoutId=window.setTimeout(()=>{window.removeEventListener("message",e.windowListener,!1),e.messageChannel.port1.close(),e.messageChannel.port2.close(),e.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),n(w(sn)),e.handshakeResolvers.delete(t.responseId)},e.handshakeTimeoutMs)})})()}onWindowMessage(e){if(this.logger.trace("NativeMessageHandler - onWindowMessage called"),e.source===window){var t=e.data;if(t.channel&&t.channel===ot_CHANNEL_ID&&(!t.extensionId||t.extensionId===this.extensionId)&&"Handshake"===t.body.method){var r=this.handshakeResolvers.get(t.responseId);if(!r)return void this.logger.trace(`NativeMessageHandler.onWindowMessage - resolver can't be found for request ${t.responseId}`);this.logger.verbose(t.extensionId?`Extension with id: ${t.extensionId} not installed`:"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),r.reject(w(cn))}}}onChannelMessage(e){this.logger.trace("NativeMessageHandler - onChannelMessage called.");var t=e.data,r=this.resolvers.get(t.responseId),n=this.handshakeResolvers.get(t.responseId);try{var o=t.body.method;if("Response"===o){if(!r)return;var a=t.body.response;if(this.logger.trace("NativeMessageHandler - Received response from browser extension"),this.logger.tracePii(`NativeMessageHandler - Received response from browser extension: ${JSON.stringify(a)}`),"Success"!==a.status)r.reject(oo(a.code,a.description,a.ext));else{if(!a.result)throw ko(Et,"Event does not contain result.");a.result.code&&a.result.description?r.reject(oo(a.result.code,a.result.description,a.result.ext)):r.resolve(a.result)}this.resolvers.delete(t.responseId)}else if("HandshakeResponse"===o){if(!n)return void this.logger.trace(`NativeMessageHandler.onChannelMessage - resolver can't be found for request ${t.responseId}`);clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose(`NativeMessageHandler - Received HandshakeResponse from extension: ${this.extensionId}`),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),n.resolve(),this.handshakeResolvers.delete(t.responseId)}}catch(s){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii(`Error parsing response from WAM Extension: ${s}`),this.logger.errorPii(`Unable to parse ${e}`),r?r.reject(s):n&&n.reject(s)}}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}static isNativeAvailable(e,t,r,n){if(t.trace("isNativeAvailable called"),!e.system.allowNativeBroker)return t.trace("isNativeAvailable: allowNativeBroker is not enabled, returning false"),!1;if(!r)return t.trace("isNativeAvailable: WAM extension provider is not initialized, returning false"),!1;if(n)switch(n){case F.BEARER:case F.POP:return t.trace("isNativeAvailable: authenticationScheme is supported, returning true"),!0;default:return t.trace("isNativeAvailable: authenticationScheme is not supported, returning false"),!1}return!0}}class so{constructor(e,t,r,n,o){this.authModule=e,this.browserStorage=t,this.authCodeRequest=r,this.logger=n,this.performanceClient=o}handleCodeResponse(e,t){var r=this;return(0,p.A)(function*(){var n;r.performanceClient.addQueueMeasurement(g.HandleCodeResponse,t.correlationId);try{n=r.authModule.handleFragmentResponse(e,t.state)}catch(o){throw o instanceof Be&&o.subError===ye?w(ye):o}return E(r.handleCodeResponseFromServer.bind(r),g.HandleCodeResponseFromServer,r.logger,r.performanceClient,t.correlationId)(n,t)})()}handleCodeResponseFromServer(e,t,r=!0){var n=this;return(0,p.A)(function*(){if(n.performanceClient.addQueueMeasurement(g.HandleCodeResponseFromServer,t.correlationId),n.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),n.authCodeRequest.code=e.code,e.cloud_instance_host_name&&(yield E(n.authModule.updateAuthority.bind(n.authModule),g.UpdateTokenEndpointAuthority,n.logger,n.performanceClient,t.correlationId)(e.cloud_instance_host_name,t.correlationId)),r&&(e.nonce=t.nonce||void 0),e.state=t.state,e.client_info)n.authCodeRequest.clientInfo=e.client_info;else{var o=n.createCcsCredentials(t);o&&(n.authCodeRequest.ccsCredential=o)}return yield E(n.authModule.acquireToken.bind(n.authModule),g.AuthClientAcquireToken,n.logger,n.performanceClient,t.correlationId)(n.authCodeRequest,e)})()}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:"home_account_id"}:e.loginHint?{credential:e.loginHint,type:"UPN"}:null}}function La(i,e,t){var r=Br(i);if(!r)throw bo(i)?(t.error(`A ${e} is present in the iframe but it does not contain known properties. It's likely that the ${e} has been replaced by code running on the redirectUri page.`),t.errorPii(`The ${e} detected is: ${i}`),w(Gr)):(t.error(`The request has returned to the redirectUri but a ${e} is not present. It's likely that the ${e} has been removed or the page has been redirected by code running on the redirectUri page.`),w($r));return r}class ad extends mt{constructor(e,t,r,n,o,a,s,c,l,d){super(e,t,r,n,o,a,s,l,d),this.unloadWindow=this.unloadWindow.bind(this),this.nativeStorage=c}acquireToken(e){try{var r={popupName:this.generatePopupName(e.scopes||Je,e.authority||this.config.auth.authority),popupWindowAttributes:e.popupWindowAttributes||{},popupWindowParent:e.popupWindowParent??window};return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(e,r)):(this.logger.verbose("asyncPopup set to false, opening popup before acquiring token"),r.popup=this.openSizedPopup("about:blank",r),this.acquireTokenPopupAsync(e,r))}catch(n){return Promise.reject(n)}}logout(e){try{this.logger.verbose("logoutPopup called");var t=this.initializeLogoutRequest(e),r={popupName:this.generateLogoutPopupName(t),popupWindowAttributes:e?.popupWindowAttributes||{},popupWindowParent:e?.popupWindowParent??window},n=e&&e.authority,o=e&&e.mainWindowRedirectUri;return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(t,r,n,o)):(this.logger.verbose("asyncPopup set to false, opening popup"),r.popup=this.openSizedPopup("about:blank",r),this.logoutPopupAsync(t,r,n,o))}catch(a){return Promise.reject(a)}}acquireTokenPopupAsync(e,t){var r=this;return(0,p.A)(function*(){r.logger.verbose("acquireTokenPopupAsync called");var n=r.initializeServerTelemetryManager(862),o=yield E(r.initializeAuthorizationRequest.bind(r),g.StandardInteractionClientInitializeAuthorizationRequest,r.logger,r.performanceClient,r.correlationId)(e,k.Popup);qo(o.authority);try{var l,a=yield E(r.initializeAuthorizationCodeRequest.bind(r),g.StandardInteractionClientInitializeAuthorizationCodeRequest,r.logger,r.performanceClient,r.correlationId)(o),s=yield E(r.createAuthCodeClient.bind(r),g.StandardInteractionClientCreateAuthCodeClient,r.logger,r.performanceClient,r.correlationId)({serverTelemetryManager:n,requestAuthority:o.authority,requestAzureCloudOptions:o.azureCloudOptions,requestExtraQueryParameters:o.extraQueryParameters,account:o.account}),c=_e.isNativeAvailable(r.config,r.logger,r.nativeMessageHandler,e.authenticationScheme);c&&(l=r.performanceClient.startMeasurement(g.FetchAccountIdWithNativeBroker,e.correlationId));var d=yield s.getAuthCodeUrl({...o,nativeBroker:c}),h=new so(s,r.browserStorage,a,r.logger,r.performanceClient),u=r.initiateAuthRequest(d,t);r.eventHandler.emitEvent("msal:popupOpened",k.Popup,{popupWindow:u},null);var f=yield r.monitorPopupForHash(u,t.popupWindowParent),m=Ve(La,g.DeserializeResponse,r.logger,r.performanceClient,r.correlationId)(f,r.config.auth.OIDCOptions.serverResponseType,r.logger);if(Ee.removeThrottle(r.browserStorage,r.config.auth.clientId,a),m.accountId){if(r.logger.verbose("Account id found in hash, calling WAM for token"),l&&l.end({success:!0,isNativeBroker:!0}),!r.nativeMessageHandler)throw w(qe);var v=new Ct(r.config,r.browserStorage,r.browserCrypto,r.logger,r.eventHandler,r.navigationClient,862,r.performanceClient,r.nativeMessageHandler,m.accountId,r.nativeStorage,o.correlationId),{userRequestState:S}=me.parseRequestState(r.browserCrypto,o.state);return yield v.acquireToken({...o,state:S,prompt:void 0})}return yield h.handleCodeResponse(m,o)}catch(R){throw t.popup?.close(),R instanceof G&&(R.setCorrelationId(r.correlationId),n.cacheFailedRequest(R)),R}})()}logoutPopupAsync(e,t,r,n){var o=this;return(0,p.A)(function*(){o.logger.verbose("logoutPopupAsync called"),o.eventHandler.emitEvent("msal:logoutStart",k.Popup,e);var a=o.initializeServerTelemetryManager(962);try{yield o.clearCacheOnLogout(e.account);var d=(yield E(o.createAuthCodeClient.bind(o),g.StandardInteractionClientCreateAuthCodeClient,o.logger,o.performanceClient,o.correlationId)({serverTelemetryManager:a,requestAuthority:r,account:e.account||void 0})).getLogoutUri(e);o.eventHandler.emitEvent("msal:logoutSuccess",k.Popup,e);var h=o.openPopup(d,t);if(o.eventHandler.emitEvent("msal:popupOpened",k.Popup,{popupWindow:h},null),yield o.monitorPopupForHash(h,t.popupWindowParent).catch(()=>{}),n){var u={apiId:962,timeout:o.config.system.redirectNavigationTimeout,noHistory:!1},f=H.getAbsoluteUrl(n,be());o.logger.verbose("Redirecting main window to url specified in the request"),o.logger.verbosePii(`Redirecting main window to: ${f}`),yield o.navigationClient.navigateInternal(f,u)}else o.logger.verbose("No main window navigation requested")}catch(m){throw t.popup?.close(),m instanceof G&&(m.setCorrelationId(o.correlationId),a.cacheFailedRequest(m)),o.browserStorage.setInteractionInProgress(!1),o.eventHandler.emitEvent("msal:logoutFailure",k.Popup,null,m),o.eventHandler.emitEvent("msal:logoutEnd",k.Popup),m}o.eventHandler.emitEvent("msal:logoutEnd",k.Popup)})()}initiateAuthRequest(e,t){if(e)return this.logger.infoPii(`Navigate to: ${e}`),this.openPopup(e,t);throw this.logger.error("Navigate url is empty"),w(tt)}monitorPopupForHash(e,t){return new Promise((r,n)=>{this.logger.verbose("PopupHandler.monitorPopupForHash - polling started");var o=setInterval(()=>{if(e.closed)return this.logger.error("PopupHandler.monitorPopupForHash - window closed"),clearInterval(o),void n(w(ye));var a="";try{a=e.location.href}catch{}if(a&&"about:blank"!==a){clearInterval(o);var s="";e&&(s=this.config.auth.OIDCOptions.serverResponseType===At.QUERY?e.location.search:e.location.hash),this.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),r(s)}},this.config.system.pollIntervalMilliseconds)}).finally(()=>{this.cleanPopup(e,t)})}openPopup(e,t){try{var r;if(t.popup?(r=t.popup,this.logger.verbosePii(`Navigating popup window to: ${e}`),r.location.assign(e)):typeof t.popup>"u"&&(this.logger.verbosePii(`Opening popup window to: ${e}`),r=this.openSizedPopup(e,t)),!r)throw w(Wr);return r.focus&&r.focus(),this.currentWindow=r,t.popupWindowParent.addEventListener("beforeunload",this.unloadWindow),r}catch(n){throw this.logger.error("error opening popup "+n.message),this.browserStorage.setInteractionInProgress(!1),w(Qr)}}openSizedPopup(e,{popupName:t,popupWindowAttributes:r,popupWindowParent:n}){var o=n.screenLeft?n.screenLeft:n.screenX,a=n.screenTop?n.screenTop:n.screenY,s=n.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,c=n.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,l=r.popupSize?.width,d=r.popupSize?.height,h=r.popupPosition?.top,u=r.popupPosition?.left;return(!l||l<0||l>s)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),l=se.POPUP_WIDTH),(!d||d<0||d>c)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),d=se.POPUP_HEIGHT),(!h||h<0||h>c)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),h=Math.max(0,c/2-se.POPUP_HEIGHT/2+a)),(!u||u<0||u>s)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),u=Math.max(0,s/2-se.POPUP_WIDTH/2+o)),n.open(e,t,`width=${l}, height=${d}, top=${h}, left=${u}, scrollbars=yes`)}unloadWindow(e){this.browserStorage.cleanRequestByInteractionType(k.Popup),this.currentWindow&&this.currentWindow.close(),e.preventDefault()}cleanPopup(e,t){e.close(),t.removeEventListener("beforeunload",this.unloadWindow),this.browserStorage.setInteractionInProgress(!1)}generatePopupName(e,t){return`${se.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${e.join("-")}.${t}.${this.correlationId}`}generateLogoutPopupName(e){return`${se.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${e.account&&e.account.homeAccountId}.${this.correlationId}`}}class Ha{constructor(e,t,r,n,o){this.authModule=e,this.browserStorage=t,this.authCodeRequest=r,this.logger=n,this.performanceClient=o}initiateAuthRequest(e,t){var r=this;return(0,p.A)(function*(){if(r.logger.verbose("RedirectHandler.initiateAuthRequest called"),e){t.redirectStartPage&&(r.logger.verbose("RedirectHandler.initiateAuthRequest: redirectStartPage set, caching start page"),r.browserStorage.setTemporaryCache("request.origin",t.redirectStartPage,!0)),r.browserStorage.setTemporaryCache("request.correlationId",r.authCodeRequest.correlationId,!0),r.browserStorage.cacheCodeRequest(r.authCodeRequest),r.logger.infoPii(`RedirectHandler.initiateAuthRequest: Navigate to: ${e}`);var n={apiId:861,timeout:t.redirectTimeout,noHistory:!1};return"function"==typeof t.onRedirectNavigate?(r.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback"),!1!==t.onRedirectNavigate(e)?(r.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),void(yield t.navigationClient.navigateExternal(e,n))):void r.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation")):(r.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),void(yield t.navigationClient.navigateExternal(e,n)))}throw r.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),w(tt)})()}handleCodeResponse(e,t){var r=this;return(0,p.A)(function*(){r.logger.verbose("RedirectHandler.handleCodeResponse called"),r.browserStorage.setInteractionInProgress(!1);var a,n=r.browserStorage.generateStateKey(t),o=r.browserStorage.getTemporaryCache(n);if(!o)throw A(et,"Cached State");try{a=r.authModule.handleFragmentResponse(e,o)}catch(h){throw h instanceof Be&&h.subError===ye?w(ye):h}var s=r.browserStorage.generateNonceKey(o),c=r.browserStorage.getTemporaryCache(s);if(r.authCodeRequest.code=a.code,a.cloud_instance_host_name&&(yield E(r.authModule.updateAuthority.bind(r.authModule),g.UpdateTokenEndpointAuthority,r.logger,r.performanceClient,r.authCodeRequest.correlationId)(a.cloud_instance_host_name,r.authCodeRequest.correlationId)),a.nonce=c||void 0,a.state=o,a.client_info)r.authCodeRequest.clientInfo=a.client_info;else{var l=r.checkCcsCredentials();l&&(r.authCodeRequest.ccsCredential=l)}var d=yield r.authModule.acquireToken(r.authCodeRequest,a);return r.browserStorage.cleanRequestByState(t),d})()}checkCcsCredentials(){var e=this.browserStorage.getTemporaryCache("ccs.credential",!0);if(e)try{return JSON.parse(e)}catch{this.authModule.logger.error("Cache credential could not be parsed"),this.authModule.logger.errorPii(`Cache credential could not be parsed: ${e}`)}return null}}class cd extends mt{constructor(e,t,r,n,o,a,s,c,l,d){super(e,t,r,n,o,a,s,l,d),this.nativeStorage=c}acquireToken(e){var t=this;return(0,p.A)(function*(){var r=yield E(t.initializeAuthorizationRequest.bind(t),g.StandardInteractionClientInitializeAuthorizationRequest,t.logger,t.performanceClient,t.correlationId)(e,k.Redirect);t.browserStorage.updateCacheEntries(r.state,r.nonce,r.authority,r.loginHint||"",r.account||null);var n=t.initializeServerTelemetryManager(861),o=h=>{h.persisted&&(t.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),t.browserStorage.cleanRequestByState(r.state),t.eventHandler.emitEvent("msal:restoreFromBFCache",k.Redirect))};try{var a=yield E(t.initializeAuthorizationCodeRequest.bind(t),g.StandardInteractionClientInitializeAuthorizationCodeRequest,t.logger,t.performanceClient,t.correlationId)(r),s=yield E(t.createAuthCodeClient.bind(t),g.StandardInteractionClientCreateAuthCodeClient,t.logger,t.performanceClient,t.correlationId)({serverTelemetryManager:n,requestAuthority:r.authority,requestAzureCloudOptions:r.azureCloudOptions,requestExtraQueryParameters:r.extraQueryParameters,account:r.account}),c=new Ha(s,t.browserStorage,a,t.logger,t.performanceClient),l=yield s.getAuthCodeUrl({...r,nativeBroker:_e.isNativeAvailable(t.config,t.logger,t.nativeMessageHandler,e.authenticationScheme)}),d=t.getRedirectStartPage(e.redirectStartPage);return t.logger.verbosePii(`Redirect start page: ${d}`),window.addEventListener("pageshow",o),yield c.initiateAuthRequest(l,{navigationClient:t.navigationClient,redirectTimeout:t.config.system.redirectNavigationTimeout,redirectStartPage:d,onRedirectNavigate:e.onRedirectNavigate||t.config.auth.onRedirectNavigate})}catch(h){throw h instanceof G&&(h.setCorrelationId(t.correlationId),n.cacheFailedRequest(h)),window.removeEventListener("pageshow",o),t.browserStorage.cleanRequestByState(r.state),h}})()}handleRedirectPromise(e="",t){var r=this;return(0,p.A)(function*(){var n=r.initializeServerTelemetryManager(865);try{if(!r.browserStorage.isInteractionInProgress(!0))return r.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;var[o,a]=r.getRedirectResponse(e||"");if(!o)return r.logger.info("handleRedirectPromise did not detect a response as a result of a redirect. Cleaning temporary cache."),r.browserStorage.cleanRequestByInteractionType(k.Redirect),"back_forward"!==function(){if(!(typeof window>"u"||typeof window.performance>"u"||"function"!=typeof window.performance.getEntriesByType)){var i=window.performance.getEntriesByType("navigation"),e=i.length?i[0]:void 0;return e?.type}}()?t.event.errorCode="no_server_response":r.logger.verbose("Back navigation event detected. Muting no_server_response error"),null;var s=r.browserStorage.getTemporaryCache("request.origin",!0)||C.EMPTY_STRING;if(H.removeHashFromUrl(s)===H.removeHashFromUrl(window.location.href)&&r.config.auth.navigateToLoginRequestUrl)return r.logger.verbose("Current page is loginRequestUrl, handling response"),s.indexOf("#")>-1&&function(i){var e=i.split("#");e.shift(),window.location.hash=e.length>0?e.join("#"):""}(s),yield r.handleResponse(o,n);if(!r.config.auth.navigateToLoginRequestUrl)return r.logger.verbose("NavigateToLoginRequestUrl set to false, handling response"),yield r.handleResponse(o,n);if(!vn()||r.config.system.allowRedirectInIframe){r.browserStorage.setTemporaryCache("urlHash",a,!0);var h={apiId:865,timeout:r.config.system.redirectNavigationTimeout,noHistory:!0},u=!0;if(s&&"null"!==s)r.logger.verbose(`Navigating to loginRequestUrl: ${s}`),u=yield r.navigationClient.navigateInternal(s,h);else{var f=function(){var e=new H(window.location.href).getUrlComponents();return`${e.Protocol}//${e.HostNameAndPort}/`}();r.browserStorage.setTemporaryCache("request.origin",f,!0),r.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),u=yield r.navigationClient.navigateInternal(f,h)}if(!u)return yield r.handleResponse(o,n)}return null}catch(m){throw m instanceof G&&(m.setCorrelationId(r.correlationId),n.cacheFailedRequest(m)),r.browserStorage.cleanRequestByInteractionType(k.Redirect),m}})()}getRedirectResponse(e){this.logger.verbose("getRedirectResponseHash called");var t=e;t||(t=this.config.auth.OIDCOptions.serverResponseType===At.QUERY?window.location.search:window.location.hash);var r=Br(t);if(r){try{!function(i,e,t){if(!i.state)throw w(Bt);var r=Ia(e,i.state);if(!r)throw w(qr);if(r.interactionType!==t)throw w(zr)}(r,this.browserCrypto,k.Redirect)}catch(o){return o instanceof G&&this.logger.error(`Interaction type validation failed due to ${o.errorCode}: ${o.errorMessage}`),[null,""]}return function(i){i.location.hash="","function"==typeof i.history.replaceState&&i.history.replaceState(null,"",`${i.location.origin}${i.location.pathname}${i.location.search}`)}(window),this.logger.verbose("Hash contains known properties, returning response hash"),[r,t]}var n=this.browserStorage.getTemporaryCache("urlHash",!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey("urlHash")),n&&(r=Br(n))?(this.logger.verbose("Hash does not contain known properties, returning cached hash"),[r,n]):[null,""]}handleResponse(e,t){var r=this;return(0,p.A)(function*(){var n=e.state;if(!n)throw w(Bt);var o=r.browserStorage.getCachedRequest(n);if(r.logger.verbose("handleResponse called, retrieved cached request"),e.accountId){if(r.logger.verbose("Account id found in hash, calling WAM for token"),!r.nativeMessageHandler)throw w(qe);var a=new Ct(r.config,r.browserStorage,r.browserCrypto,r.logger,r.eventHandler,r.navigationClient,862,r.performanceClient,r.nativeMessageHandler,e.accountId,r.nativeStorage,o.correlationId),{userRequestState:s}=me.parseRequestState(r.browserCrypto,n);return a.acquireToken({...o,state:s,prompt:void 0}).finally(()=>{r.browserStorage.cleanRequestByState(n)})}var c=r.browserStorage.getCachedAuthority(n);if(!c)throw w(qt);var l=yield E(r.createAuthCodeClient.bind(r),g.StandardInteractionClientCreateAuthCodeClient,r.logger,r.performanceClient,r.correlationId)({serverTelemetryManager:t,requestAuthority:c});return Ee.removeThrottle(r.browserStorage,r.config.auth.clientId,o),new Ha(l,r.browserStorage,o,r.logger,r.performanceClient).handleCodeResponse(e,n)})()}logout(e){var t=this;return(0,p.A)(function*(){t.logger.verbose("logoutRedirect called");var r=t.initializeLogoutRequest(e),n=t.initializeServerTelemetryManager(961);try{t.eventHandler.emitEvent("msal:logoutStart",k.Redirect,e),yield t.clearCacheOnLogout(r.account);var o={apiId:961,timeout:t.config.system.redirectNavigationTimeout,noHistory:!1},s=(yield E(t.createAuthCodeClient.bind(t),g.StandardInteractionClientCreateAuthCodeClient,t.logger,t.performanceClient,t.correlationId)({serverTelemetryManager:n,requestAuthority:e&&e.authority,requestExtraQueryParameters:e?.extraQueryParameters,account:e&&e.account||void 0})).getLogoutUri(r);if(t.eventHandler.emitEvent("msal:logoutSuccess",k.Redirect,r),!e||"function"!=typeof e.onRedirectNavigate)return t.browserStorage.getInteractionInProgress()||t.browserStorage.setInteractionInProgress(!0),void(yield t.navigationClient.navigateExternal(s,o));if(!1!==e.onRedirectNavigate(s))return t.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),t.browserStorage.getInteractionInProgress()||t.browserStorage.setInteractionInProgress(!0),void(yield t.navigationClient.navigateExternal(s,o));t.browserStorage.setInteractionInProgress(!1),t.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation")}catch(l){throw l instanceof G&&(l.setCorrelationId(t.correlationId),n.cacheFailedRequest(l)),t.eventHandler.emitEvent("msal:logoutFailure",k.Redirect,null,l),t.eventHandler.emitEvent("msal:logoutEnd",k.Redirect),l}t.eventHandler.emitEvent("msal:logoutEnd",k.Redirect)})()}getRedirectStartPage(e){var t=e||window.location.href;return H.getAbsoluteUrl(t,be())}}function ld(i,e,t,r,n){return co.apply(this,arguments)}function co(){return co=(0,p.A)(function*(i,e,t,r,n){if(e.addQueueMeasurement(g.SilentHandlerInitiateAuthRequest,r),!i)throw t.info("Navigate url is empty"),w(tt);return n?E(ud,g.SilentHandlerLoadFrame,t,e,r)(i,n,e,r):Ve(hd,g.SilentHandlerLoadFrameSync,t,e,r)(i)}),co.apply(this,arguments)}function dd(i,e,t,r,n,o,a){return lo.apply(this,arguments)}function lo(){return lo=(0,p.A)(function*(i,e,t,r,n,o,a){return r.addQueueMeasurement(g.SilentHandlerMonitorIframeForHash,o),new Promise((s,c)=>{e<Fi&&n.warning(`system.loadFrameTimeout or system.iframeHashTimeout set to lower (${e}ms) than the default (${Fi}ms). This may result in timeouts.`);var l=window.setTimeout(()=>{window.clearInterval(d),c(w(Gt))},e),d=window.setInterval(()=>{var h="",u=i.contentWindow;try{h=u?u.location.href:""}catch{}if(h&&"about:blank"!==h){var f="";u&&(f=a===At.QUERY?u.location.search:u.location.hash),window.clearTimeout(l),window.clearInterval(d),s(f)}},t)}).finally(()=>{Ve(gd,g.RemoveHiddenIframe,n,r,o)(i)})}),lo.apply(this,arguments)}function ud(i,e,t,r){return t.addQueueMeasurement(g.SilentHandlerLoadFrame,r),new Promise((n,o)=>{var a=xa();window.setTimeout(()=>{a?(a.src=i,n(a)):o("Unable to load iframe")},e)})}function hd(i){var e=xa();return e.src=i,e}function xa(){var i=document.createElement("iframe");return i.className="msalSilentIframe",i.style.visibility="hidden",i.style.position="absolute",i.style.width=i.style.height="0",i.style.border="0",i.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.body.appendChild(i),i}function gd(i){document.body===i.parentNode&&document.body.removeChild(i)}class fd extends mt{constructor(e,t,r,n,o,a,s,c,l,d,h){super(e,t,r,n,o,a,c,d,h),this.apiId=s,this.nativeStorage=l}acquireToken(e){var t=this;return(0,p.A)(function*(){t.performanceClient.addQueueMeasurement(g.SilentIframeClientAcquireToken,e.correlationId),!e.loginHint&&!e.sid&&(!e.account||!e.account.username)&&t.logger.warning("No user hint provided. The authorization server may need more information to complete this request.");var r={...e};r.prompt?r.prompt!==J.NONE&&r.prompt!==J.NO_SESSION&&(t.logger.warning(`SilentIframeClient. Replacing invalid prompt ${r.prompt} with ${J.NONE}`),r.prompt=J.NONE):r.prompt=J.NONE;var n=yield E(t.initializeAuthorizationRequest.bind(t),g.StandardInteractionClientInitializeAuthorizationRequest,t.logger,t.performanceClient,e.correlationId)(r,k.Silent);qo(n.authority);var a,o=t.initializeServerTelemetryManager(t.apiId);try{return a=yield E(t.createAuthCodeClient.bind(t),g.StandardInteractionClientCreateAuthCodeClient,t.logger,t.performanceClient,e.correlationId)({serverTelemetryManager:o,requestAuthority:n.authority,requestAzureCloudOptions:n.azureCloudOptions,requestExtraQueryParameters:n.extraQueryParameters,account:n.account}),yield E(t.silentTokenHelper.bind(t),g.SilentIframeClientTokenHelper,t.logger,t.performanceClient,e.correlationId)(a,n)}catch(c){if(c instanceof G&&(c.setCorrelationId(t.correlationId),o.cacheFailedRequest(c)),!(a&&c instanceof G&&c.errorCode===se.INVALID_GRANT_ERROR))throw c;t.performanceClient.addFields({retryError:c.errorCode},t.correlationId);var s=yield E(t.initializeAuthorizationRequest.bind(t),g.StandardInteractionClientInitializeAuthorizationRequest,t.logger,t.performanceClient,e.correlationId)(r,k.Silent);return yield E(t.silentTokenHelper.bind(t),g.SilentIframeClientTokenHelper,t.logger,t.performanceClient,t.correlationId)(a,s)}})()}logout(){return Promise.reject(w(rt))}silentTokenHelper(e,t){var r=this;return(0,p.A)(function*(){var n=t.correlationId;r.performanceClient.addQueueMeasurement(g.SilentIframeClientTokenHelper,n);var o=yield E(r.initializeAuthorizationCodeRequest.bind(r),g.StandardInteractionClientInitializeAuthorizationCodeRequest,r.logger,r.performanceClient,n)(t),a=yield E(e.getAuthCodeUrl.bind(e),g.GetAuthCodeUrl,r.logger,r.performanceClient,n)({...t,nativeBroker:_e.isNativeAvailable(r.config,r.logger,r.nativeMessageHandler,t.authenticationScheme)}),s=new so(e,r.browserStorage,o,r.logger,r.performanceClient),c=yield E(ld,g.SilentHandlerInitiateAuthRequest,r.logger,r.performanceClient,n)(a,r.performanceClient,r.logger,n,r.config.system.navigateFrameWait),l=r.config.auth.OIDCOptions.serverResponseType,d=yield E(dd,g.SilentHandlerMonitorIframeForHash,r.logger,r.performanceClient,n)(c,r.config.system.iframeHashTimeout,r.config.system.pollIntervalMilliseconds,r.performanceClient,r.logger,n,l),h=Ve(La,g.DeserializeResponse,r.logger,r.performanceClient,r.correlationId)(d,l,r.logger);if(h.accountId){if(r.logger.verbose("Account id found in hash, calling WAM for token"),!r.nativeMessageHandler)throw w(qe);var u=new Ct(r.config,r.browserStorage,r.browserCrypto,r.logger,r.eventHandler,r.navigationClient,r.apiId,r.performanceClient,r.nativeMessageHandler,h.accountId,r.browserStorage,n),{userRequestState:f}=me.parseRequestState(r.browserCrypto,t.state);return E(u.acquireToken.bind(u),g.NativeInteractionClientAcquireToken,r.logger,r.performanceClient,n)({...t,state:f,prompt:t.prompt||J.NONE})}return E(s.handleCodeResponse.bind(s),g.HandleCodeResponse,r.logger,r.performanceClient,n)(h,t)})()}}class pd extends mt{acquireToken(e){var t=this;return(0,p.A)(function*(){t.performanceClient.addQueueMeasurement(g.SilentRefreshClientAcquireToken,e.correlationId);var r=yield E(ro,g.InitializeBaseRequest,t.logger,t.performanceClient,e.correlationId)(e,t.config,t.performanceClient,t.logger),n={...e,...r};e.redirectUri&&(n.redirectUri=t.getRedirectUri(e.redirectUri));var o=t.initializeServerTelemetryManager(61),a=yield t.createRefreshTokenClient({serverTelemetryManager:o,authorityUrl:n.authority,azureCloudOptions:n.azureCloudOptions,account:n.account});return E(a.acquireTokenByRefreshToken.bind(a),g.RefreshTokenClientAcquireTokenByRefreshToken,t.logger,t.performanceClient,e.correlationId)(n).catch(s=>{throw s.setCorrelationId(t.correlationId),o.cacheFailedRequest(s),s})})()}logout(){return Promise.reject(w(rt))}createRefreshTokenClient(e){var t=this;return(0,p.A)(function*(){var r=yield E(t.getClientConfiguration.bind(t),g.StandardInteractionClientGetClientConfiguration,t.logger,t.performanceClient,t.correlationId)({serverTelemetryManager:e.serverTelemetryManager,requestAuthority:e.authorityUrl,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return new ao(r,t.performanceClient)})()}}class md{constructor(e,t,r,n){this.isBrowserEnvironment=typeof window<"u",this.config=e,this.storage=t,this.logger=r,this.cryptoObj=n}loadExternalTokens(e,t,r){if(!this.isBrowserEnvironment)throw w(nt);var n=t.id_token?Qe(t.id_token,Ie):void 0,o={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},a=e.authority?new re(re.generateAuthority(e.authority,e.azureCloudOptions),this.config.system.networkClient,this.storage,o,this.logger,e.correlationId||ke()):void 0,s=this.loadAccount(e,r.clientInfo||t.client_info||"",n,a),c=this.loadIdToken(t,s.homeAccountId,s.environment,s.realm),l=this.loadAccessToken(e,t,s.homeAccountId,s.environment,s.realm,r),d=this.loadRefreshToken(t,s.homeAccountId,s.environment);return this.generateAuthenticationResult(e,{account:s,idToken:c,accessToken:l,refreshToken:d},n,a)}loadAccount(e,t,r,n){if(this.logger.verbose("TokenCache - loading account"),e.account){var o=Y.createFromAccountInfo(e.account);return this.storage.setAccount(o),o}if(!n||!t&&!r)throw this.logger.error("TokenCache - if an account is not provided on the request, authority and either clientInfo or idToken must be provided instead."),w(tn);var a=Y.generateHomeAccountId(t,n.authorityType,this.logger,this.cryptoObj,r),s=r?.tid,c=Xi(this.storage,n,a,Ie,r,t,n.hostnameAndPort,s,void 0,void 0,this.logger);return this.storage.setAccount(c),c}loadIdToken(e,t,r,n){if(!e.id_token)return this.logger.verbose("TokenCache - no id token found in response"),null;this.logger.verbose("TokenCache - loading id token");var o=An(t,r,e.id_token,this.config.auth.clientId,n);return this.storage.setIdTokenCredential(o),o}loadAccessToken(e,t,r,n,o,a){if(!t.access_token)return this.logger.verbose("TokenCache - no access token found in response"),null;if(!t.expires_in)return this.logger.error("TokenCache - no expiration set on the access token. Cannot add it to the cache."),null;if(!(t.scope||e.scopes&&e.scopes.length))return this.logger.error("TokenCache - scopes not specified in the request or response. Cannot add token to the cache."),null;this.logger.verbose("TokenCache - loading access token");var s=t.scope?W.fromString(t.scope):new W(e.scopes),c=a.expiresOn||t.expires_in+(new Date).getTime()/1e3,l=a.extendedExpiresOn||(t.ext_expires_in||t.expires_in)+(new Date).getTime()/1e3,d=Tn(r,n,t.access_token,this.config.auth.clientId,o,s.printScopes(),c,l,Ie);return this.storage.setAccessTokenCredential(d),d}loadRefreshToken(e,t,r){if(!e.refresh_token)return this.logger.verbose("TokenCache - no refresh token found in response"),null;this.logger.verbose("TokenCache - loading refresh token");var n=Xo(t,r,e.refresh_token,this.config.auth.clientId,e.foci,void 0,e.refresh_token_expires_in);return this.storage.setRefreshTokenCredential(n),n}generateAuthenticationResult(e,t,r,n){var c,o="",a=[],s=null;t?.accessToken&&(o=t.accessToken.secret,a=W.fromString(t.accessToken.target).asArray(),s=new Date(1e3*Number(t.accessToken.expiresOn)),c=new Date(1e3*Number(t.accessToken.extendedExpiresOn)));var l=t.account;return{authority:n?n.canonicalAuthority:"",uniqueId:t.account.localAccountId,tenantId:t.account.realm,scopes:a,account:l.getAccountInfo(),idToken:t.idToken?.secret||"",idTokenClaims:r||{},accessToken:o,fromCache:!0,expiresOn:s,correlationId:e.correlationId||"",requestId:"",extExpiresOn:c,familyId:t.refreshToken?.familyId||"",tokenType:t?.accessToken?.tokenType||"",state:e.state||"",cloudGraphHostName:l.cloudGraphHostName||"",msGraphHost:l.msGraphHost||"",fromNativeBroker:!1}}}class vd extends Pa{constructor(e){super(e),this.includeRedirectUri=!1}}class Cd extends mt{constructor(e,t,r,n,o,a,s,c,l,d){super(e,t,r,n,o,a,c,l,d),this.apiId=s}acquireToken(e){var t=this;return(0,p.A)(function*(){if(!e.code)throw w(rn);var r=yield E(t.initializeAuthorizationRequest.bind(t),g.StandardInteractionClientInitializeAuthorizationRequest,t.logger,t.performanceClient,e.correlationId)(e,k.Silent),n=t.initializeServerTelemetryManager(t.apiId);try{var o={...r,code:e.code},a=yield E(t.getClientConfiguration.bind(t),g.StandardInteractionClientGetClientConfiguration,t.logger,t.performanceClient,e.correlationId)({serverTelemetryManager:n,requestAuthority:r.authority,requestAzureCloudOptions:r.azureCloudOptions,requestExtraQueryParameters:r.extraQueryParameters,account:r.account}),s=new vd(a);t.logger.verbose("Auth code client created");var c=new so(s,t.browserStorage,o,t.logger,t.performanceClient);return yield E(c.handleCodeResponseFromServer.bind(c),g.HandleCodeResponseFromServer,t.logger,t.performanceClient,e.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},r,!1)}catch(l){throw l instanceof G&&(l.setCorrelationId(t.correlationId),n.cacheFailedRequest(l)),l}})()}logout(){return Promise.reject(w(rt))}}function we(i){var e=i?.idTokenClaims;return e?.tfp||e?.acr?"B2C":e?.tid?"9188040d-6c67-4c5b-b112-36a304b66dad"===e?.tid?"MSA":"AAD":void 0}function Nn(i,e){try{_i(i)}catch(t){throw e.end({success:!1},t),t}}class Mn{constructor(e){this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new ut(this.logger,this.performanceClient):yn,this.eventHandler=new el(this.logger),this.browserStorage=this.isBrowserEnvironment?new Wi(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,function(i){var e=i.cloudDiscoveryMetadata,t=void 0;if(e)try{t=JSON.parse(e)}catch{throw $(wt)}return{canonicalAuthority:i.authority?ya(i.authority):void 0,knownAuthorities:i.knownAuthorities,cloudDiscoveryMetadata:t}}(this.config.auth),this.performanceClient):((i,e)=>new Wi(this.config.auth.clientId,{cacheLocation:ie_MemoryStorage,temporaryCacheLocation:ie_MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1},yn,this.logger))(),this.nativeInternalStorage=new Wi(this.config.auth.clientId,{cacheLocation:ie_MemoryStorage,temporaryCacheLocation:ie_MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1},this.browserCrypto,this.logger,void 0,this.performanceClient),this.tokenCache=new md(this.config,this.browserStorage,this.logger,this.browserCrypto),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this),this.listeningToStorageEvents=!1,this.handleAccountCacheChange=this.handleAccountCacheChange.bind(this)}static createController(e,t){return(0,p.A)(function*(){var r=new Mn(e);return yield r.initialize(t),r})()}trackPageVisibility(e){e&&(this.logger.info("Perf: Visibility change detected"),this.performanceClient.incrementFields({visibilityChangeCount:1},e))}initialize(e){var t=this;return(0,p.A)(function*(){if(t.logger.trace("initialize called"),t.initialized)t.logger.info("initialize has already been called, exiting early.");else{if(!t.isBrowserEnvironment)return t.logger.info("in non-browser environment, exiting early."),t.initialized=!0,void t.eventHandler.emitEvent("msal:initializeEnd");var r=e?.correlationId||t.getRequestCorrelationId(),n=t.config.system.allowNativeBroker,o=t.performanceClient.startMeasurement(g.InitializeClientApplication,r);if(t.eventHandler.emitEvent("msal:initializeStart"),n)try{t.nativeExtensionProvider=yield _e.createProvider(t.logger,t.config.system.nativeBrokerHandshakeTimeout,t.performanceClient)}catch(a){t.logger.verbose(a)}t.config.cache.claimsBasedCachingEnabled||(t.logger.verbose("Claims-based caching is disabled. Clearing the previous cache with claims"),yield E(t.browserStorage.clearTokensAndKeysWithClaims.bind(t.browserStorage),g.ClearTokensAndKeysWithClaims,t.logger,t.performanceClient,r)(t.performanceClient,r)),t.initialized=!0,t.eventHandler.emitEvent("msal:initializeEnd"),o.end({allowNativeBroker:n,success:!0})}})()}handleRedirectPromise(e){var t=this;return(0,p.A)(function*(){if(t.logger.verbose("handleRedirectPromise called"),$o(t.initialized),t.isBrowserEnvironment){var r=e||"",n=t.redirectResponse.get(r);return typeof n>"u"?(n=t.handleRedirectPromiseInternal(e),t.redirectResponse.set(r,n),t.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise")):t.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call"),n}return t.logger.verbose("handleRedirectPromise returns null, not browser environment"),null})()}handleRedirectPromiseInternal(e){var t=this;return(0,p.A)(function*(){var c,r=t.getAllAccounts(),n=t.browserStorage.getCachedNativeRequest(),o=n&&_e.isNativeAvailable(t.config,t.logger,t.nativeExtensionProvider)&&t.nativeExtensionProvider&&!e,a=o?n?.correlationId:t.browserStorage.getTemporaryCache("request.correlationId",!0)||"",s=t.performanceClient.startMeasurement(g.AcquireTokenRedirect,a);if(t.eventHandler.emitEvent("msal:handleRedirectStart",k.Redirect),o&&t.nativeExtensionProvider){t.logger.trace("handleRedirectPromise - acquiring token from native platform");var l=new Ct(t.config,t.browserStorage,t.browserCrypto,t.logger,t.eventHandler,t.navigationClient,865,t.performanceClient,t.nativeExtensionProvider,n.accountId,t.nativeInternalStorage,n.correlationId);c=E(l.handleRedirectPromise.bind(l),g.HandleNativeRedirectPromiseMeasurement,t.logger,t.performanceClient,s.event.correlationId)(t.performanceClient,s.event.correlationId)}else{t.logger.trace("handleRedirectPromise - acquiring token from web flow");var d=t.createRedirectClient(a);c=E(d.handleRedirectPromise.bind(d),g.HandleRedirectPromiseMeasurement,t.logger,t.performanceClient,s.event.correlationId)(e,s)}return c.then(h=>(h?(r.length<t.getAllAccounts().length?(t.eventHandler.emitEvent("msal:loginSuccess",k.Redirect,h),t.logger.verbose("handleRedirectResponse returned result, login success")):(t.eventHandler.emitEvent("msal:acquireTokenSuccess",k.Redirect,h),t.logger.verbose("handleRedirectResponse returned result, acquire token success")),s.end({success:!0,accountType:we(h.account)})):s.event.errorCode?s.end({success:!1}):s.discard(),t.eventHandler.emitEvent("msal:handleRedirectEnd",k.Redirect),h)).catch(h=>{var u=h;throw t.eventHandler.emitEvent(r.length>0?"msal:acquireTokenFailure":"msal:loginFailure",k.Redirect,null,u),t.eventHandler.emitEvent("msal:handleRedirectEnd",k.Redirect),s.end({success:!1},u),h})})()}acquireTokenRedirect(e){var t=this;return(0,p.A)(function*(){var r=t.getRequestCorrelationId(e);t.logger.verbose("acquireTokenRedirect called",r);var n=t.performanceClient.startMeasurement(g.AcquireTokenPreRedirect,r);n.add({accountType:we(e.account),scenarioId:e.scenarioId});var o=e.onRedirectNavigate;if(o)e.onRedirectNavigate=h=>{var u="function"==typeof o?o(h):void 0;return!1!==u?n.end({success:!0}):n.discard(),u};else{var a=t.config.auth.onRedirectNavigate;t.config.auth.onRedirectNavigate=h=>{var u="function"==typeof a?a(h):void 0;return!1!==u?n.end({success:!0}):n.discard(),u}}var s=t.getAllAccounts().length>0;try{var c;return Go(t.initialized,t.config),t.browserStorage.setInteractionInProgress(!0),t.eventHandler.emitEvent(s?"msal:acquireTokenStart":"msal:loginStart",k.Redirect,e),c=t.nativeExtensionProvider&&t.canUseNative(e)?new Ct(t.config,t.browserStorage,t.browserCrypto,t.logger,t.eventHandler,t.navigationClient,861,t.performanceClient,t.nativeExtensionProvider,t.getNativeAccountId(e),t.nativeInternalStorage,r).acquireTokenRedirect(e,n).catch(h=>{if(h instanceof Se&&vt(h))return t.nativeExtensionProvider=void 0,t.createRedirectClient(r).acquireToken(e);if(h instanceof ue)return t.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow"),t.createRedirectClient(r).acquireToken(e);throw t.browserStorage.setInteractionInProgress(!1),h}):t.createRedirectClient(r).acquireToken(e),yield c}catch(h){throw n.end({success:!1},h),t.eventHandler.emitEvent(s?"msal:acquireTokenFailure":"msal:loginFailure",k.Redirect,null,h),h}})()}acquireTokenPopup(e){var t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(g.AcquireTokenPopup,t);r.add({scenarioId:e.scenarioId,accountType:we(e.account)});try{this.logger.verbose("acquireTokenPopup called",t),Nn(this.initialized,r),this.browserStorage.setInteractionInProgress(!0)}catch(s){return Promise.reject(s)}var n=this.getAllAccounts();return this.eventHandler.emitEvent(n.length>0?"msal:acquireTokenStart":"msal:loginStart",k.Popup,e),(this.canUseNative(e)?this.acquireTokenNative({...e,correlationId:t},862).then(s=>(this.browserStorage.setInteractionInProgress(!1),r.end({success:!0,isNativeBroker:!0,accountType:we(s.account)}),s)).catch(s=>{if(s instanceof Se&&vt(s))return this.nativeExtensionProvider=void 0,this.createPopupClient(t).acquireToken(e);if(s instanceof ue)return this.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createPopupClient(t).acquireToken(e);throw this.browserStorage.setInteractionInProgress(!1),s}):this.createPopupClient(t).acquireToken(e)).then(s=>{var c=n.length<this.getAllAccounts().length;return this.eventHandler.emitEvent(c?"msal:loginSuccess":"msal:acquireTokenSuccess",k.Popup,s),r.end({success:!0,accessTokenSize:s.accessToken.length,idTokenSize:s.idToken.length,accountType:we(s.account)}),s}).catch(s=>(this.eventHandler.emitEvent(n.length>0?"msal:acquireTokenFailure":"msal:loginFailure",k.Popup,null,s),r.end({success:!1},s),Promise.reject(s)))}trackPageVisibilityWithMeasurement(){var e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&(this.logger.info("Perf: Visibility change detected in ",e.event.name),e.increment({visibilityChangeCount:1}))}ssoSilent(e){var t=this;return(0,p.A)(function*(){var r=t.getRequestCorrelationId(e),n={...e,prompt:e.prompt,correlationId:r};return t.ssoSilentMeasurement=t.performanceClient.startMeasurement(g.SsoSilent,r),t.ssoSilentMeasurement?.add({scenarioId:e.scenarioId,accountType:we(e.account)}),Nn(t.initialized,t.ssoSilentMeasurement),t.ssoSilentMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",t.trackPageVisibilityWithMeasurement),t.logger.verbose("ssoSilent called",r),t.eventHandler.emitEvent("msal:ssoSilentStart",k.Silent,n),(t.canUseNative(n)?t.acquireTokenNative(n,863).catch(s=>{if(s instanceof Se&&vt(s))return t.nativeExtensionProvider=void 0,t.createSilentIframeClient(n.correlationId).acquireToken(n);throw s}):t.createSilentIframeClient(n.correlationId).acquireToken(n)).then(s=>(t.eventHandler.emitEvent("msal:ssoSilentSuccess",k.Silent,s),t.ssoSilentMeasurement?.end({success:!0,isNativeBroker:s.fromNativeBroker,accessTokenSize:s.accessToken.length,idTokenSize:s.idToken.length,accountType:we(s.account)}),s)).catch(s=>{throw t.eventHandler.emitEvent("msal:ssoSilentFailure",k.Silent,null,s),t.ssoSilentMeasurement?.end({success:!1},s),s}).finally(()=>{document.removeEventListener("visibilitychange",t.trackPageVisibilityWithMeasurement)})})()}acquireTokenByCode(e){var t=this;return(0,p.A)(function*(){var r=t.getRequestCorrelationId(e);t.logger.trace("acquireTokenByCode called",r);var n=t.performanceClient.startMeasurement(g.AcquireTokenByCode,r);Nn(t.initialized,n),t.eventHandler.emitEvent("msal:acquireTokenByCodeStart",k.Silent,e),n.add({scenarioId:e.scenarioId});try{if(e.code&&e.nativeAccountId)throw w(on);if(e.code){var o=e.code,a=t.hybridAuthCodeResponses.get(o);return a?(t.logger.verbose("Existing acquireTokenByCode request found",r),n.discard()):(t.logger.verbose("Initiating new acquireTokenByCode request",r),a=t.acquireTokenByCodeAsync({...e,correlationId:r}).then(c=>(t.eventHandler.emitEvent("msal:acquireTokenByCodeSuccess",k.Silent,c),t.hybridAuthCodeResponses.delete(o),n.end({success:!0,isNativeBroker:c.fromNativeBroker,accessTokenSize:c.accessToken.length,idTokenSize:c.idToken.length,accountType:we(c.account)}),c)).catch(c=>{throw t.hybridAuthCodeResponses.delete(o),t.eventHandler.emitEvent("msal:acquireTokenByCodeFailure",k.Silent,null,c),n.end({success:!1},c),c}),t.hybridAuthCodeResponses.set(o,a)),yield a}if(e.nativeAccountId){if(t.canUseNative(e,e.nativeAccountId)){var s=yield t.acquireTokenNative({...e,correlationId:r},866,e.nativeAccountId).catch(c=>{throw c instanceof Se&&vt(c)&&(t.nativeExtensionProvider=void 0),c});return n.end({accountType:we(s.account),success:!0}),s}throw w(an)}throw w(nn)}catch(c){throw t.eventHandler.emitEvent("msal:acquireTokenByCodeFailure",k.Silent,null,c),n.end({success:!1},c),c}})()}acquireTokenByCodeAsync(e){var t=this;return(0,p.A)(function*(){t.logger.trace("acquireTokenByCodeAsync called",e.correlationId),t.acquireTokenByCodeAsyncMeasurement=t.performanceClient.startMeasurement(g.AcquireTokenByCodeAsync,e.correlationId),t.acquireTokenByCodeAsyncMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",t.trackPageVisibilityWithMeasurement);var r=t.createSilentAuthCodeClient(e.correlationId);return yield r.acquireToken(e).then(o=>(t.acquireTokenByCodeAsyncMeasurement?.end({success:!0,fromCache:o.fromCache,isNativeBroker:o.fromNativeBroker}),o)).catch(o=>{throw t.acquireTokenByCodeAsyncMeasurement?.end({success:!1},o),o}).finally(()=>{document.removeEventListener("visibilitychange",t.trackPageVisibilityWithMeasurement)})})()}acquireTokenFromCache(e,t){var r=this;return(0,p.A)(function*(){switch(r.performanceClient.addQueueMeasurement(g.AcquireTokenFromCache,e.correlationId),t){case 0:case 1:case 2:var n=r.createSilentCacheClient(e.correlationId);return E(n.acquireToken.bind(n),g.SilentCacheClientAcquireToken,r.logger,r.performanceClient,e.correlationId)(e);default:throw A(fe)}})()}acquireTokenByRefreshToken(e,t){var r=this;return(0,p.A)(function*(){switch(r.performanceClient.addQueueMeasurement(g.AcquireTokenByRefreshToken,e.correlationId),t){case 0:case 2:case 3:case 4:var n=r.createSilentRefreshClient(e.correlationId);return E(n.acquireToken.bind(n),g.SilentRefreshClientAcquireToken,r.logger,r.performanceClient,e.correlationId)(e);default:throw A(fe)}})()}acquireTokenBySilentIframe(e){var t=this;return(0,p.A)(function*(){t.performanceClient.addQueueMeasurement(g.AcquireTokenBySilentIframe,e.correlationId);var r=t.createSilentIframeClient(e.correlationId);return E(r.acquireToken.bind(r),g.SilentIframeClientAcquireToken,t.logger,t.performanceClient,e.correlationId)(e)})()}logout(e){var t=this;return(0,p.A)(function*(){var r=t.getRequestCorrelationId(e);return t.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",r),t.logoutRedirect({correlationId:r,...e})})()}logoutRedirect(e){var t=this;return(0,p.A)(function*(){var r=t.getRequestCorrelationId(e);return Go(t.initialized,t.config),t.browserStorage.setInteractionInProgress(!0),t.createRedirectClient(r).logout(e)})()}logoutPopup(e){try{var t=this.getRequestCorrelationId(e);return _i(this.initialized),this.browserStorage.setInteractionInProgress(!0),this.createPopupClient(t).logout(e)}catch(n){return Promise.reject(n)}}clearCache(e){var t=this;return(0,p.A)(function*(){if(t.isBrowserEnvironment){var r=t.getRequestCorrelationId(e);return t.createSilentCacheClient(r).logout(e)}t.logger.info("in non-browser environment, returning early.")})()}getAllAccounts(e){return function(i,e,t,r){return i.verbose("getAllAccounts called"),t?e.getAllAccounts(r):[]}(this.logger,this.browserStorage,this.isBrowserEnvironment,e)}getAccount(e){return function(i,e,t){if(e.trace("getAccount called"),0===Object.keys(i).length)return e.warning("getAccount: No accountFilter provided"),null;var r=t.getAccountInfoFilteredBy(i);return r?(e.verbose("getAccount: Account matching provided filter found, returning"),r):(e.verbose("getAccount: No matching account found, returning null"),null)}(e,this.logger,this.browserStorage)}getAccountByUsername(e){return function(i,e,t){if(e.trace("getAccountByUsername called"),!i)return e.warning("getAccountByUsername: No username provided"),null;var r=t.getAccountInfoFilteredBy({username:i});return r?(e.verbose("getAccountByUsername: Account matching username found, returning"),e.verbosePii(`getAccountByUsername: Returning signed-in accounts matching username: ${i}`),r):(e.verbose("getAccountByUsername: No matching account found, returning null"),null)}(e,this.logger,this.browserStorage)}getAccountByHomeId(e){return function(i,e,t){if(e.trace("getAccountByHomeId called"),!i)return e.warning("getAccountByHomeId: No homeAccountId provided"),null;var r=t.getAccountInfoFilteredBy({homeAccountId:i});return r?(e.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),e.verbosePii(`getAccountByHomeId: Returning signed-in accounts matching homeAccountId: ${i}`),r):(e.verbose("getAccountByHomeId: No matching account found, returning null"),null)}(e,this.logger,this.browserStorage)}getAccountByLocalId(e){return function(i,e,t){if(e.trace("getAccountByLocalId called"),!i)return e.warning("getAccountByLocalId: No localAccountId provided"),null;var r=t.getAccountInfoFilteredBy({localAccountId:i});return r?(e.verbose("getAccountByLocalId: Account matching localAccountId found, returning"),e.verbosePii(`getAccountByLocalId: Returning signed-in accounts matching localAccountId: ${i}`),r):(e.verbose("getAccountByLocalId: No matching account found, returning null"),null)}(e,this.logger,this.browserStorage)}setActiveAccount(e){!function(i,e){e.setActiveAccount(i)}(e,this.browserStorage)}getActiveAccount(){return function(i){return i.getActiveAccount()}(this.browserStorage)}hydrateCache(e,t){var r=this;return(0,p.A)(function*(){r.logger.verbose("hydrateCache called");var n=Y.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return r.browserStorage.setAccount(n),e.fromNativeBroker?(r.logger.verbose("Response was from native broker, storing in-memory"),r.nativeInternalStorage.hydrateCache(e,t)):r.browserStorage.hydrateCache(e,t)})()}acquireTokenNative(e,t,r){var n=this;return(0,p.A)(function*(){if(n.logger.trace("acquireTokenNative called"),!n.nativeExtensionProvider)throw w(qe);return new Ct(n.config,n.browserStorage,n.browserCrypto,n.logger,n.eventHandler,n.navigationClient,t,n.performanceClient,n.nativeExtensionProvider,r||n.getNativeAccountId(e),n.nativeInternalStorage,e.correlationId).acquireToken(e)})()}canUseNative(e,t){if(this.logger.trace("canUseNative called"),!_e.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme))return this.logger.trace("canUseNative: isNativeAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case J.NONE:case J.CONSENT:case J.LOGIN:this.logger.trace("canUseNative: prompt is compatible with native flow");break;default:return this.logger.trace(`canUseNative: prompt = ${e.prompt} is not compatible with native flow, returning false`),!1}return!(!t&&!this.getNativeAccountId(e)&&(this.logger.trace("canUseNative: nativeAccountId is not available, returning false"),1))}getNativeAccountId(e){var t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new ad(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createRedirectClient(e){return new cd(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentIframeClient(e){return new fd(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,863,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentCacheClient(e){return new Da(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentRefreshClient(e){return new pd(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentAuthCodeClient(e){return new Cd(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,866,this.performanceClient,this.nativeExtensionProvider,e)}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return Bo(),this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}enableAccountStorageEvents(){typeof window>"u"||(this.listeningToStorageEvents?this.logger.verbose("Account storage listener already registered."):(this.logger.verbose("Adding account storage listener."),this.listeningToStorageEvents=!0,window.addEventListener("storage",this.handleAccountCacheChange)))}disableAccountStorageEvents(){typeof window>"u"||(this.listeningToStorageEvents?(this.logger.verbose("Removing account storage listener."),window.removeEventListener("storage",this.handleAccountCacheChange),this.listeningToStorageEvents=!1):this.logger.verbose("No account storage listener registered."))}handleAccountCacheChange(e){try{e.key?.includes("active-account-filters")&&this.eventHandler.emitEvent("msal:activeAccountChanged");var t=e.newValue||e.oldValue;if(!t)return;var r=JSON.parse(t);if("object"!=typeof r||!Y.isAccountEntity(r))return;var o=dt.toObject(new Y,r).getAccountInfo();!e.oldValue&&e.newValue?(this.logger.info("Account was added to cache in a different window"),this.eventHandler.emitEvent("msal:accountAdded",void 0,o)):!e.newValue&&e.oldValue&&(this.logger.info("Account was removed from cache in a different window"),this.eventHandler.emitEvent("msal:accountRemoved",void 0,o))}catch{return}}getTokenCache(){return this.tokenCache}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getRequestCorrelationId(e){return e?.correlationId?e.correlationId:this.isBrowserEnvironment?ke():C.EMPTY_STRING}loginRedirect(e){var t=this;return(0,p.A)(function*(){var r=t.getRequestCorrelationId(e);return t.logger.verbose("loginRedirect called",r),t.acquireTokenRedirect({correlationId:r,...e||Mo})})()}loginPopup(e){var t=this.getRequestCorrelationId(e);return this.logger.verbose("loginPopup called",t),this.acquireTokenPopup({correlationId:t,...e||Mo})}acquireTokenSilent(e){var t=this;return(0,p.A)(function*(){var r=t.getRequestCorrelationId(e),n=t.performanceClient.startMeasurement(g.AcquireTokenSilent,r);n.add({cacheLookupPolicy:e.cacheLookupPolicy,scenarioId:e.scenarioId}),Nn(t.initialized,n),t.logger.verbose("acquireTokenSilent called",r);var o=e.account||t.getActiveAccount();if(!o)throw w(Jr);n.add({accountType:we(o)});var s=JSON.stringify({clientId:t.config.auth.clientId,authority:e.authority||C.EMPTY_STRING,scopes:e.scopes,homeAccountIdentifier:o.homeAccountId,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid,shrOptions:e.shrOptions}),c=t.activeSilentTokenRequests.get(s);if(typeof c>"u"){t.logger.verbose("acquireTokenSilent called for the first time, storing active request",r);var l=E(t.acquireTokenSilentAsync.bind(t),g.AcquireTokenSilentAsync,t.logger,t.performanceClient,r)({...e,correlationId:r},o).then(d=>(t.activeSilentTokenRequests.delete(s),n.end({success:!0,fromCache:d.fromCache,isNativeBroker:d.fromNativeBroker,cacheLookupPolicy:e.cacheLookupPolicy,accessTokenSize:d.accessToken.length,idTokenSize:d.idToken.length}),d)).catch(d=>{throw t.activeSilentTokenRequests.delete(s),n.end({success:!1},d),d});return t.activeSilentTokenRequests.set(s,l),{...yield l,state:e.state}}return t.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",r),n.discard(),{...yield c,state:e.state}})()}acquireTokenSilentAsync(e,t){var r=this;return(0,p.A)(function*(){var n=()=>r.trackPageVisibility(e.correlationId);r.performanceClient.addQueueMeasurement(g.AcquireTokenSilentAsync,e.correlationId),r.eventHandler.emitEvent("msal:acquireTokenStart",k.Silent,e),e.correlationId&&r.performanceClient.incrementFields({visibilityChangeCount:0},e.correlationId),document.addEventListener("visibilitychange",n);var o=yield E(Wl,g.InitializeSilentRequest,r.logger,r.performanceClient,e.correlationId)(e,t,r.config,r.performanceClient,r.logger),a=e.cacheLookupPolicy||0,s=r.acquireTokenSilentNoIframe(o,a).catch(function(){var c=(0,p.A)(function*(l){var d=function(i,e){var n=!(i instanceof ue&&i.subError!==gt)&&(i.errorCode===se.INVALID_GRANT_ERROR||i.errorCode===fe)||i.errorCode===ht||i.errorCode===zi,o=ss.includes(e);return n&&o}(l,a);if(d){if(r.activeIframeRequest){if(5!==a){var[u,f]=r.activeIframeRequest;r.logger.verbose(`Iframe request is already in progress, awaiting resolution for request with correlationId: ${f}`,o.correlationId);var m=r.performanceClient.startMeasurement(g.AwaitConcurrentIframe,o.correlationId);m.add({awaitIframeCorrelationId:f});var v=yield u;if(m.end({success:v}),v)return r.logger.verbose(`Parallel iframe request with correlationId: ${f} succeeded. Retrying cache and/or RT redemption`,o.correlationId),r.acquireTokenSilentNoIframe(o,a);throw r.logger.info(`Iframe request with correlationId: ${f} failed. Interaction is required.`),l}return r.logger.warning("Another iframe request is currently in progress and CacheLookupPolicy is set to Skip. This may result in degraded performance and/or reliability for both calls. Please consider changing the CacheLookupPolicy to take advantage of request queuing and token cache.",o.correlationId),E(r.acquireTokenBySilentIframe.bind(r),g.AcquireTokenBySilentIframe,r.logger,r.performanceClient,o.correlationId)(o)}var h;return r.activeIframeRequest=[new Promise(S=>{h=S}),o.correlationId],r.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",o.correlationId),E(r.acquireTokenBySilentIframe.bind(r),g.AcquireTokenBySilentIframe,r.logger,r.performanceClient,o.correlationId)(o).then(S=>(h(!0),S)).catch(S=>{throw h(!1),S}).finally(()=>{r.activeIframeRequest=void 0})}throw l});return function(l){return c.apply(this,arguments)}}());return s.then(c=>(r.eventHandler.emitEvent("msal:acquireTokenSuccess",k.Silent,c),e.correlationId&&r.performanceClient.addFields({fromCache:c.fromCache,isNativeBroker:c.fromNativeBroker},e.correlationId),c)).catch(c=>{throw r.eventHandler.emitEvent("msal:acquireTokenFailure",k.Silent,null,c),c}).finally(()=>{document.removeEventListener("visibilitychange",n)})})()}acquireTokenSilentNoIframe(e,t){var r=this;return(0,p.A)(function*(){return _e.isNativeAvailable(r.config,r.logger,r.nativeExtensionProvider,e.authenticationScheme)&&e.account.nativeAccountId?(r.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform"),r.acquireTokenNative(e,61).catch(function(){var n=(0,p.A)(function*(o){throw o instanceof Se&&vt(o)?(r.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),r.nativeExtensionProvider=void 0,A(fe)):o});return function(o){return n.apply(this,arguments)}}())):(r.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow"),E(r.acquireTokenFromCache.bind(r),g.AcquireTokenFromCache,r.logger,r.performanceClient,e.correlationId)(e,t).catch(n=>{if(1===t)throw n;return r.eventHandler.emitEvent("msal:acquireTokenFromNetworkStart",k.Silent,e),E(r.acquireTokenByRefreshToken.bind(r),g.AcquireTokenByRefreshToken,r.logger,r.performanceClient,e.correlationId)(e,t)}))})()}}function uo(){return uo=(0,p.A)(function*(i,e){var t=new We(i);return yield t.initialize(),Mn.createController(t,e)}),uo.apply(this,arguments)}class yt{static createPublicClientApplication(e){return(0,p.A)(function*(){var t=yield function(i,e){return uo.apply(this,arguments)}(e);return new yt(e,t)})()}constructor(e,t){this.controller=t||new Mn(new We(e))}initialize(e){var t=this;return(0,p.A)(function*(){return t.controller.initialize(e)})()}acquireTokenPopup(e){var t=this;return(0,p.A)(function*(){return t.controller.acquireTokenPopup(e)})()}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e,t){return this.controller.addEventCallback(e,t)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}enableAccountStorageEvents(){this.controller.enableAccountStorageEvents()}disableAccountStorageEvents(){this.controller.disableAccountStorageEvents()}getAccount(e){return this.controller.getAccount(e)}getAccountByHomeId(e){return this.controller.getAccountByHomeId(e)}getAccountByLocalId(e){return this.controller.getAccountByLocalId(e)}getAccountByUsername(e){return this.controller.getAccountByUsername(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logout(e){return this.controller.logout(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getTokenCache(){return this.controller.getTokenCache()}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}hydrateCache(e,t){var r=this;return(0,p.A)(function*(){return r.controller.hydrateCache(e,t)})()}clearCache(e){return this.controller.clearCache(e)}}var Id=_(384),oe=function(i){return i.Unexpected="Unexpected",i.ClusterResolutionFailure="ClusterResolutionFailure",i.AcquireTokenFailure="AcquireTokenFailure",i.MissingFixedClusterUriProperty="MissingFixedClusterUriProperty",i.AccessTokenExpiryStringUndefined="AccessTokenExpiryStringUndefined",i.LoginRedirectFailure="LoginRedirectFailure",i.LoginPopupFailure="LoginPopupFailure",i}({}),Un=function(i){return i.Error="Error",i.Info="Info",i.Debug="Debug",i.Warning="Warning",i}({}),Ed=_(976),Sd=_(51),Ka=["AADSTS50081","AADSTS50158","AADSTS53000","AADSTS530003","AADSTS530004","AADSTS53001","AADSTS53002","AADSTS530021","AADSTS53003","AADSTS530032","AADSTS53009","AADSTS700003"],Fa=["AADSTS500341","AADSTS50057","AADSTS50058","AADSTS50173"];function po(i){if(!i)return"System";try{var e=i.errorInfo??i.message;if(e&&([Jt.FallbackToRedirection,Jt.NoNetworkMessage,Jt.UserAccountChanged,Jt.UserInteractionDeclined,ye,zt,Pt,Rt,...Ka,...Ke.clientAuthEnabled?[]:Fa].some(t=>e.includes(t))||function(i){return!(!i?.includes("redirect_in_iframe")||"/thousandeyes"!==window.parent?.location?.pathname)}(e)||function(i){return function(i){return!!i?.includes(Jt.UserNotSignedIn)}(i)&&!!window.signInProviderService?.isSignedOut}(e)||function(i,e){return!Ke.clientAuthEnabled&&Ga(new G(i,e))}(i.code,e)||function(i){return Ke.clientAuthCacheLocation!=ie_MemoryStorage&&!!i?.includes(jt)||!!i?.includes(at)||!!i?.includes("Failed to read the 'sessionStorage' property")}(e))||"ClusterResolutionFailure"===i.errorType&&["0","401"].includes(i.errorCode))return"User"}catch{}return"System"}function Ga(i){var t=["AADSTS50076","AADSTS50078","AADSTS50079","AADSTS50142","AADSTS70044",...Ka];return!!i&&(i instanceof ue||"InteractionRequiredAuthError"===i.name||["AADSTS50089","AADSTS70008","AADSTS700082","AADSTS700084",...Fa,...t].some(r=>i.message.includes(r))||i.errorCode===Gt)}function mo(i){return i().catch(e=>{if(e.message?.includes($t))return window.signInProviderService.isInteractionInProgress$.pipe((0,Ed.p)(t=>!t),(0,Sd.s)(1)).toPromise().then(()=>mo(i));throw e})}function er(i,e){if(e&&e.document&&e.document.cookie){var t=e.document.cookie.split(";");for(var r of t){var n=r.split("=");if(n.length>0&&n[0].trim()===i)return n[1]}}}var I=function(i){return i.AbtLoginHintCacheKey="abtLoginHint",i.ApiActivityIdHeaderKey="X-AS-ActivityID",i.ApiErrorInfoHeaderKey="X-PowerBI-Error-Info",i.ApiPreviousTenantIdHeaderKey="X-PowerBI-User-PreviousTenantId",i.ApiRedirectedFromSignUpHeaderKey="X-PowerBI-RedirectedFromSignup",i.ApiRequestIdHeaderKey="X-AS-RequestID",i.B2bQueryParameterKey="b2b",i.DefaultScopePath="/.default",i.DefaultAuthorityPath="common",i.DefaultSignInQueryParameterKey="defaultSignIn",i.DisableSignInQueryParameterKey="disableSignin",i.DomainHintQueryParameterKey="domain_hint",i.NoSignUpCheckQueryParameterKey="noSignUpCheck",i.OfficeResponseQueryParameterKey="response",i.OfficeResponseDomainNotAllowedValue="DomainNotAllowed",i.OfficeResponseUnsupportedRegionValue="UnsupportedRegion",i.InvitationCodeQueryParameterKey="invitationCode",i.SharingInvitationCodeV2ParameterName="i",i.ReturnUrlQueryParameterKey="ru",i.LiveIdpId="live.com",i.OfficeWaffleTenantIdQueryParameterKey="tenant",i.OfficeWaffleUpnQueryParameterKey="UPN",i.PreviousTenantIdQueryParameterKey="tenantId",i.RedirectedFromSignUpQueryParameterKey="redirectedFromSignup",i.RedirectedWaitSimpleQueryParameterKey="redirectedWaitSimple",i.ClientSideAuthSwitchQueryParameterKey="clientSideAuth",i.FallbackErrorQueryParameterKey="fallbackError",i.SiteId="500453",i.TenantIdQueryParameterKey="ctid",i.LegacyUserSignedUpCookieKey="PowerBIUserSignedUp",i.UserSignedUpCookieKey="PbiUserSignedUp",i.SignedInCookieKey="PowerBISignedInFlag",i.WFESessionIdCookieKey="WFESessionId",i.SingleSignOnRoute="singleSignOn",i.PleaseWaitRoute="PleaseWait",i.ClusterUriCacheKeyPrefix="clusterUri",i.PrivateLinkFixedClusterUriCacheKeyPrefix="PLclusterUri",i.ClusterUriExpiryCacheKeyPrefix="clusterUriExpiry",i.DefaultClusterUri="https://biazure-int-edog-redirect.analysis-df.windows.net/",i.AuthDCParam="authDCParam",i.AppInsightsConnectionString="appInsightsConnectionString",i.AppInsightsConnectionStringExpiryCacheKeyPrefix="appInsightsConnectionStringExpiry",i.AppInsightsV2InstrKey="appInsightsV2InstrKey",i.appInsightsV2EndpointUrlKey="appInsightsV2EndpointUrlKey",i.AppInsightsV2StringExpiryCacheKeyPrefix="appInsightsV2StringExpiry",i.AzureMapsEndpointKey="azureMapsEndpoint",i}({}),Dn=function(i){return i.Cache="Cache",i.GlobalService="GlobalService",i}({}),qa=function(i){return i.OfficeWaffle="OfficeWaffle",i.B2b="B2B",i}({}),za=function(i){return i.DashboardInvitation="DashboardInvitation",i.OfficeWaffle="OfficeWaffle",i}({}),Qa=function(i){return i.Error="insufficient_claims",i}({}),kd=function(i){return i.CAEClaimRealm="realm",i.CAEClaimAuthorizationUri="authorization_uri",i.CAEClaimChallengeError="error",i.CAEClaim="claims",i}({}),Oe=i=>{try{window.logEvent?.(i)}catch{}},bd=window;function Wa(i){if(i&&i.startsWith("Bearer")){for(var r,e={},t=/(\w*?)="(.*?)"/g;null!==(r=t.exec(i));){r.index===t.lastIndex&&t.lastIndex++;var n=r[1];n&&(e[n]=r[2])}return e}}function tr(i,e,t){return i?.searchParams?.append(e,t),i}function de(){return typeof window.performance<"u"&&window.performance.now&&window.performance.timeOrigin?window.performance.now()+window.performance.timeOrigin:(new Date).getTime()}function Va(){return window?.performance?.timeOrigin||bd.initializeContainerStartTime?.getTime()}function z(i,e){for(var t=(e=e||window.location.search).substring(1).split("&"),r=0,n=t.length;r<n;++r){var o=t[r].split("=");if(o[0]?.toLowerCase()===i.toLowerCase())return decodeURIComponent(o[1])}}function Ya(i){return i.endsWith("/")?i:i+"/"}function vo(){var i="",e=0;for(e=0;e<32;e+=1){var t=16*Math.random()|0;switch(e){case 8:case 12:case 16:case 20:i+="-"}i+=t.toString(16)}return i}function D(i){return!i||""===i.trim()}function Co(i){var e=function(i){if(i){var e=i.replace(/-/g,"+").replace(/_/g,"/");return decodeURIComponent(atob(e).split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join(""))}}(i);return e?JSON.parse(e):void 0}function rr(i,e){if(Number.isFinite(i)&&Number.isFinite(e))return i-e}function ve(i,e){return new Promise(t=>{e?window.location.replace(i):window.location.href=i})}function X(i,e,t,r){try{return"setItem"===e?window[i].setItem(t,r??""):window[i].getItem(t)}catch(n){Oe({name:"StorageOperationFailed",properties:{storageType:i,method:e,key:t,message:n.message}})}}var Ln="realmId",nr=window;function ir(){return!!nr.realmInFabricShellEnabled}var Hd=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function ja(i){return Hd.test(i)}function yo(i,e,t){return[I.ClusterUriCacheKeyPrefix,i,ir()&&t,e].filter(r=>!!r).join(".")}function Ja(i,e){ir()&&(function(i){nr.realmId=i}(i),function(i,e){var t=new URL(location.href),r=z(Ln,t.search);r!==i&&(r||i)&&(i?t.searchParams.set(Ln,i):t.searchParams.delete(Ln),history.replaceState(null,"",t.toString()),Oe({name:"updateRealmIdInUrl",properties:{originalRealmId:r,resolvedRealmId:i,resolutionSource:e}}))}(i,e),i&&Oe({name:"setGlobalRealmId",properties:{resolvedRealmId:i,resolutionSource:e}}))}var $e,L=window,b=window,y=window.signInInfo={},Ne=window.signInErrorInfo=[],Hn=window.msalLogInfo=[],Me=(i,e)=>{var t={errorSource:po(i),attemptNumber:$e,appName:b.clientAuthAppName,...i};if(Ne.push(t),!e)throw t;e(t)};class Xa{get isSignedOut(){return this._isSignedOut}constructor(){this.defaultRedirectUri=window.location.origin+"/signin",this.errorPropNotFoundTemplate="Cannot initialize MSAL application, missing global property:",this.signOutEventListeners=[],this._isSignedOut=!1,this._isInteractionInProgress$=new Id.t(this.isInteractionInProgress()),this.defaultScopes=[b.clientAuthResourceUrl+I.DefaultScopePath],this.isInteractionInProgress$=this._isInteractionInProgress$.asObservable(),y.appName=b.clientAuthAppName,y.pageLoadStartTimestamp=Va(),this._initializePromise=this.initializeClientApp()}ensureClientApplicationInitialized(){return this._initializePromise}registerSignOutEventListener(e){this.signOutEventListeners.push(e)}checkForOfficeResponseRedirect(){return(0,p.A)(function*(){if(window.location.search&&window.location.search.length>0){var e=z(I.OfficeResponseQueryParameterKey);if(!D(e)){var t=null;switch(e){case I.OfficeResponseDomainNotAllowedValue:t=b.clientAuthOfficeResponseRedirectUrl_DomainNotAllowed;break;case I.OfficeResponseUnsupportedRegionValue:t=b.clientAuthOfficeResponseRedirectUrl_UnsupportedRegion}t&&(yield ve(t))}}})()}checkForSignUpRedirect(){var e=this;return(0,p.A)(function*(){var t=!1;if(window.location.search&&window.location.search.length>0&&(t=!D(z(I.DefaultSignInQueryParameterKey))),(t||b.clientAuthRequireUserSignUpCheck&&!D(b.clientAuthSignUpRedirectUrl))&&e.shouldRedirectToSignUp())if(b.clientAuthDefaultSignInCheck&&(b.clientAuthCheckOfficeDefaultSignIn||t)){var r=new URL(window.location.href),n=new URL(window.location.href);r=tr(r,I.NoSignUpCheckQueryParameterKey,"1"),(n=tr(n,I.ReturnUrlQueryParameterKey,r.toString())).pathname=I.SingleSignOnRoute,yield ve(n.toString())}else{var o=new URL(window.location.href),a=new URL(b.clientAuthSignUpRedirectUrl);o=tr(o,I.NoSignUpCheckQueryParameterKey,"1"),a=tr(a,I.ReturnUrlQueryParameterKey,o.toString()),yield ve(a.toString())}else if(window.location.search&&window.location.search.length>0&&!D(z(I.RedirectedFromSignUpQueryParameterKey))&&D(z(I.RedirectedWaitSimpleQueryParameterKey))&&D(er(I.UserSignedUpCookieKey,window))&&D(er(I.LegacyUserSignedUpCookieKey,window))&&b.clientAuthPleaseWaitDelayInSeconds&&parseInt(b.clientAuthPleaseWaitDelayInSeconds,10)>0){var s=new URL(window.location.href);(s=tr(s,I.RedirectedWaitSimpleQueryParameterKey,"1")).pathname=I.PleaseWaitRoute,yield ve(s.toString())}})()}clearTransientSignInConfigParamsBeforeRedirect(e){try{var t=new URL(window.location.href);return t.searchParams.delete(I.NoSignUpCheckQueryParameterKey),t.searchParams.delete(I.NoSignUpCheckQueryParameterKey.toLowerCase()),t.searchParams.delete(I.OfficeWaffleUpnQueryParameterKey),t.searchParams.delete(I.OfficeWaffleUpnQueryParameterKey.toLowerCase()),e.redirectStartPage=t.toString(),e}catch(r){return e}}constructRequestQueryParameters(){var e={site_id:I.SiteId,nux:"1"};if(window.location.search&&window.location.search.length>0){var t=z(I.DomainHintQueryParameterKey);D(t)||(e.domain_hint=t);var r=z(I.InvitationCodeQueryParameterKey);if(D(r)){var o=z(I.OfficeWaffleUpnQueryParameterKey);D(o)||(y.loginInHintSource=za.OfficeWaffle,e.login_hint=o)}else{var n=decodeURIComponent(r).split("|");n.length>2&&(y.loginInHintSource=za.DashboardInvitation,e.login_hint=n[2])}var a=z(I.TenantIdQueryParameterKey),s=z(I.B2bQueryParameterKey);(D(a)&&(D(r)||D(s))||!b.clientAuthAllowConsumerDomains)&&(e.msafed="0")}return e}getTokenQueryParameters(){var e=z(I.AuthDCParam);if(window.CAEAuth&&!D(e))return{dc:e}}getClusterForPublishedTenant(e){var t=vo(),r=de();return Oe({name:"GetClusterForPublishedTenant_Start",properties:{tenantId:e,requestId:t}}),new Promise((n,o)=>{try{var c=`${Ya(b.clientAuthApimUrl)}public/routing/cluster/${e}`,l=new XMLHttpRequest;l.open("GET",c,!0),l.setRequestHeader("Accept","application/json"),l.setRequestHeader(I.ApiActivityIdHeaderKey,b.clientAuthWfeSessionId),l.setRequestHeader(I.ApiRequestIdHeaderKey,t),l.onreadystatechange=(0,p.A)(function*(){var h;try{if(l.readyState===XMLHttpRequest.DONE)if(y.clusterResolutionEndTime=de(),200===(h=l.status)){var u=JSON.parse(l.responseText);if(D(u.FixedClusterUri)){var f={errorType:oe.MissingFixedClusterUriProperty,errorInfo:`Response is missing fixedClusterUri property and error header is: ${l.getResponseHeader(I.ApiErrorInfoHeaderKey)}`,errorCode:h.toString(),requestId:t};Me(f,o)}else n(u)}else{var m={errorType:oe.ClusterResolutionFailure,errorInfo:`Response code is not 200. Error header is: ${l.getResponseHeader(I.ApiErrorInfoHeaderKey)}`,errorCode:h.toString(),requestId:t};Me(m,o)}}catch(S){var v={errorType:oe.ClusterResolutionFailure,errorInfo:`Cluster resolution failed. ${S.message}`,errorCode:h.toString(),requestId:t};Me(v,o)}}),y.clusterResolutionStartTime=de(),l.send()}catch(h){var d={errorType:oe.ClusterResolutionFailure,errorInfo:h.toString(),errorCode:h.status?.toString(),requestId:t};Me(d,o)}}).then(n=>(Oe({name:"GetClusterForPublishedTenant",properties:{tenantId:e,requestId:t,operationStartTime:r,operationEndTime:de(),clusterUri:n.FixedClusterUri}}),n))}getOrInsertClusterForTenant(e,t,r,n,o){var a=vo();return new Promise((s,c)=>{try{var l=function(i,e){return`${Ya(i)}spglobalservice/GetOrInsertClusterUrisByTenantLocation?${encodeURIComponent(e)}`}(b.clientAuthApiUrl,b.clientAuthClusterUrl),d=new XMLHttpRequest;d.open("PUT",l,!0),d.setRequestHeader("Accept","application/json"),d.setRequestHeader("Authorization",`Bearer ${e}`),d.setRequestHeader(I.ApiActivityIdHeaderKey,b.clientAuthWfeSessionId),d.setRequestHeader(I.ApiRequestIdHeaderKey,a),function(i,e){if(e&&ir()){if(!ja(e))return void Oe({name:"setRealmResolutionHeader_invalidRealmId",properties:{realmId:e}});i.setRequestHeader("x-ms-fabric-realm-id",e)}}(d,o),D(n)||d.setRequestHeader(I.ApiPreviousTenantIdHeaderKey,n),r&&d.setRequestHeader(I.ApiRedirectedFromSignUpHeaderKey,"true"),d.onreadystatechange=(0,p.A)(function*(){var u;try{if(d.readyState===XMLHttpRequest.DONE)if(y.clusterResolutionEndTime=de(),200===(u=d.status)){var f=JSON.parse(d.responseText);if(f.FixedClusterUri&&""!==f.FixedClusterUri.trim())s(f);else{var m={errorType:oe.MissingFixedClusterUriProperty,errorInfo:`Response is missing fixedClusterUri property and error header is: ${d.getResponseHeader(I.ApiErrorInfoHeaderKey)}`,errorCode:u.toString(),attemptNumber:$e,requestId:a,realmId:o,appName:b.clientAuthAppName};Ne.push(m),c(m)}}else{var v={errorType:oe.ClusterResolutionFailure,errorInfo:`Response code is not 200. Error header is: ${d.getResponseHeader(I.ApiErrorInfoHeaderKey)}`,errorCode:u.toString(),attemptNumber:$e,requestId:a,realmId:o,appName:b.clientAuthAppName};Ne.push(v),c(v)}}catch(T){var S={errorType:oe.Unexpected,errorInfo:`Cluster resolution failed. ${T.message}`,errorCode:u.toString(),attemptNumber:$e,requestId:a,realmId:o,appName:b.clientAuthAppName};Ne.push(S),c(S)}}),y.clusterResolutionStartTime=de(),d.send()}catch(u){var h={errorType:oe.Unexpected,errorInfo:`Cluster resolution failed. ${u.message}`,errorCode:u.status?.toString(),attemptNumber:$e,requestId:a,realmId:o,appName:b.clientAuthAppName};Ne.push(h),c(h)}})}initializeClientApp(){y.wFESessionId=b.clientAuthWfeSessionId,y.CAEAuth=window.CAEAuth,b.clientAuthClientId||Me({errorType:oe.Unexpected,errorInfo:`${this.errorPropNotFoundTemplate} 'clientAuthClientId'`});var t=L.msalConfigRedirectUrlOverride??this.defaultRedirectUri,r={auth:{clientId:b.clientAuthClientId,authority:this.resolveAuthority(),redirectUri:t},cache:{cacheLocation:window.clientAuthCacheLocation??"sessionStorage",storeAuthStateInCookie:!1},system:{loggerOptions:{loggerCallback:(n,o,a)=>{if(!a)switch(n){case B.Error:return void Hn.push({logType:Un.Error,logMessage:o});case B.Info:return void Hn.push({logType:Un.Info,logMessage:o});case B.Verbose:return void Hn.push({logType:Un.Debug,logMessage:o});case B.Warning:return void Hn.push({logType:Un.Warning,logMessage:o})}}}}};return window.CAEAuth&&(r.auth.clientCapabilities=["CP1"]),b.clientAuthTimeoutIncrease&&(r.system.iframeHashTimeout=12e3),this.msalClientApplication=new yt(r),this.msalClientApplication.initialize().then(()=>{this.msalClientApplication.addEventCallback(()=>{this._isInteractionInProgress$.next(this.isInteractionInProgress())}),this.msalClientApplication.addPerformanceCallback(n=>{try{n.forEach(o=>{var a={name:"msal.perf",properties:{...o}};Oe(a)})}catch{}})})}parseAuthResult(e){var t=e?.account?.idTokenClaims?e.account.idTokenClaims:{},r=e?.accessToken?function(i){return Co(i.split(".")[1])}(e.accessToken):{},n=t.puid;n||t.idp===I.LiveIdpId&&(n=t.altsecid)||(n=r.puid);var a=r.upn;return a||(a=r.unique_name),{accessToken:e.accessToken,accessTokenExpiry:e.expiresOn,accessTokenExpiryString:e?.expiresOn?.toISOString(),clusterUri:"",givenName:r.given_name?r.given_name:"",objectId:r.oid?r.oid:"",puid:n||"",surname:r.family_name?r.family_name:"",tenantId:e.tenantId,userName:a||"",idp:t.idp?t.idp:"",iss:t.iss?t.iss:"",acct:r.acct,signInState:t.signin_state,wsit:t.xms_wsit}}resolveAuthority(){if(b.clientAuthAadInstance||Me({errorType:oe.Unexpected,errorInfo:`${this.errorPropNotFoundTemplate} 'clientAuthAadInstance'`}),!D(z(I.OfficeWaffleUpnQueryParameterKey))){var r=z(I.OfficeWaffleTenantIdQueryParameterKey);if(!D(r))return y.authorityScope=r,y.authorityOverrideSource=qa.OfficeWaffle,b.clientAuthAadInstance.replace("{0}",r)}var n=z(I.TenantIdQueryParameterKey);return D(n)?(y.authorityScope=I.DefaultAuthorityPath,b.clientAuthAadInstance.replace("{0}",I.DefaultAuthorityPath)):(y.authorityScope=n,y.authorityOverrideSource=qa.B2b,b.clientAuthAadInstance.replace("{0}",n))}resolveClusterUri(e,t){var r=this;return(0,p.A)(function*(){var n,o=z(I.PreviousTenantIdQueryParameterKey);if(D(t))return D(o)?(y.noTenantSpecified=!0,b.clientAuthApiUrl):"";var a=null,s=function(i){if(!ir())return"";var e=z(Ln,i);return ja(e)?e:(Oe({name:"extractRealmIdFromLocationSearch_invalidRealmId",properties:{realmId:e}}),"")}(window.location.search),c=r.retrieveClusterUriFromCache(t,s);if(c)return y.clusterUriResolutionSource=Dn.Cache,c;var l=null,d=null,h=null;if(D(e))n=yield r.getClusterForPublishedTenant(t);else{n=yield r.getOrInsertClusterForTenant(e,t,!D(z(I.RedirectedFromSignUpQueryParameterKey)),o,s);var u=n.Clients?.find(S=>"trident-web"===S.Name);if(u&&u.AppInsightsConnectionString){L.connectionString=l=u.AppInsightsConnectionString;var f=r.parseConnectionString(l);y.appInsightsInstrumentationKey=f.InstrumentationKey?f.InstrumentationKey:null,f.InstrumentationKey&&f.IngestionEndpoint&&(window.appInsightsV2InstrKey=f.InstrumentationKey,window.appInsightsV2EndpointUrl=f.IngestionEndpoint+"v2/track",d=window.appInsightsV2InstrKey,h=window.appInsightsV2EndpointUrl,a={connectionString:l,tenantId:t,timestamp:de()},window.sessionStorage.setItem("appInsightsConnectionStringInfo",JSON.stringify(a)))}}var m=L.azureMapsEndpoint=n.ClientServicesMetadata?.AzureMapsDomain,v=function(i){var e=i.PrivateLinkFixedClusterUri,t=i.RealmClusterAssignmentRecord,r=i.FixedClusterUri,n=void 0;return ir()&&t?.Cluster&&t?.RealmId&&(n=t.RealmId,e||(r=t.Cluster)),{clusterUri:r,privateLinkFixedClusterUri:e,realmId:n}}(n);return r.setClusterUriCacheEntry(t,v.clusterUri,v.privateLinkFixedClusterUri,l,d,h,m,v.realmId),L.privateLinkFixedClusterUri=v.privateLinkFixedClusterUri,Ja(v.realmId,Dn.GlobalService),y.clusterUriResolutionSource=Dn.GlobalService,v.clusterUri})()}parseConnectionString(e){return e.split(";").reduce((n,o)=>{var[a,s]=o.split("=");return n[a.trim()]=s.trim(),n},{})}retrieveSignedInAccount(){var e=this;return(0,p.A)(function*(){yield e.ensureClientApplicationInitialized();var t=e.msalClientApplication.getActiveAccount();if(!t){var r=e.msalClientApplication.getAllAccounts();if(r&&r.length>0)return e.msalClientApplication.setActiveAccount(r[0]),r[0]}return t??void 0})()}setCookie(e,t,r="/",n="none",o){o||(o=new Date).setFullYear(o.getFullYear()+1),window&&window.document&&(window.document.cookie=e+" = "+t+";secure;partitioned;path="+r+";expires="+o.toUTCString()+";samesite="+n,D(er(e,window))&&(window.document.cookie=e+" = "+t+";secure;path="+r+";expires="+o.toUTCString()+";samesite="+n))}shouldRedirectToSignUp(){if(!b.clientAuthPrivateLinkHeaderPresent&&!b.clientAuthAccessTokenPresentInRequestBody&&D(er(I.UserSignedUpCookieKey,window))&&D(er(I.LegacyUserSignedUpCookieKey,window))){if(!(window.location.search&&window.location.search.length>0))return!0;if(D(z(I.NoSignUpCheckQueryParameterKey))&&D(z(I.RedirectedFromSignUpQueryParameterKey))&&D(z(I.OfficeWaffleTenantIdQueryParameterKey))&&D(z(I.OfficeWaffleUpnQueryParameterKey))&&D(z(I.SharingInvitationCodeV2ParameterName)))return!0}return!1}removeCookie(e,t="/",r="none"){var n=new Date("1970-01-01Z00:00:00:000");window&&window.document&&(window.document.cookie=e+" = ;secure;partitioned;path="+t+";expires="+n.toUTCString()+";samesite="+r,window.document.cookie=e+" = ;secure;path="+t+";expires="+n.toUTCString()+";samesite="+r)}retrieveClusterUriFromCache(e,t){if(!e)return null;var n=X("localStorage","getItem",yo(e,L.environmentName,t)),a=X("localStorage","getItem",`${I.AppInsightsConnectionString}.${e}.${L.environmentName}`);a&&(L.connectionString=a);var c=X("localStorage","getItem",`${I.AppInsightsV2InstrKey}.${e}.${L.environmentName}`);c&&(window.appInsightsV2InstrKey=c);var d=X("localStorage","getItem",`${I.appInsightsV2EndpointUrlKey}.${e}.${L.environmentName}`);d&&(window.appInsightsV2EndpointUrl=d);var u=X("localStorage","getItem",`${I.AzureMapsEndpointKey}.${e}.${L.environmentName}`);if(u&&(L.azureMapsEndpoint=u),n&&a&&c&&d){var m=X("localStorage","getItem",`${I.ClusterUriExpiryCacheKeyPrefix}.${e}.${L.environmentName}`);if(!m||m<=Date.now().toString())return function(i,e){try{Object.keys(localStorage).forEach(t=>{t.startsWith(`${I.ClusterUriCacheKeyPrefix}.${i}`)&&t.endsWith(e)&&t!==yo(i,e)&&localStorage.removeItem(t)})}catch(t){Oe({name:"cleanRealmCache_error",properties:{tenantId:i,message:t?.message}})}}(e,L.environmentName),null;var S=X("localStorage","getItem",`${I.PrivateLinkFixedClusterUriCacheKeyPrefix}.${e}.${L.environmentName}`);return S&&(L.privateLinkFixedClusterUri=S),y.clusterUriCacheExpiry=m,Ja(t,Dn.Cache),n}return null}setClusterUriCacheEntry(e,t,r,n,o,a,s,c){if(e&&t){var l=Date.now()+36e5,d=yo(e,L.environmentName,c),h=`${I.ClusterUriExpiryCacheKeyPrefix}.${e}.${L.environmentName}`;if(X("localStorage","setItem",d,t),X("localStorage","setItem",h,l.toString()),r&&X("localStorage","setItem",`${I.PrivateLinkFixedClusterUriCacheKeyPrefix}.${e}.${L.environmentName}`,r),n){var m=`${I.AppInsightsConnectionStringExpiryCacheKeyPrefix}.${e}.${L.environmentName}`;X("localStorage","setItem",`${I.AppInsightsConnectionString}.${e}.${L.environmentName}`,n),X("localStorage","setItem",m,l.toString())}if(o){var S=`${I.AppInsightsV2StringExpiryCacheKeyPrefix}.${e}.${L.environmentName}`;X("localStorage","setItem",`${I.AppInsightsV2InstrKey}.${e}.${L.environmentName}`,o),X("localStorage","setItem",S,l.toString())}if(a){var R=`${I.AppInsightsV2StringExpiryCacheKeyPrefix}.${e}.${L.environmentName}`;X("localStorage","setItem",`${I.appInsightsV2EndpointUrlKey}.${e}.${L.environmentName}`,a),X("localStorage","setItem",R,l.toString())}s&&X("localStorage","setItem",`${I.AzureMapsEndpointKey}.${e}.${L.environmentName}`,s)}}setGlobalVariablesFromAuthResult({accessToken:e,accessTokenExpiryString:t,tenantId:r,clusterUri:n,userName:o,givenName:a,surname:s,puid:c,objectId:l,idp:d,iss:h,acct:u}){if(!t){var f={errorType:oe.AccessTokenExpiryStringUndefined,errorInfo:"accessTokenExpiryString has to be defined",attemptNumber:$e,appName:b.clientAuthAppName};throw Ne.push(f),f}L.powerBIAccessToken=e,L.powerBIAccessTokenExpiry=t,L.tenantId=r,L.clusterUri=n;var m=function(){window.powerbi||(window.powerbi={});var i=window.powerbi;return i.session||(i.session={}),i.session.userInfo||(i.session.userInfo={}),i.session.userInfo}();return m.name=o,m.givenName=a,m.surname=s,m.puid=c,m.uoid=l,m.idp=d,m.iss=h,m.acct=u,m}setAuthFlags(){this.setCookie(I.UserSignedUpCookieKey,"1"),this.setCookie(I.LegacyUserSignedUpCookieKey,"1"),this.setCookie(I.SignedInCookieKey,"1"),window.sessionStorage.setItem(Ri,"1"),y.signInSucceeded=!0}signInInternal(e){var t=this;return(0,p.A)(function*(){var r,n=t.isInteractionInProgress()&&!e?.isTokenRefresh?yield t.msalClientApplication.handleRedirectPromise():null;if(null!==n){t.msalClientApplication.setActiveAccount(n.account),y.signInUserInteractionEndTime=Va(),y.postRedirectSignInStartTimestamp=de();var o,a,s,c=n.state?.split(";");c&&(o=c[0],a=c[1],s=c[2]),y.signInStartTime=Number(o||0),y.signInUserInteractionStartTime=Number(a||0),y.pageLoadStartTimestamp=Number(s||0),y.signInMethod=n.fromCache?"Cache":"Redirect",(!(r=t.parseAuthResult(n)).accessTokenExpiry||r.accessTokenExpiry&&r.accessTokenExpiry.getTime()<=Date.now())&&(y.tokenExpiredAfterRedirect=!0,r=yield t.acquireToken(e)),window.CAEAuth&&e?.claimChallenge&&(y.claimChallengeAfterRedirect=!0,r=yield t.acquireToken(e))}else r=yield t.acquireToken(e);if(r){if(!(y.tenantId=r.tenantId,y.userObjectId=r.objectId,y.userPuid=r.puid,e?.isTokenRefresh||(yield t.validateTenantAndRedirectIfNeeded(r.tenantId,r.idp,e))))return yield t.signInInternal({forceRefresh:!0,promptedByTenantMismatch:!0});y.resolveClusterUri=e?.resolveClusterUri,r.clusterUri=!1!==e?.resolveClusterUri?y.clusterUri=yield t.resolveClusterUri(r.accessToken,r.tenantId):L.clusterUri,t.setGlobalVariablesFromAuthResult(r),t.setAuthFlags()}return r})()}acquireToken(e){var t=this;return(0,p.A)(function*(){y.claimChallengeAuth=!!e?.claimChallenge,y.dialogPopup=e?.dialogPopup?.enabled;var r,n=yield t.retrieveSignedInAccount();if(n)try{var o=e?.claimChallenge?Wa(e?.claimChallenge):void 0,a=o?.error===Qa.Error?Co(o?.claims):void 0,s=JSON.stringify(window.CAEAuth?{access_token:{xms_cc:{values:["CP1"]},...a?.access_token},...e?.claims}:e?.claims),c=yield t.msalClientApplication.acquireTokenSilent({scopes:t.defaultScopes,extraQueryParameters:t.constructRequestQueryParameters(),tokenQueryParameters:t.getTokenQueryParameters(),account:n,forceRefresh:e?.forceRefresh??!1,claims:s});t.msalClientApplication.setActiveAccount(c.account),r=t.parseAuthResult(c),y.signInMethod="Silent"}catch(T){if(Ga(T))try{y.signInUserInteractionStartTime||t.markUserInteractionStartTime();var l=y?.signInStartTime+";"+y?.signInUserInteractionStartTime+";"+y?.pageLoadStartTimestamp;null!=L.msalConfigRedirectUrlOverride&&(l=y?.signInStartTime+";"+y?.signInUserInteractionStartTime+";"+y?.pageLoadStartTimestamp+";cst="+window.location.host.split(".")[0]);var d={scopes:t.defaultScopes,extraQueryParameters:t.constructRequestQueryParameters(),tokenQueryParameters:t.getTokenQueryParameters(),state:l};return yield mo((0,p.A)(function*(){if(e?.interactionHandler&&(yield e.interactionHandler()),e?.dialogPopup?.enabled){var R=yield t.msalClientApplication.acquireTokenPopup(d);t.msalClientApplication.setActiveAccount(R.account),y.signInUserInteractionEndTime=de(),y.signInMethod="Popup",r=t.parseAuthResult(R)}else yield t.msalClientApplication.acquireTokenRedirect(d)})),r}catch(R){var h={errorType:oe.AcquireTokenFailure,errorInfo:R.toString(),errorCode:R.errorCode??R.status?.toString()};Me(h)}var u={errorType:oe.AcquireTokenFailure,errorInfo:T.toString(),errorCode:T.errorCode??T.status?.toString()};Me(u)}else{b.clientAuthRedirectChecks&&!e?.isTokenRefresh&&(yield t.checkForSignUpRedirect());try{y.signInUserInteractionStartTime||t.markUserInteractionStartTime();var f=y?.signInStartTime+";"+y?.signInUserInteractionStartTime+";"+y?.pageLoadStartTimestamp;null!=L.msalConfigRedirectUrlOverride&&(f=y?.signInStartTime+";"+y?.signInUserInteractionStartTime+";"+y?.pageLoadStartTimestamp+";cst="+window.location.host.split(".")[0]);var m={scopes:t.defaultScopes,extraQueryParameters:t.constructRequestQueryParameters(),tokenQueryParameters:t.getTokenQueryParameters(),state:f};b.clientAuthRedirectChecks&&!e?.isTokenRefresh&&(m=t.clearTransientSignInConfigParamsBeforeRedirect(m));try{var v=window.sessionStorage.getItem(I.AbtLoginHintCacheKey);v&&(window.sessionStorage.removeItem(I.AbtLoginHintCacheKey),m.loginHint=v)}catch{}return yield mo((0,p.A)(function*(){if(e?.interactionHandler&&(yield e.interactionHandler()),e?.dialogPopup?.enabled){y.signInMethod="Popup";var T=yield t.msalClientApplication.loginPopup(m);t.msalClientApplication.setActiveAccount(T.account),y.signInUserInteractionEndTime=de(),r=t.parseAuthResult(T)}else yield t.msalClientApplication.loginRedirect(m)})),r}catch(T){var S={errorType:oe.LoginRedirectFailure,errorInfo:T.toString(),errorCode:T.errorCode??T.status?.toString()};Me(S)}}return r})()}validateTenantAndRedirectIfNeeded(e,t,r){var n=this;return(0,p.A)(function*(){if(null===e&&(yield ve("/SignupRedirect")),b.clientAuthRedirectChecks){var o,a=z(I.OfficeWaffleTenantIdQueryParameterKey),s=z(I.TenantIdQueryParameterKey);if(D(a))if(D(s)){if(t)try{var l=new URL(t).pathname;l.startsWith("/")&&(l=l.substring(1)),l.endsWith("/")&&(l=l.substring(0,l.length-1)),o=l}catch(m){}}else o=s;else o=a;if(o&&o.toLowerCase()!==e.toLowerCase()){if(yield n.checkForSignUpRedirect(),D(a)&&D(s)){var d=new URL(window.location.href);d.searchParams.set(I.TenantIdQueryParameterKey,e),yield ve(d.toString())}if(!r?.promptedByTenantMismatch)return!1}}if(!b.clientAuthAllowedTenantIdsFilterEnabled||b.clientAuthAllowedTenantIds.includes(e.toLowerCase())||(window.location.pathname+window.location.search).startsWith("/invite?")||(window.location.pathname+window.location.search).startsWith("/invite.cshtml?")){if(b.clientAuthTenantEnvironmentRedirect&&b.clientAuthTenantEnvironmentRedirectMapping?.includes(e)&&!(window.location.pathname+window.location.search).startsWith("/invite?")&&!(window.location.pathname+window.location.search).startsWith("/invite.cshtml?")){var u=function(i,e){var t=i.split(new RegExp("[,;]")),r=t.indexOf(e);return r>-1?t[r+1]:null}(b.clientAuthTenantEnvironmentRedirectMapping,e);if(u&&!window.location.href.includes(u)){var f=n.createQueryParams(u);yield ve(`${u}${window.location.pathname}${f}`)}}}else{var h=new URL(b.clientAuthUnallowedTenantRedirect);h.searchParams.set(I.TenantIdQueryParameterKey,e),yield ve(h.toString())}return!0})()}isInteractionInProgress(){return!!X("sessionStorage","getItem","msal.interaction.status")}handleRedirect(){this.isInteractionInProgress()&&this.ensureClientApplicationInitialized().then(()=>{this.msalClientApplication.handleRedirectPromise()}).then(()=>{}).catch(()=>{})}signIn(e){var t=this;return(0,p.A)(function*(){if(yield t.ensureClientApplicationInitialized(),$e=1,Ne.length=0,D(z(I.DisableSignInQueryParameterKey))){b.clientAuthRedirectChecks&&!e?.isTokenRefresh&&(yield t.checkForOfficeResponseRedirect());for(var o=0;o<3;o++)try{y.signInStartTime=de();var a=yield t.signInInternal(e);return y.signInCompletionTime=de(),t.calculateSignInDuration(),a}catch(u){if(2!==o){$e++;continue}var s=(u?.errorInfo??u?.message??"").substring(0,1024);if(L.clientAuthFallbackToServerOnError){var c={flow:e?.isTokenRefresh?"TokenRefresh":b.clientAuthAppName,type:u?.errorType,source:u?.errorSource??po(u),info:s,code:u?.errorCode,raid:u?.requestId,tenant:y?.tenantId,uoid:y?.userObjectId,puid:y?.userPuid},l=new URL(window.location.href);l.searchParams.set(I.ClientSideAuthSwitchQueryParameterKey,"0"),l.searchParams.set(I.FallbackErrorQueryParameterKey,JSON.stringify(c)),yield ve(l.toString(),!0)}else{var d=Ne?.map(f=>({...f,errorInfo:f.errorInfo?.substring(0,1024/Ne.length)})),h=d?JSON.stringify(d):null;u?yield ve(`/ErrorPage?telemetryType=${e?.isTokenRefresh?"TokenRefresh":"SignIn"}&errorType=${encodeURIComponent(u.errorType)}&errorInfo=${encodeURIComponent(s)}&code=${encodeURIComponent(u.errorCode)}&raid=${encodeURIComponent(u.requestId)}&appName=${encodeURIComponent(b.clientAuthAppName)}&source=${encodeURIComponent(u.errorSource??po(u))}${y.tenantId?`&tenantId=${encodeURIComponent(y.tenantId)}`:""}${y.userObjectId?`&userObjectId=${encodeURIComponent(y.userObjectId)}`:""}${y.userPuid?`&userPuid=${encodeURIComponent(y.userPuid)}`:""}${h?`&errorArray=${encodeURIComponent(h)}`:""}`):yield ve(`/ErrorPage?telemetryType=${e?.isTokenRefresh?"TokenRefresh":"SignIn"}&errorType=${encodeURIComponent(oe.Unexpected)}&appName=${encodeURIComponent(b.clientAuthAppName)}${y.tenantId?`&tenantId=${encodeURIComponent(y.tenantId)}`:""}${y.userObjectId?`&userObjectId=${encodeURIComponent(y.userObjectId)}`:""}${y.userPuid?`&userPuid=${encodeURIComponent(y.userPuid)}`:""}${h?`&errorArray=${encodeURIComponent(h)}`:""}`)}}}else{var r=yield t.retrieveSignedInAccount(),n=r?.idTokenClaims;t.setGlobalVariablesFromAuthResult({accessToken:"",clusterUri:I.DefaultClusterUri,givenName:r?.name??"",puid:n?.puid??"",surname:"",tenantId:r?.tenantId??"",accessTokenExpiryString:new Date(Date.now()+864e5).toISOString(),userName:r?.username??"",objectId:n?.oid})}})()}signOut(e,t){var r=this;return(0,p.A)(function*(){yield r.ensureClientApplicationInitialized();var n=yield r.retrieveSignedInAccount();r.removeCookie(I.SignedInCookieKey),r.removeCookie(I.WFESessionIdCookieKey),n?.tenantId&&(localStorage.removeItem(`${I.ClusterUriCacheKeyPrefix}.${n.tenantId}.${L.environmentName}`),localStorage.removeItem(`${I.PrivateLinkFixedClusterUriCacheKeyPrefix}.${n.tenantId}.${L.environmentName}`),localStorage.removeItem(`${I.ClusterUriExpiryCacheKeyPrefix}.${n.tenantId}.${L.environmentName}`),Object.keys(localStorage).forEach(a=>{a.startsWith(`${I.ClusterUriCacheKeyPrefix}.${n.tenantId}.`)&&a.endsWith(`.${L.environmentName}`)&&localStorage.removeItem(a)})),r._isSignedOut=!0,[...r.signOutEventListeners].forEach(a=>a());var o={account:n,postLogoutRedirectUri:t||null,logoutHint:n?.idTokenClaims?.login_hint};e?yield r.msalClientApplication.logoutPopup(o):yield r.msalClientApplication.logoutRedirect(o)})()}createPublicClientApplication(e){return yt.createPublicClientApplication(e)}calculateSignInDuration(){y.signInUserInteractionDuration=rr(y?.signInUserInteractionEndTime,y?.signInUserInteractionStartTime),y.clusterResolutionDuration=rr(y?.clusterResolutionEndTime,y?.clusterResolutionStartTime),Number.isFinite(y.signInUserInteractionDuration)&&(y.preRedirectSignInStartTimestamp=y?.signInStartTime,y.preRedirectSignInEndTimestamp=y?.signInUserInteractionStartTime,y.postRedirectSignInEndTimestamp=y?.signInCompletionTime,y.preRedirectSignInDuration=rr(y?.preRedirectSignInEndTimestamp,y?.preRedirectSignInStartTimestamp),y.postRedirectSignInDuration=rr(y?.postRedirectSignInEndTimestamp,y?.postRedirectSignInStartTimestamp)),y.signInNonInteractiveDuration=Number.isFinite(y?.preRedirectSignInDuration)&&Number.isFinite(y?.postRedirectSignInDuration)?y?.preRedirectSignInDuration+y?.postRedirectSignInDuration:rr(y?.signInCompletionTime,y?.signInStartTime)}createQueryParams(e){var t=window.location.search,r=b.clientAuthGetAppSpecificQueryParams?b.clientAuthGetAppSpecificQueryParams(window.location.href,e)?.toString():"";return r?`${t}${t?"&":"?"}${r}`:t}markUserInteractionStartTime(e=de()){y.signInUserInteractionStartTime=e}}Cn.init();var Za=window,xn=window.signInProviderService=new Xa;function Gd(i){return window.msalClientApplication=xn.msalClientApplication,Za.clientAuthInSignInPageContext?xn.handleRedirect():window.signInPromise=Za.clientAuthEagerlyLogTelemetry?new Promise((e,t)=>{xn.signIn(i).then(r=>{_.e("SignInTelemetry").then(_.bind(_,439)).then(n=>{var o=window.powerbi?.createTelemetryService(window.powerbi?.createTelemetryOptions(),window.powerbi?.createTelemetryHostService(),window.powerbi?.createUserActivityContextService());new n.SignInTelemetryLogger(o).logAndFlushQueue(),e(r)}).catch(n=>{t(n)})}).catch(r=>{t(r)})}):xn.signIn(i),window.signInPromise}function qd(i,e){return window.signInProviderService.signOut(i,e)}function es(){return window.signInProviderService?window.signInProviderService.retrieveSignedInAccount():Promise.resolve(void 0)}function zd(){return Ao.apply(this,arguments)}function Ao(){return(Ao=(0,p.A)(function*(){return void 0!==(yield es())})).apply(this,arguments)}function Qd(){return vn()}window.addEventListener("beforeunload",()=>{window.sessionStorage.removeItem(Ri)}),window.clientAuthProvider=Fn}();